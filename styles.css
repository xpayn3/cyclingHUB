/* ── Disable pinch-to-zoom globally, allow on maps ── */
*,
*::before,
*::after {
    touch-action: pan-x pan-y !important;
    -ms-touch-action: pan-x pan-y !important;
}
.leaflet-container,
.leaflet-container *,
.leaflet-container *::before,
.leaflet-container *::after {
    touch-action: auto !important;
    -ms-touch-action: auto !important;
}

/* ============================================================
   DESIGN TOKENS  ←  EDIT HERE TO CHANGE THE WHOLE APP
   ============================================================
   Everything visual lives in this one block.
   Change a value once — it updates everywhere automatically.
============================================================ */
:root {
    /* ── Accent colour ───────────────────────────────────────
       The main brand green. Change just this hex and the
       tints below update too (they reference it via opacity).
    ──────────────────────────────────────────────────────── */
    --accent: #00e5a0; /* primary green — buttons, highlights, charts */
    --accent-dim: rgba(
        0,
        229,
        160,
        0.12
    ); /* subtle tint for hover backgrounds */
    --accent-glow: rgba(
        0,
        229,
        160,
        0.25
    ); /* glow rings, active borders        */
    --accent-faint: rgba(
        0,
        229,
        160,
        0.07
    ); /* very light wash, card backgrounds */

    /* ── Secondary palette ───────────────────────────────────
       Used for chart lines, badges, metric highlights.
    ──────────────────────────────────────────────────────── */
    --blue: #4a9eff;
    --blue-dim: rgba(74, 158, 255, 0.12);
    --purple: #9b59ff;
    --purple-dim: rgba(155, 89, 255, 0.12);
    --orange: #ff6b35;
    --orange-dim: rgba(255, 107, 53, 0.12);
    --red: #ff4757;
    --red-dim: rgba(255, 71, 87, 0.12);
    --yellow: #f0c429;
    --yellow-dim: rgba(240, 196, 41, 0.12);

    /* ── Backgrounds ─────────────────────────────────────────
       Layered dark surfaces from deepest to highest.
       bg-base → bg-surface → bg-elevated → bg-card
    ──────────────────────────────────────────────────────── */
    --bg-base: #0a0c10; /* page/body background                */
    --bg-surface: #10131a; /* sidebar, modals                     */
    --bg-elevated: #161a24; /* inner card sections, input fields   */
    --bg-card: #1a1f2c; /* card surfaces                       */

    /* ── Borders ─────────────────────────────────────────────*/
    --border: #212736; /* default card border        */
    --border-active: #36405a; /* focused / active border    */

    /* ── Text ────────────────────────────────────────────────*/
    --text-primary: #f0f2fa; /* headings, values         */
    --text-secondary: #9ba5be; /* labels, subtitles        */
    --text-muted: #62708a; /* hints, placeholders      */

    /* ── Spacing ─────────────────────────────────────────────
       These three control all padding and gaps across the app.
       --pad-page   : left/right gutters of the main content
       --gap-layout : gap between cards and sections
       --pad-card   : inner padding inside every card
    ──────────────────────────────────────────────────────── */
    --pad-page: 14px;
    --gap-layout: 14px;
    --pad-card: 12px 12px;

    /* ── Spacing scale ───────────────────────────────────────
       Used for component-level gaps (buttons, rows, chips).
    ──────────────────────────────────────────────────────── */
    --space-xs: 4px;
    --space-sm: 8px;
    --space-md: 12px;
    --space-lg: 16px;
    --space-xl: 24px;

    /* ── Border radius ───────────────────────────────────────
       --radius    : standard card / component radius
       --radius-lg : larger panels, modals, hero cards
       --radius-sm : small chips, badges, inputs
    ──────────────────────────────────────────────────────── */
    --radius: 10px;
    --radius-lg: 16px;
    --radius-sm: 6px;

    /* ── Motion ──────────────────────────────────────────────*/
    --transition: 0.18s ease; /* hover colour/opacity transitions */

    /* ── Layout ──────────────────────────────────────────────*/
    --sidebar-w: 220px; /* width of the left nav sidebar    */

    /* ── Typography ──────────────────────────────────────────
       --font-ui  : all UI text — body, labels, buttons, nav
       --font-num : numbers, stats, data values
       Swap both to change fonts globally.
    ──────────────────────────────────────────────────────── */
    --font-ui: "Inter", system-ui, -apple-system, sans-serif;
    --font-num: "Inter", system-ui, -apple-system, sans-serif;

    /* ── Font size scale ─────────────────────────────────────
       Base html font-size: 16px — scale all sizes by changing
       that one value in the RESET section below.
    ──────────────────────────────────────────────────────── */
    --text-2xs: 0.62rem; /* ~10px  — micro badges, superscripts  */
    --text-xs: 0.72rem; /* ~12px  — uppercase labels, meta      */
    --text-sm: 0.8rem; /* ~13px  — secondary body, sub-labels  */
    --text-base: 0.875rem; /* ~14px  — primary body text           */
    --text-md: 1rem; /*  16px  — card sub-headings           */
    --text-lg: 1.1rem; /* ~18px  — section titles              */
    --text-xl: 1.9rem; /* ~30px  — primary stat values         */
    --text-2xl: 2.2rem; /* ~35px  — hero gauge numbers          */
}

/* ============================================================
   RESET & BASE
============================================================ */
*,
*::before,
*::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}
html {
    font-size: 16px;
    overflow-x: clip; /* clip without creating a scroll container — allows children to have their own h-scroll */
    max-width: 100%;
    background: var(--bg-base);
}
body {
    font-family: var(--font-ui);
    background: var(--bg-base);
    color: var(--text-primary);
    overflow-x: clip;
    max-width: 100%;
    overscroll-behavior-x: none;
}
a {
    color: inherit;
    text-decoration: none;
}
button {
    cursor: pointer;
    border: none;
    background: none;
    font-family: inherit;
    color: inherit;
}
svg {
    display: block;
}
input,
select {
    font-family: inherit;
}

/* ============================================================
   UNIVERSAL CUSTOM SELECT / DROPDOWN
   Apply .app-select to every <select> across the app.
============================================================ */
.app-select {
    appearance: none;
    -webkit-appearance: none;
    display: block;
    width: 100%;
    background: var(--bg-elevated)
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='7' viewBox='0 0 12 7'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%238891a8' stroke-width='1.6' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E")
        no-repeat right 13px center;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    color: var(--text-primary);
    font-family: var(--font-ui);
    font-size: var(--text-base);
    font-weight: 500;
    padding: 9px 38px 9px 13px;
    cursor: pointer;
    outline: none;
    transition:
        border-color var(--transition),
        box-shadow var(--transition),
        color var(--transition);
    line-height: 1.4;
}
.app-select:hover {
    border-color: var(--border-active);
}
.app-select:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-dim);
}
.app-select option {
    background: var(--bg-elevated);
    color: var(--text-primary);
}
/* Compact variant — used in card headers / toolbars */
.app-select--sm {
    font-size: var(--text-sm);
    padding: 10px 32px 10px 10px;
    height: 40px;
    border-radius: 8px;
    background-position: right 10px center;
    width: auto;
    display: flex;
    align-items: center;
}

code {
    font-family: var(--font-num);
    font-size: 0.82em;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 1px 6px;
    color: var(--accent);
}

/* ============================================================
   SIDEBAR
============================================================ */
.sidebar {
    width: var(--sidebar-w);
    min-height: 100vh;
    min-height: 100dvh;
    background: var(--bg-surface);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    z-index: 1100; /* above Leaflet's max of 1000 */
    padding-top: env(safe-area-inset-top);
    transition: transform 0.28s cubic-bezier(0.4, 0, 0.2, 1);
    overscroll-behavior: contain; /* prevent scroll chaining to body */
}
.sidebar-logo {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 22px 20px;
    border-bottom: 1px solid var(--border);
}
.logo-icon {
    width: 34px;
    height: 34px;
    background: var(--accent);
    border-radius: 9px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}
.logo-icon svg {
    width: 18px;
    height: 18px;
}
.logo-text {
    font-size: var(--text-lg);
    font-weight: 800;
    letter-spacing: -0.3px;
}
.logo-text span {
    color: var(--accent);
}
.sidebar-nav {
    flex: 1;
    padding: 14px 10px;
    display: flex;
    flex-direction: column;
    gap: 2px;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
}
.nav-section-label {
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    padding: 10px 10px 4px;
}
.sidebar-nav > .nav-section-label:not(:first-child) {
    margin-top: 8px;
}
.nav-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 9px 12px;
    border-radius: 8px;
    color: var(--text-secondary);
    font-size: var(--text-md);
    font-weight: 500;
    transition:
        background var(--transition),
        color var(--transition);
    cursor: pointer;
    user-select: none;
}
.nav-item svg {
    width: 17px;
    height: 17px;
    flex-shrink: 0;
}
.nav-item:hover {
    background: var(--bg-elevated);
    color: var(--text-primary);
}
.nav-item.active {
    background: var(--accent-dim);
    color: var(--accent);
}
.nav-item .badge {
    margin-left: auto;
    background: var(--accent);
    color: var(--bg-base);
    font-size: var(--text-2xs);
    font-weight: 700;
    padding: 2px 7px;
    border-radius: 20px;
}
.sidebar-footer {
    padding: 14px 10px;
    padding-bottom: calc(14px + env(safe-area-inset-bottom));
    border-top: 1px solid var(--border);
    background: var(--bg-surface);
    display: flex;
    flex-direction: column;
    gap: 12px;
}
.sidebar-create-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 10px 14px;
    background: var(--accent);
    color: var(--bg-base);
    border: none;
    border-radius: var(--radius);
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition);
    width: 100%;
}
.sidebar-create-btn:hover {
    background: #00ffa8;
    box-shadow: 0 0 16px var(--accent-glow);
}
.sidebar-create-btn svg {
    width: 16px;
    height: 16px;
    stroke-width: 2;
}
.athlete-chip {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 8px;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    cursor: pointer;
    transition: border-color var(--transition);
}
.athlete-chip:hover {
    border-color: var(--border-active);
}
.sidebar-actions {
    display: flex;
    gap: 8px;
}
.sidebar-action-btn {
    flex: 1;
    justify-content: center;
    gap: 7px;
    font-size: var(--text-sm);
    padding: 8px 10px;
}
.athlete-avatar {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), var(--blue));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--text-sm);
    font-weight: 700;
    color: var(--bg-base);
    flex-shrink: 0;
}
.athlete-info {
    flex: 1;
    min-width: 0;
}
.athlete-name {
    font-size: var(--text-sm);
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.athlete-sub {
    font-size: var(--text-xs);
    color: var(--text-muted);
}
.connection-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
}
.connection-dot.connected {
    background: var(--accent);
    box-shadow: 0 0 6px var(--accent);
}
.connection-dot.disconnected {
    background: var(--text-muted);
}

/* ============================================================
   MAIN LAYOUT
============================================================ */
.main {
    margin-left: var(--sidebar-w);
    min-height: 100svh;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    min-width: 0;
}
.topbar {
    height: calc(48px + env(safe-area-inset-top));
    background: var(--bg-surface);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    padding: env(safe-area-inset-top) 16px 0;
    gap: 10px;
    position: fixed;
    top: 0;
    left: var(--sidebar-w);
    right: 0;
    z-index: 1100; /* above Leaflet's max of 1000 */
    flex-shrink: 0;
}
/* ── Training status glow under topbar (dashboard only) ── */
.topbar-glow-el {
    position: relative;
    width: calc(100% + var(--pad-page) * 2);
    margin-left: calc(-1 * var(--pad-page));
    margin-top: calc(-14px - var(--gap-layout));
    height: 80px;
    margin-bottom: calc(-80px + 14px + var(--gap-layout));
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.5s ease;
    background: radial-gradient(
        ellipse 50% 100% at 50% 0%,
        var(--topbar-glow, rgba(0, 229, 160, 0.25)) 0%,
        transparent 80%
    );
    z-index: 0;
}
.dashboard-glow .topbar-glow-el {
    opacity: 1;
}

.topbar-actions {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-left: auto;
}
.topbar--hidden {
    display: none;
}
.topbar-month-label {
    font-size: 1.05rem;
    font-weight: 700;
    letter-spacing: -0.3px;
    color: var(--text-primary);
    white-space: nowrap;
}

/* ── Page headline ── */
.page-headline {
    padding: 100px 0 8px;
}
.page-headline--hidden {
    display: none;
}
.page-headline-title {
    font-size: 1.6rem;
    font-weight: 800;
    letter-spacing: -0.5px;
    line-height: 1.1;
}
.page-headline-sub {
    font-size: var(--text-sm);
    color: var(--text-muted);
    margin-top: 4px;
}
.page-content {
    flex: 1;
    padding: calc(48px + env(safe-area-inset-top) + 14px) var(--pad-page)
        max(20px, env(safe-area-inset-bottom));
    display: flex;
    flex-direction: column;
    gap: var(--gap-layout);
}
/* When topbar is hidden (calendar full-viewport layout), remove reserved topbar space */
.topbar--hidden ~ .page-content {
    padding-top: var(--pad-page);
}

/* ============================================================
   BUTTONS
============================================================ */
.btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 7px 14px;
    border-radius: 8px;
    font-size: var(--text-sm);
    font-weight: 600;
    transition: all var(--transition);
}
.btn svg {
    width: 14px;
    height: 14px;
}
.btn-primary {
    background: var(--accent);
    color: var(--bg-base);
}
.btn-primary:hover {
    background: #00ffa8;
    box-shadow: 0 0 16px var(--accent-glow);
}
.btn-primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}
.btn-ghost {
    background: var(--bg-elevated);
    color: var(--text-secondary);
    border: 1px solid var(--border);
}
.btn-ghost:hover {
    color: var(--text-primary);
    border-color: var(--border-active);
}
.btn-icon {
    width: 34px;
    height: 34px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    padding: 0;
}
.btn-icon svg {
    width: 18px;
    height: 18px;
}
.btn-danger {
    background: rgba(255, 71, 87, 0.12);
    color: var(--red);
    border: 1px solid rgba(255, 71, 87, 0.25);
}
.btn-danger:hover {
    background: rgba(255, 71, 87, 0.2);
}
.btn-spinning svg {
    animation: spin 0.7s linear infinite;
}
.date-range-pill {
    display: flex;
    align-items: center;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
}
.date-range-pill button {
    padding: 6px 12px;
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--text-secondary);
    transition: all var(--transition);
    border-right: 1px solid var(--border);
}
.date-range-pill button:last-child {
    border-right: none;
}
.date-range-pill button:hover,
.date-range-pill button.active {
    background: var(--accent-dim);
    color: var(--accent);
}

/* ============================================================
   CONNECT MODAL
============================================================ */
.modal-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.75);
    z-index: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease;
}
.modal-backdrop.open {
    opacity: 1;
    pointer-events: all;
}
.modal {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 18px;
    width: 100%;
    max-width: 480px;
    overflow: hidden;
    transform: translateY(12px);
    transition: transform 0.2s ease;
}
.modal-backdrop.open .modal {
    transform: translateY(0);
}
.modal-header {
    padding: 24px 28px 0;
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
}
.modal-header-icon {
    width: 46px;
    height: 46px;
    background: var(--accent-dim);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 16px;
}
.modal-header-icon svg {
    width: 22px;
    height: 22px;
    color: var(--accent);
}
.modal-close {
    width: 30px;
    height: 30px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-muted);
    background: var(--bg-elevated);
    transition: all var(--transition);
}
.modal-close:hover {
    color: var(--text-primary);
    background: var(--border);
}
.modal-close svg {
    width: 14px;
    height: 14px;
}
.modal-body {
    padding: 0 28px 28px;
}
.modal-title {
    font-size: var(--text-lg);
    font-weight: 800;
    margin-bottom: 6px;
}
.modal-desc {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    line-height: 1.5;
    margin-bottom: 22px;
}
.modal-footer {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
    padding-top: 4px;
}

/* Form fields */
.field {
    margin-bottom: 16px;
}
.field label {
    display: block;
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}
.field input {
    width: 100%;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 9px;
    padding: 10px 14px;
    color: var(--text-primary);
    font-size: var(--text-base);
    outline: none;
    transition:
        border-color var(--transition),
        box-shadow var(--transition);
}
.field input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-dim);
}
.field input::placeholder {
    color: var(--text-muted);
}
.field input.error {
    border-color: var(--red);
}
.field-hint {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 5px;
    line-height: 1.4;
}
.field-hint a {
    color: var(--accent);
}
.field-error {
    font-size: var(--text-xs);
    color: var(--red);
    margin-top: 5px;
    display: none;
}
.field-error.show {
    display: block;
}
.input-with-toggle {
    position: relative;
}
.input-with-toggle input {
    padding-right: 42px;
}
.toggle-visibility {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px;
    transition: color var(--transition);
}
.toggle-visibility:hover {
    color: var(--text-primary);
}
.toggle-visibility svg {
    width: 16px;
    height: 16px;
}

/* Callout */
.callout {
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-left: 3px solid var(--accent);
    border-radius: 8px;
    padding: 12px 14px;
    margin-bottom: 20px;
    font-size: var(--text-sm);
    line-height: 1.5;
    color: var(--text-secondary);
}
.callout strong {
    color: var(--text-primary);
}
.callout ol {
    margin-left: 16px;
    margin-top: 6px;
}
.callout li {
    margin-bottom: 3px;
}

/* ============================================================
   STAT CARDS
============================================================ */
.section-label {
    font-size: var(--text-xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    margin-bottom: 12px;
}
.stat-grid-label {
    font-size: var(--text-xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
}
.stat-grid-label span {
    font-weight: 500;
    text-transform: none;
    letter-spacing: 0;
    color: var(--text-secondary);
    font-size: var(--text-xs);
}

/* Visual divider between dashboard sections */
.dash-section-divider {
    border: none;
    border-top: 1px solid var(--border);
    margin: 4px 0;
}
.stat-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(155px, 1fr));
    gap: var(--gap-layout);
}
.stat-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: var(--pad-card);
    display: flex;
    flex-direction: column;
    gap: 8px;
    transition:
        border-color var(--transition),
        box-shadow var(--transition);
    position: relative;
    --mouse-x: 50%;
    --mouse-y: 50%;
}

/* inner spotlight glow */
.stat-card::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.055) 0%,
        transparent 65%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
}

/* rim glow — masked to border edge only */
.stat-card::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 1px;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.35) 0%,
        transparent 60%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
    -webkit-mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
}

.stat-card:hover {
    border-color: transparent;
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.35);
}
.stat-card:hover::before,
.stat-card:hover::after {
    opacity: 1;
}
.stat-card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
}
.stat-label {
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.07em;
    color: var(--text-muted);
}
.stat-icon {
    width: 28px;
    height: 28px;
    border-radius: 7px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.stat-icon svg {
    width: 14px;
    height: 14px;
}
.stat-icon.green {
    background: var(--accent-dim);
    color: var(--accent);
}
.stat-icon.orange {
    background: var(--orange-dim);
    color: var(--orange);
}
.stat-icon.blue {
    background: var(--blue-dim);
    color: var(--blue);
}
.stat-icon.purple {
    background: var(--purple-dim);
    color: var(--purple);
}
.stat-value {
    font-size: var(--text-xl);
    font-weight: 800;
    letter-spacing: -1px;
    font-family: var(--font-num);
    line-height: 1;
}
.stat-value .unit {
    font-size: var(--text-base);
    font-weight: 500;
    color: var(--text-secondary);
    font-family: var(--font-ui);
    letter-spacing: 0;
}
.stat-delta {
    font-family: var(--font-ui);
    font-size: var(--text-sm);
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 4px;
}
.stat-delta.up {
    color: var(--accent);
}
.stat-delta.down {
    color: var(--red);
}
.stat-delta.neutral {
    color: var(--text-muted);
}

/* ============================================================
   CARD
============================================================ */
.card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: var(--pad-card);
    min-width: 0;
}
.card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
}
.card-title {
    font-size: var(--text-md);
    font-weight: 700;
}
.card-subtitle {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 2px;
}
.card--narrow {
    max-width: 580px;
}
.card--clickable {
    cursor: pointer;
    transition:
        border-color var(--transition),
        background var(--transition);
}
.card--clickable:hover {
    border-color: var(--border-active);
    background: #212736;
}
.card--clickable:active {
    background: var(--bg-elevated);
}
/* Two cards sitting side by side in one row, equal height */
/* ── Recent Activity card ──────────────────────────────────────────────── */
/* Scroll rail — App Store-style horizontal carousel */
.recent-act-scroll-rail {
    display: flex;
    gap: 14px;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    padding-bottom: 4px; /* prevent box-shadow clipping */
}
.recent-act-scroll-rail::-webkit-scrollbar {
    display: none;
}

/* Each card: fixed width, never shrinks */
.recent-act-card {
    flex: 0 0 420px;
    overflow: hidden;
    padding: 0; /* no card padding — info side handles its own */
    position: relative;
    transition:
        transform 0.18s cubic-bezier(0.34, 1.56, 0.64, 1),
        box-shadow 0.18s ease;
    --mouse-x: 50%;
    --mouse-y: 50%;
}
.recent-act-card::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.055) 0%,
        transparent 65%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 2;
}
.recent-act-card::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 1px;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.35) 0%,
        transparent 60%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 2;
    -webkit-mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
}
.recent-act-card:hover::before,
.recent-act-card:hover::after {
    opacity: 1;
}
@media (max-width: 600px) {
    .recent-act-scroll-rail {
        margin-left: calc(-1 * var(--pad-page));
        margin-right: calc(-1 * var(--pad-page));
        padding-left: var(--pad-page);
        padding-right: var(--pad-page);
        scroll-padding-inline: var(--pad-page);
    }
    .recent-act-card {
        flex: 0 0 calc(100vw - 68px); /* narrower so ~40px of next card peeks */
    }
}
.recent-act-body {
    display: flex;
    flex-wrap: nowrap;
    gap: 0;
    align-items: stretch;
    height: 168px; /* explicit height = consistent across all cards */
}
.recent-act-info {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 4px;
    justify-content: space-between;
    padding: 10px 10px 10px 12px; /* padding lives here, not on the card */
}
.recent-act-header {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 4px;
    min-width: 0;
}
.recent-act-text {
    min-width: 0;
}
.recent-act-icon {
    width: 30px;
    height: 30px;
    border-radius: 8px;
    background: var(--accent-dim);
    color: var(--accent);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}
.recent-act-icon svg {
    width: 18px;
    height: 18px;
}
.recent-act-name {
    font-size: var(--text-md);
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1.3;
}
.recent-act-date {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 2px;
    margin-bottom: 5px;
}
.recent-act-stats {
    display: flex;
    flex-wrap: nowrap;
    gap: 0;
    padding-top: 8px;
    border-top: 1px solid var(--border);
    margin-top: auto;
}
.ra-stat {
    display: flex;
    flex-direction: column;
    gap: 3px;
    padding-right: 16px;
    margin-right: 16px;
    margin-bottom: 6px;
    position: relative;
}
.ra-stat:not(:last-child)::after {
    content: "";
    position: absolute;
    right: 0;
    top: 0;
    bottom: 10px;
    width: 1px;
    background: var(--border);
}
.ra-stat-lbl {
    font-size: var(--text-2xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    line-height: 1;
    white-space: nowrap;
}
.ra-stat-val {
    font-size: 1.2rem;
    font-weight: 700;
    font-family: var(--font-num);
    color: var(--text-primary);
    line-height: 1;
    letter-spacing: -0.02em;
}
.ra-stat-unit {
    font-size: var(--text-xs);
    font-weight: 500;
    color: var(--text-secondary);
    letter-spacing: 0;
}
.ra-tss {
    display: flex;
    flex-direction: column;
    gap: 3px;
    margin-top: 6px;
    margin-bottom: 8px;
}
.ra-tss-lbl {
    font-size: var(--text-2xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    line-height: 1;
}
.ra-tss-val {
    font-size: 1.15rem;
    font-weight: 700;
    font-family: var(--font-num);
    color: var(--accent);
    line-height: 1;
    letter-spacing: -0.02em;
}
.ra-tss-val span {
    font-size: var(--text-xs);
    font-weight: 500;
    color: var(--text-secondary);
    letter-spacing: 0;
}
.recent-act-map {
    width: 160px;
    flex-shrink: 0;
    border-radius: 0 var(--radius-lg) var(--radius-lg) 0;
    overflow: hidden;
    background: var(--bg-elevated);
    position: relative;
    align-self: stretch;
}
.ra-map-empty {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--text-xs);
    color: var(--text-muted);
}
.recent-act-badges {
    display: flex;
    gap: 6px;
    align-items: center;
    margin-top: 6px;
    flex-wrap: wrap;
}
.ra-tss-badge {
    display: inline-block;
    background: var(--accent);
    color: var(--bg-base);
    font-family: var(--font-num);
    font-size: 10px;
    font-weight: 700;
    padding: 1px 6px;
    border-radius: 4px;
    line-height: 1.4;
}
@media (max-width: 600px) {
    .recent-act-body {
        flex-direction: column;
        height: auto;
    }
    .recent-act-info {
        padding: 10px 12px 0;
    }
    .recent-act-map {
        display: block;
        width: 100%;
        height: 160px;
        border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        order: -1;
    }
    .recent-act-stats {
        padding-bottom: 10px;
        width: 100%;
    }
    .ra-stat {
        flex: 1;
        min-width: 0;
        padding: 0;
        margin: 0;
        text-align: left;
        align-items: flex-start;
    }
    .ra-stat:not(:last-child)::after {
        display: none;
    }
}

.card-row {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--gap-layout);
    align-items: stretch;
}
.card-row > .card {
    min-width: 0;
    display: flex;
    flex-direction: column;
}
.card-row > .card .chart-wrap {
    flex: 1;
}
@media (max-width: 900px) {
    .card-row {
        grid-template-columns: 1fr;
    }
}
/* Reusable right-side slot in card headers (legend + controls) */
.card-header-controls {
    display: flex;
    align-items: center;
    gap: 16px;
}

/* ============================================================
   FITNESS ROW (Training Load + Status)
============================================================ */
.fitness-row {
    display: grid;
    grid-template-columns: 1fr minmax(0, 340px);
    gap: var(--gap-layout);
    align-items: stretch;
}
.fitness-row .card {
    display: flex;
    flex-direction: column;
}
.fitness-row .card .chart-wrap {
    flex: 1;
    min-height: 160px;
}

/* Fitness gauges */
.fitness-gauges {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--gap-layout);
}
.gauge-card {
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: var(--pad-card);
    text-align: center;
}
.gauge-label {
    font-size: var(--text-xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.09em;
    color: var(--text-muted);
    margin-bottom: 8px;
}
.gauge-value {
    font-size: var(--text-2xl);
    font-weight: 800;
    font-family: var(--font-num);
    letter-spacing: -1.5px;
    line-height: 1;
}
.gauge-name {
    font-size: var(--text-xs);
    color: var(--text-secondary);
    margin-top: 4px;
}
.gauge-bar {
    height: 4px;
    background: var(--border);
    border-radius: 2px;
    margin-top: 10px;
    overflow: hidden;
}
.gauge-bar-fill {
    height: 100%;
    border-radius: 2px;
    transition: width 0.6s ease;
}

/* Gauge ID-specific colors */
#gaugeCTL {
    color: var(--accent);
}
#gaugeATL {
    color: var(--orange);
}
#gaugeTSB {
    color: var(--blue);
}
#barCTL {
    background: var(--accent);
}
#barATL {
    background: var(--orange);
}
#barTSB {
    background: var(--blue);
}

/* Weekly TSS section inside Fitness Status card */
.weekly-tss-section {
    margin-top: 16px;
}
.weekly-tss-label {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-muted);
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 0.06em;
}
.weekly-tss-section .chart-wrap {
    height: 90px;
}

/* Chart legend */
.chart-legend {
    display: flex;
    gap: 14px;
    font-size: var(--text-xs);
    color: var(--text-muted);
}
.chart-legend-item {
    display: flex;
    align-items: center;
    gap: 5px;
}
.chart-legend-dot {
    width: 10px;
    height: 3px;
    display: inline-block;
    border-radius: 2px;
}

/* ============================================================
   CHART
============================================================ */
.chart-wrap {
    position: relative;
    height: 200px;
}
.chart-wrap--fitness {
    height: 270px;
}

/* Range label shown in Training Load card header (replaces the pill) */
.fitness-range-label {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--text-muted);
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 3px 9px;
    letter-spacing: 0.03em;
    white-space: nowrap;
}

/* Training Load legend footer */
.fitness-legend-footer {
    display: flex;
    gap: 0;
    border-top: 1px solid var(--border);
    margin-top: 4px;
}
.flf-item {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    flex: 1;
    padding: 12px 14px;
    border-right: 1px solid var(--border);
}
.flf-item:last-child {
    border-right: none;
}
.flf-dot {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
    margin-top: 4px;
}
.flf-text {
    display: flex;
    flex-direction: column;
    gap: 3px;
}
.flf-label {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-primary);
    line-height: 1.2;
}
.flf-desc {
    font-size: var(--text-xs);
    color: var(--text-muted);
    line-height: 1.4;
}
@media (max-width: 600px) {
    .fitness-legend-footer {
        flex-direction: column;
    }
    .flf-item {
        border-right: none;
        border-bottom: 1px solid var(--border);
        padding: 10px 12px;
    }
    .flf-item:last-child {
        border-bottom: none;
    }
}

/* ============================================================
   ACTIVITY LIST
============================================================ */
/* ---- Activity list containers ---- */
.activity-list {
    display: flex;
    flex-direction: column;
    gap: 0;
}

/* ── Activities page sort bar ─────────────────────────────────────── */
/* ---- Activities toolbar ---- */
.acts-toolbar {
    padding: 14px 0;
    border-bottom: 1px solid var(--border);
    margin-bottom: 4px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    position: sticky;
    top: calc(48px + env(safe-area-inset-top));
    z-index: 10;
    background: var(--bg-base);
}
.acts-toolbar-top {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
}
.acts-search-wrap {
    flex: 1;
    min-width: 160px;
    position: relative;
    display: flex;
    align-items: center;
}
.acts-search-icon {
    position: absolute;
    left: 10px;
    width: 14px;
    height: 14px;
    color: var(--text-muted);
    pointer-events: none;
    flex-shrink: 0;
}
.acts-search-input {
    width: 100%;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    color: var(--text-primary);
    font-size: var(--text-sm);
    padding: 10px 12px 10px 32px;
    height: 40px;
    outline: none;
    transition:
        border-color var(--transition),
        box-shadow var(--transition);
}
.acts-search-input::placeholder {
    color: var(--text-muted);
}
.acts-search-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-dim);
}
.acts-count {
    font-size: var(--text-sm);
    color: var(--text-muted);
    white-space: nowrap;
    font-variant-numeric: tabular-nums;
}
.acts-filters-row {
    display: flex;
    align-items: center;
    gap: 6px;
    flex-wrap: wrap;
}
.acts-filter-group {
    display: flex;
    align-items: center;
    gap: 5px;
    flex-wrap: wrap;
}
.acts-toolbar-sep {
    width: 1px;
    height: 18px;
    background: var(--border);
    margin: 0 4px;
    flex-shrink: 0;
}
@media (max-width: 600px) {
    .acts-toolbar-sep {
        display: none;
    }
    .acts-filters-row {
        gap: 4px;
    }
    .acts-filter-group {
        gap: 4px;
    }
}

.sort-label {
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    margin-right: 2px;
}
.sort-btn {
    background: none;
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 4px 11px;
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--text-secondary);
    cursor: pointer;
    transition:
        border-color var(--transition),
        color var(--transition),
        background var(--transition);
    white-space: nowrap;
}
.sort-btn:hover {
    border-color: var(--border-active);
    color: var(--text-primary);
}
.sort-btn.active {
    border-color: var(--accent);
    color: var(--accent);
    background: var(--accent-dim);
}
.sort-arrow {
    font-size: var(--text-xs);
}

/* ---- Activity row — single horizontal line ---- */
.activity-row {
    display: flex;
    flex-direction: row;
    align-items: center;
    padding: 14px var(--pad-page);
    gap: 12px;
    background: transparent;
    border: none;
    border-bottom: 1px solid var(--border);
    border-radius: 0;
    cursor: pointer;
    overflow: hidden;
    transition: background var(--transition);
}
.activity-row:hover {
    background: rgba(255, 255, 255, 0.02);
    border-color: var(--border);
}
.activity-row:active {
    background: rgba(255, 255, 255, 0.04);
}

/* Icon */
.activity-type-icon {
    width: 32px;
    height: 32px;
    border-radius: 6px;
    background: var(--accent-dim);
    color: var(--accent);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}
.activity-type-icon svg {
    width: 16px;
    height: 16px;
}
.activity-type-icon.run {
    background: var(--orange-dim);
    color: var(--orange);
}
.activity-type-icon.swim {
    background: var(--blue-dim);
    color: var(--blue);
}
.activity-type-icon.virtual {
    background: var(--purple-dim);
    color: var(--purple);
}

/* Name + date — grows to fill available space; stats stay right-aligned */
.act-card-info {
    flex: 1 1 0;
    min-width: 0;
}
.act-card-name {
    font-size: var(--text-base);
    font-weight: 700;
    letter-spacing: -0.2px;
    line-height: 1.2;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.act-card-sub {
    display: flex;
    align-items: center;
    gap: 5px;
    margin-top: 2px;
}
.act-card-date {
    font-size: var(--text-xs);
    color: var(--text-muted);
}
.act-card-badge {
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 1px 5px;
    font-size: var(--text-2xs);
    font-weight: 600;
    letter-spacing: 0.04em;
    color: var(--text-secondary);
}
/* Platform source tag (e.g. "Zwift") — accent-tinted pill */
.act-platform-tag {
    background: rgba(0, 229, 160, 0.1);
    border: 1px solid rgba(0, 229, 160, 0.28);
    border-radius: 4px;
    padding: 1px 6px;
    font-size: var(--text-2xs);
    font-weight: 700;
    letter-spacing: 0.05em;
    color: var(--accent);
    text-transform: uppercase;
}
.activity-tss {
    padding: 2px 8px;
    border-radius: 20px;
    font-size: var(--text-xs);
    font-weight: 700;
    background: var(--accent-dim);
    color: var(--accent);
    font-family: var(--font-num);
    white-space: nowrap;
    flex-shrink: 0;
    line-height: 1.5;
    margin-left: auto;
}

/* Stats — inline, pushed to the right of name */
.act-card-stats {
    display: flex;
    gap: 0;
    flex: 1;
    justify-content: flex-end;
    align-items: center;
}
.act-stat {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    flex: 1 1 0;
    min-width: 50px;
    padding: 0 12px;
}
.act-stat + .act-stat {
    border-left: 1px solid rgba(255, 255, 255, 0.05);
}
.act-stat:last-child {
    padding-right: 0;
}
.act-stat-val {
    font-size: var(--text-sm);
    font-weight: 700;
    font-family: var(--font-num);
    letter-spacing: -0.4px;
    line-height: 1.3;
    white-space: nowrap;
}
.act-stat-lbl {
    font-size: var(--text-2xs);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
    margin-top: 2px;
}

/* Activity list — mobile: stack stats below the name */
@media (max-width: 600px) {
    .activity-row {
        flex-wrap: wrap;
        align-items: flex-start;
        padding: 12px var(--pad-page);
    }
    .act-card-info {
        flex: 1;
        min-width: 0;
    }
    .activity-tss {
        margin-left: auto;
    }
    .act-card-stats {
        flex-basis: 100%;
        justify-content: space-between;
        margin-top: 8px;
        padding: 8px 0 0;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
    }
    .act-stat {
        flex: 1;
        align-items: center;
        padding: 0 6px;
        min-width: 45px;
    }
}

/* ── Infinite scroll skeleton loader ── */
.act-list-sentinel {
    padding: 8px 0;
}
.act-skeleton-row {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px var(--pad-page);
}
.act-skeleton-icon {
    width: 32px;
    height: 32px;
    border-radius: 6px;
    background: var(--bg-elevated);
    animation: skeletonPulse 1.2s ease-in-out infinite;
}
.act-skeleton-lines {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.act-skeleton-line {
    height: 10px;
    border-radius: 4px;
    background: var(--bg-elevated);
    animation: skeletonPulse 1.2s ease-in-out infinite;
}
.act-skeleton-line--w60 {
    width: 60%;
}
.act-skeleton-line--w40 {
    width: 40%;
}
@keyframes skeletonPulse {
    0%,
    100% {
        opacity: 0.4;
    }
    50% {
        opacity: 0.8;
    }
}

/* ============================================================
   FITNESS PAGE
============================================================ */

/* ── KPI row: 6 cards ── */
.fit-kpi-row {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 12px;
}
.fit-kpi-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 18px 20px 16px;
    position: relative;
    --mouse-x: 50%;
    --mouse-y: 50%;
    transition:
        border-color var(--transition),
        box-shadow var(--transition);
}

/* inner spotlight glow */
.fit-kpi-card::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.055) 0%,
        transparent 65%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
}

/* rim glow — masked to border edge only */
.fit-kpi-card::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 1px;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.35) 0%,
        transparent 60%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
    -webkit-mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
}

.fit-kpi-card:hover {
    border-color: transparent;
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.35);
}
.fit-kpi-card:hover::before,
.fit-kpi-card:hover::after {
    opacity: 1;
}
.fit-kpi-label {
    font-size: var(--text-2xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--text-muted);
    margin-bottom: 6px;
}
.fit-kpi-value {
    font-size: var(--text-2xl);
    font-weight: 800;
    font-family: var(--font-num);
    letter-spacing: -2px;
    line-height: 1;
}
.fit-kpi-name {
    font-size: var(--text-xs);
    color: var(--text-secondary);
    margin-top: 5px;
}
.fit-kpi-hint {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--text-muted);
    margin-top: 3px;
    letter-spacing: 0.03em;
}
.fit-kpi-bar {
    height: 6px;
    background: var(--border);
    border-radius: 2px;
    margin-top: 14px;
    overflow: hidden;
}
.fit-kpi-bar-fill {
    height: 100%;
    border-radius: 2px;
    width: 0;
    transition: width 0.6s ease;
}

/* Fitness KPI colour variants */
.fit-kpi-value--ctl {
    color: var(--accent);
}
.fit-kpi-value--atl {
    color: var(--orange);
}
.fit-kpi-bar-fill--ctl {
    background: var(--accent);
}
.fit-kpi-bar-fill--atl {
    background: var(--orange);
}

/* ── Wellness strip ── */
.fit-wellness-strip {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
}
.fit-wcard {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 16px 18px;
    transition: border-color var(--transition);
}
.fit-wcard:hover {
    border-color: var(--border-active);
}
.fit-wcard-label {
    font-size: var(--text-2xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--text-muted);
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 5px;
}
.fit-wcard-val {
    font-size: var(--text-xl);
    font-weight: 800;
    font-family: var(--font-num);
    letter-spacing: -1.5px;
    line-height: 1;
    color: var(--text-primary);
}
.fit-wcard-sub {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 5px;
}
.fit-wcard-trend {
    font-size: var(--text-base);
    font-weight: 700;
}

/* ── Range pills ── */
.fit-range-pills {
    display: flex;
    gap: 2px;
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 3px;
}
.fit-range-pills button {
    background: none;
    border: none;
    color: var(--text-muted);
    font-size: var(--text-xs);
    font-weight: 600;
    padding: 3px 10px;
    border-radius: 6px;
    cursor: pointer;
    transition: all var(--transition);
}
.fit-range-pills button:hover {
    color: var(--text-primary);
    background: var(--bg-elevated);
}
.fit-range-pills button.active {
    background: var(--bg-elevated);
    color: var(--text-primary);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

/* Chart heights */
.chart-wrap--lg {
    height: 280px;
}
.chart-wrap--md {
    height: 200px;
}

/* ── Activity heatmap ── */
.fit-heatmap-scroll {
    overflow-x: auto;
    padding-bottom: 4px;
    scrollbar-width: none;
    -ms-overflow-style: none;
    min-width: 0;
    width: 100%;
}
.fit-heatmap-scroll::-webkit-scrollbar {
    display: none;
}
.fit-heatmap {
    display: flex;
    gap: 3px;
    align-items: flex-start;
    min-width: max-content;
    padding: 4px 0;
}
.fit-hm-days {
    display: flex;
    flex-direction: column;
    gap: 3px;
    margin-right: 4px;
    margin-top: 18px;
}
.fit-hm-day-label {
    width: 14px;
    height: 12px;
    font-size: var(--text-2xs);
    color: var(--text-muted);
    display: flex;
    align-items: center;
}
.fit-hm-col {
    display: flex;
    flex-direction: column;
    gap: 3px;
}
.fit-hm-month-lbl {
    height: 16px;
    font-size: var(--text-2xs);
    color: var(--text-muted);
    white-space: nowrap;
    margin-bottom: 2px;
}
.fit-hm-cell {
    width: 12px;
    height: 12px;
    border-radius: 2px;
    cursor: default;
    transition: opacity 0.15s;
}
.fit-hm-cell:hover {
    opacity: 0.75;
}
.fit-hm-cell--future {
    background: var(--bg-surface);
    opacity: 0.25;
}
.fit-hm-cell--0 {
    background: var(--bg-elevated);
}
.fit-hm-cell--1 {
    background: rgba(0, 229, 160, 0.18);
}
.fit-hm-cell--2 {
    background: rgba(0, 229, 160, 0.42);
}
.fit-hm-cell--3 {
    background: rgba(0, 229, 160, 0.68);
}
.fit-hm-cell--4 {
    background: var(--accent);
}

/* Heatmap legend (in card-header-controls) */
.fit-hm-legend {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: var(--text-2xs);
    color: var(--text-muted);
}
.fit-hm-swatch {
    width: 10px;
    height: 10px;
    border-radius: 2px;
    flex-shrink: 0;
}
.fit-hm-swatch--0 {
    background: var(--bg-elevated);
}
.fit-hm-swatch--1 {
    background: rgba(0, 229, 160, 0.2);
}
.fit-hm-swatch--2 {
    background: rgba(0, 229, 160, 0.45);
}
.fit-hm-swatch--3 {
    background: rgba(0, 229, 160, 0.68);
}
.fit-hm-swatch--4 {
    background: var(--accent);
}

/* ── Training Calendar + Weekly Load row (equal height) ── */
.fit-cal-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
    align-items: stretch;
}
.fit-card-flex {
    display: flex;
    flex-direction: column;
    min-width: 0;
}
.fit-heatmap-fill {
    flex: 1;
    display: flex;
    align-items: center;
    min-width: 0;
}
.fit-chart-fill {
    flex: 1;
    min-height: 160px;
}

/* ── Monthly table ── */
.fit-monthly-wrap {
    overflow-x: auto;
}
.fit-monthly-table {
    width: 100%;
    border-collapse: collapse;
    font-size: var(--text-sm);
}
.fit-monthly-table thead th {
    text-align: left;
    font-size: var(--text-2xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    padding: 0 10px 10px 0;
    border-bottom: 1px solid var(--border);
}
.fit-monthly-table tbody tr {
    border-bottom: 1px solid var(--border);
    transition: background var(--transition);
}
.fit-monthly-table tbody tr:last-child {
    border-bottom: none;
}
.fit-monthly-table tbody tr:hover {
    background: var(--bg-elevated);
}
.fit-monthly-table td {
    padding: 10px 10px 10px 0;
    color: var(--text-secondary);
    font-variant-numeric: tabular-nums;
}
.fit-month-label {
    color: var(--text-primary) !important;
    font-weight: 600;
}
.fit-tss-cell {
    color: var(--accent) !important;
    font-weight: 700;
    font-family: var(--font-num);
}

/* ── Responsive ── */
@media (max-width: 1100px) {
    .fit-kpi-row {
        grid-template-columns: repeat(3, 1fr);
    }
}
@media (max-width: 900px) {
    .fit-kpi-row {
        grid-template-columns: repeat(3, 1fr);
    }
    .fit-wellness-strip {
        grid-template-columns: repeat(2, 1fr);
    }
    .fit-cal-row {
        grid-template-columns: 1fr;
    }
}
@media (max-width: 600px) {
    .fit-kpi-row {
        grid-template-columns: repeat(2, 1fr);
    }
    .fit-wellness-strip {
        grid-template-columns: repeat(2, 1fr);
    }
    .fit-hm-legend {
        display: none;
    }
}

/* ============================================================
   SETTINGS PAGE
============================================================ */
.settings-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--gap-layout);
    align-items: start;
}
.settings-col {
    display: flex;
    flex-direction: column;
    gap: var(--gap-layout);
}
@media (max-width: 860px) {
    .settings-grid {
        grid-template-columns: 1fr;
    }
}
@media (max-width: 480px) {
    .settings-grid,
    .settings-col,
    .settings-grid .card {
        max-width: 100%;
        overflow: hidden;
    }
    .stt-row {
        gap: 8px;
        padding: 8px 8px;
    }
    .stt-row--control {
        flex-wrap: wrap;
    }
    .stt-row--control .stt-row-info {
        min-width: 0;
    }
    .stt-section-header {
        gap: 8px;
        flex-wrap: wrap;
    }
    .map-theme-picker {
        padding: 8px 6px;
        gap: 6px;
    }
    .map-theme-swatch {
        width: 40px;
        height: 28px;
    }
    .wx-location-input-row {
        flex-wrap: wrap;
    }
    .connection-status-badge {
        max-width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .stt-actions {
        flex-wrap: wrap;
    }
}

/* ── Section header (icon + title + optional badge) ── */
.stt-section-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 12px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 0;
}
.stt-section-icon {
    width: 18px !important;
    height: 18px !important;
    min-width: 18px;
    max-width: 18px;
    flex-shrink: 0;
    stroke: var(--accent);
    opacity: 0.85;
    display: block;
    overflow: visible;
}
.stt-section-title {
    font-size: var(--text-base);
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1.2;
}
.stt-section-sub {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 2px;
}
.stt-section-header > *:last-child {
    margin-left: auto;
}
.stt-section-header > div {
    flex: 1;
}
.stt-section-header > .connection-status-badge {
    flex: 0 0 auto;
}

/* ── Subsection divider & header (used inside merged cards) ── */
.stt-subsection-divider {
    height: 1px;
    background: var(--border);
    margin: 14px 12px 0;
}
.stt-subsection-header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 12px 4px;
}
.stt-subsection-title {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-secondary);
    letter-spacing: 0.02em;
}

/* ── Flat row list ── */
.stt-rows {
    display: flex;
    flex-direction: column;
}
.stt-row {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px 12px;
    border-bottom: 1px solid var(--border);
}
.stt-row:last-child {
    border-bottom: none;
}
.stt-row-label {
    font-size: var(--text-base);
    font-weight: 500;
    color: var(--text-primary);
    flex: 1;
}
.stt-row-sub {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 2px;
}
.stt-row-value {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    font-family: var(--font-num);
    background: var(--bg-elevated);
    padding: 3px 9px;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    white-space: nowrap;
    flex-shrink: 0;
    max-width: 55%;
    overflow: hidden;
    text-overflow: ellipsis;
}
.stt-row-info {
    flex: 1;
    min-width: 0;
}

/* Rows with a right-side control (pill, select, input) */
.stt-row--control {
    flex-wrap: wrap;
    gap: 10px;
}
.stt-row--control .stt-row-info {
    min-width: 140px;
}

/* Rows with a toggle on the right */
.stt-row--toggle {
    gap: 16px;
}

/* ── Avatar row ── */
.stt-avatar-row {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 10px 12px;
    border-bottom: 1px solid var(--border);
}
.stt-avatar-info {
    flex: 1;
}
.stt-avatar-info .stt-row-label {
    font-size: var(--text-md);
    font-weight: 600;
}

/* ── Actions row ── */
.stt-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    padding: 8px 12px;
    border-top: 1px solid var(--border);
}

/* ── About footer ── */
.stt-about {
    display: flex;
    align-items: flex-start;
    gap: 8px;
    font-size: var(--text-xs);
    color: var(--text-muted);
    line-height: 1.6;
    padding: 4px 2px;
}
.stt-about svg {
    flex-shrink: 0;
    margin-top: 2px;
    opacity: 0.6;
}

/* ── Storage bar ── */
.stg-bar-wrap {
    padding: 14px 14px 10px;
}
.stg-bar-track {
    height: 18px;
    border-radius: 9px;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    display: flex;
    overflow: hidden;
}
.stg-seg {
    height: 100%;
    min-width: 2px;
    transition: width 0.4s ease;
}
.stg-seg:first-child {
    border-radius: 8px 0 0 8px;
}
.stg-seg:last-child {
    border-radius: 0 8px 8px 0;
}
.stg-seg:only-child {
    border-radius: 8px;
}
.stg-bar-label {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 6px;
    font-family: var(--font-num);
    text-align: right;
}
.stg-bar-legend {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 8px;
}
.stg-legend-item {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: var(--text-xs);
    color: var(--text-secondary);
    font-family: var(--font-num);
}
.stg-legend-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
}

/* ── Map theme picker (inline in card body) ── */
.map-theme-picker {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    padding: 10px 12px;
}
.map-theme-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    background: none;
    border: 2px solid var(--border);
    border-radius: var(--radius);
    padding: 6px;
    cursor: pointer;
    transition:
        border-color 0.15s,
        transform 0.1s;
}
.map-theme-option:hover {
    border-color: var(--border-active);
    transform: translateY(-1px);
}
.map-theme-option.active {
    border-color: var(--accent);
    box-shadow: 0 0 0 1px var(--accent);
}
.map-theme-swatch {
    display: block;
    width: 52px;
    height: 36px;
    border-radius: var(--radius-sm);
    border: 1px solid rgba(255, 255, 255, 0.08);
}
.map-theme-label {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--text-muted);
    letter-spacing: 0.02em;
}
.map-theme-option.active .map-theme-label {
    color: var(--accent);
}

/* ── Font picker ── */
.font-picker {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    padding: 10px 12px;
}
.font-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    background: none;
    border: 2px solid var(--border);
    border-radius: var(--radius);
    padding: 6px;
    cursor: pointer;
    transition:
        border-color 0.15s,
        transform 0.1s;
}
.font-option:hover {
    border-color: var(--border-active);
    transform: translateY(-1px);
}
.font-option.active {
    border-color: var(--accent);
    box-shadow: 0 0 0 1px var(--accent);
}
.font-preview {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 52px;
    height: 36px;
    border-radius: var(--radius-sm);
    background: var(--bg-card);
    border: 1px solid rgba(255, 255, 255, 0.08);
    font-size: 18px;
    font-weight: 600;
    color: var(--text-primary);
    letter-spacing: -0.02em;
}
.font-option-label {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--text-muted);
    letter-spacing: 0.02em;
}
.font-option.active .font-option-label {
    color: var(--accent);
}

/* ── iOS toggle switch ── */
.settings-ios-toggle {
    position: relative;
    display: inline-block;
    width: 44px;
    height: 26px;
    flex-shrink: 0;
    cursor: pointer;
}
.settings-ios-toggle input {
    opacity: 0;
    width: 0;
    height: 0;
    position: absolute;
}
.settings-ios-slider {
    position: absolute;
    inset: 0;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 26px;
    transition:
        background 0.2s ease,
        border-color 0.2s ease;
}
.settings-ios-slider::before {
    content: "";
    position: absolute;
    width: 20px;
    height: 20px;
    left: 2px;
    top: 2px;
    background: var(--text-muted);
    border-radius: 50%;
    transition:
        transform 0.2s ease,
        background 0.2s ease;
}
.settings-ios-toggle input:checked + .settings-ios-slider {
    background: var(--accent);
    border-color: var(--accent);
}
.settings-ios-toggle input:checked + .settings-ios-slider::before {
    transform: translateX(18px);
    background: #fff;
}

/* ── Connection badge ── */
.connection-status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: var(--text-sm);
    font-weight: 600;
    flex-shrink: 0;
    flex: 0 0 auto;
}
.connection-status-badge.connected {
    background: var(--accent-dim);
    color: var(--accent);
}
.connection-status-badge.disconnected {
    background: var(--red-dim);
    color: var(--red);
}

/* ── Shared helpers ── */
.avatar-preview-wrap {
    position: relative;
    flex-shrink: 0;
}
.avatar-preview {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), var(--blue));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--bg-base);
    overflow: hidden;
    border: 2px solid var(--border);
}
.avatar-edit-btn {
    position: absolute;
    bottom: -2px;
    right: -2px;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--accent);
    border: 2px solid var(--bg-elevated);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background var(--transition);
}
.avatar-edit-btn:hover {
    background: var(--text-primary);
}
.avatar-edit-btn svg {
    width: 10px;
    height: 10px;
    stroke: var(--bg-base);
}
.btn-sm {
    padding: 4px 10px;
    font-size: var(--text-sm);
}

/* ============================================================
   LOADING & TOAST
============================================================ */
.loading-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(13, 15, 20, 0.8);
    z-index: 400;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 12px;
}
.loading-overlay.active {
    display: flex;
}
.spinner {
    width: 36px;
    height: 36px;
    border: 3px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
}
.spinner-sm {
    width: 14px;
    height: 14px;
    border-width: 2px;
    border-top-color: var(--bg-base);
}
@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}
.loading-text {
    font-size: var(--text-base);
    color: var(--text-secondary);
}
.toast-container {
    position: fixed;
    bottom: 28px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 600;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    pointer-events: none;
}
.toast {
    pointer-events: all;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 9px 16px 9px 12px;
    border-radius: 999px;
    font-size: var(--text-sm);
    font-weight: 500;
    white-space: nowrap;
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    box-shadow:
        0 4px 24px rgba(0, 0, 0, 0.35),
        0 1px 0 rgba(255, 255, 255, 0.04) inset;
    animation: toastIn 0.28s cubic-bezier(0.34, 1.56, 0.64, 1);
    background: color-mix(in srgb, var(--bg-elevated) 90%, transparent);
    border: 1px solid var(--border);
    color: var(--text-primary);
}
.toast-icon {
    width: 18px;
    height: 18px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
}
.toast-icon svg {
    width: 16px;
    height: 16px;
    stroke-width: 2.5;
}
.toast.success .toast-icon svg {
    stroke: #22c55e;
}
.toast.error .toast-icon svg {
    stroke: var(--red);
}
.toast.info .toast-icon svg {
    stroke: var(--blue);
}
.toast.success {
    border-color: #22c55e30;
}
.toast.error {
    border-color: color-mix(in srgb, var(--red) 30%, transparent);
}
.toast.info {
    border-color: color-mix(in srgb, var(--blue) 30%, transparent);
}
@keyframes toastIn {
    from {
        opacity: 0;
        transform: translateY(10px) scale(0.92);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* ============================================================
   EMPTY STATE
============================================================ */
.empty-state {
    text-align: center;
    padding: 48px 20px;
    color: var(--text-muted);
}
.empty-state--xl {
    padding: 60px 20px;
}
.empty-state svg {
    width: 40px;
    height: 40px;
    margin: 0 auto 12px;
    opacity: 0.35;
}
.empty-state p {
    font-size: var(--text-base);
    line-height: 1.5;
}
.empty-state .btn {
    margin: 16px auto 0;
}

/* ============================================================
   PAGE VISIBILITY
============================================================ */
.page {
    display: none;
}
.page.active {
    display: contents;
}

.dash-top-spacer {
    height: 80px;
}

@keyframes pageFadeIn {
    from {
        opacity: 0;
        transform: translateY(8px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ── Shimmer skeleton ── */
@keyframes shimmer {
    0% {
        background-position: -200% 0;
    }
    100% {
        background-position: 200% 0;
    }
}
.skeleton {
    border-radius: 6px;
    background: linear-gradient(
        90deg,
        var(--bg-elevated) 25%,
        color-mix(in srgb, var(--bg-elevated) 60%, var(--text-muted)) 50%,
        var(--bg-elevated) 75%
    );
    background-size: 200% 100%;
    animation: shimmer 1.4s ease-in-out infinite;
}

/* ── Badge shine sweep ── */
@keyframes badgeShine {
    0% {
        left: -120%;
        opacity: 0;
    }
    15% {
        opacity: 1;
    }
    60% {
        left: 120%;
        opacity: 0.6;
    }
    100% {
        left: 120%;
        opacity: 0;
    }
}
.stk-badge--earned.badge-shine-play::after {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(
        110deg,
        transparent 30%,
        rgba(255, 255, 255, 0.45) 50%,
        transparent 70%
    );
    width: 60%;
    top: 0;
    bottom: 0;
    animation: badgeShine 0.7s ease-out forwards;
    pointer-events: none;
    z-index: 10;
    border-radius: inherit;
    overflow: hidden;
}

/* ── Odometer roll ── */
@keyframes odometerIn {
    from {
        transform: translateY(60%);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}
.stk-stat-val.odometer-play {
    display: inline-block;
    animation: odometerIn 0.45s cubic-bezier(0.22, 1, 0.36, 1) both;
}

/* ── Route trace draw-on ── */
.route-trace-line {
    stroke-dasharray: var(--route-len, 10000);
    stroke-dashoffset: var(--route-len, 10000);
    animation: routeDraw 1.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}
@keyframes routeDraw {
    to {
        stroke-dashoffset: 0;
    }
}
.page.active > * {
    animation: pageFadeIn 0.22s ease-out both;
}
/* Dashboard section wrappers */
[data-dash-section].dash-hidden {
    display: none !important;
}
[data-dash-section="weeklyStats"] {
    margin-top: 24px;
}

/* ============================================================
   CALENDAR PAGE
============================================================ */
/* Full-height mode: strip page-content padding when calendar is active */
.page-content--calendar,
.page-content--heatmap {
    padding: 0 !important;
    gap: 0 !important;
}
.page-content--heatmap .page-headline {
    display: none;
}

/* Shell is fixed, sits below the topbar */
.cal-shell {
    position: fixed;
    left: var(--sidebar-w);
    right: 0;
    top: calc(48px + env(safe-area-inset-top));
    bottom: 0;
    z-index: 100;
    display: flex;
    flex-direction: column;
    background: var(--bg-card);
    overflow: hidden;
}

/* ── Header (nav + month stats) ── */
.cal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 13px 20px;
    border-bottom: 1px solid var(--border);
    background: var(--bg-surface);
    flex-shrink: 0;
    gap: 12px;
    flex-wrap: wrap;
}
.cal-header-nav {
    display: flex;
    align-items: center;
    gap: 4px;
}
.cal-panel-toggle {
    opacity: 0.6;
    transition: opacity 0.2s ease;
}
.cal-panel-toggle:hover {
    opacity: 1;
}
.cal-panel-toggle.active {
    opacity: 1;
    color: var(--accent);
}
.cal-month-title {
    font-size: var(--text-lg);
    font-weight: 800;
    letter-spacing: -0.4px;
    color: var(--text-primary);
    min-width: 168px;
    text-align: center;
}
.cal-today-btn {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--accent);
    background: var(--accent-dim);
    border: 1px solid rgba(0, 229, 160, 0.18);
    border-radius: 20px;
    padding: 4px 13px;
    cursor: pointer;
    margin-left: 6px;
    transition:
        background var(--transition),
        border-color var(--transition);
}
.cal-today-btn:hover {
    background: rgba(0, 229, 160, 0.22);
    border-color: var(--accent);
}

/* Month stats strip — above month grid */
.cal-stats-strip {
    display: flex;
    align-items: stretch;
    border-bottom: 1px solid var(--border);
    background: var(--bg-elevated);
}
.cal-hstat {
    display: flex;
    flex-direction: column;
    justify-content: center;
    flex: 1;
    padding: 13px 16px;
    gap: 1px;
}
.cal-hstat-div {
    width: 1px;
    background: var(--border);
    align-self: stretch;
}
.cal-hstat-val {
    font-size: var(--text-base);
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1.15;
}
.cal-hstat-label {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: var(--text-2xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--text-muted);
}
.cal-hstat-label svg {
    width: 11px;
    height: 11px;
    flex-shrink: 0;
    opacity: 0.7;
}

/* ── Horizontal body: left = grid, right = day panel ── */
.cal-body {
    flex: 1;
    display: flex;
    flex-direction: row;
    min-height: 0;
    overflow: hidden;
}
.cal-left {
    flex: 1; /* fills remaining space */
    display: flex;
    flex-direction: column;
    min-width: 0;
    overflow: hidden;
    border-right: 1px solid var(--border);
}
.cal-day-panel {
    width: 320px;
    flex: none;
    transition:
        width 0.25s ease,
        opacity 0.2s ease;
    overflow: hidden;
}
.cal-body--panel-hidden .cal-day-panel {
    width: 0;
    opacity: 0;
    pointer-events: none;
}
.cal-body--panel-hidden .cal-left {
    border-right: none;
    flex: 1;
}

/* ── Day-of-week strip ── */
.cal-dow-row {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    border-bottom: 1px solid var(--border);
    background: var(--bg-surface);
    flex-shrink: 0;
}
.cal-dow-row > div {
    padding: 7px 0;
    text-align: center;
    font-size: var(--text-2xs);
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
}
.cal-dow--weekend {
    opacity: 0.45;
}

/* ── Calendar grid ── */
.cal-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    grid-auto-rows: 1fr;
    flex: 1;
    min-height: 0;
}

/* ── Compact iOS-style day cells ── */
.cal-day {
    border-right: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
    padding: 6px 2px 5px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    cursor: pointer;
    transition: background var(--transition);
    gap: 4px;
    overflow: hidden;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
}
.cal-day:nth-child(7n) {
    border-right: none;
}
.cal-day:hover {
    background: var(--bg-elevated);
}
.cal-day:active {
    background: var(--bg-card);
}
.cal-day--other-month {
    background: var(--bg-base);
}
.cal-day--other-month:hover {
    background: var(--bg-base);
}
.cal-day--other-month .cal-day-num {
    opacity: 0.22;
}
.cal-day--weekend:not(.cal-day--other-month) {
    background: rgba(255, 255, 255, 0.013);
}

/* Day number circle */
.cal-day-num {
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--text-secondary);
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    flex-shrink: 0;
    line-height: 1;
    transition:
        background var(--transition),
        color var(--transition);
}
/* Today: filled green circle */
.cal-day--today .cal-day-num {
    background: var(--accent);
    color: #0d0f14;
    font-weight: 800;
}
/* Selected (not today): white/light circle */
.cal-day--selected:not(.cal-day--today) .cal-day-num {
    background: var(--text-primary);
    color: var(--bg-base);
    font-weight: 700;
}
/* Selected today: brighter accent */
.cal-day--selected.cal-day--today .cal-day-num {
    box-shadow: 0 0 0 3px rgba(0, 229, 160, 0.35);
}

/* Activity dot indicators */
.cal-dots {
    display: flex;
    gap: 3px;
    justify-content: center;
    align-items: center;
    min-height: 6px;
}
.cal-dot {
    width: 5px;
    height: 5px;
    border-radius: 50%;
    flex-shrink: 0;
    opacity: 0.9;
}
.cal-dot.cal-event--ride {
    background: var(--accent);
}
.cal-dot.cal-event--run {
    background: var(--orange);
}
.cal-dot.cal-event--swim {
    background: var(--blue);
}
.cal-dot.cal-event--virtual {
    background: var(--purple);
}
.cal-dot.cal-event--other {
    background: var(--text-muted);
}

/* Heart rate pill — bottom-centre of day cell, desktop only */
.cal-day-hr {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 3px;
    margin-top: auto;
    font-size: var(--text-sm);
    font-weight: 500;
    font-family: var(--font-num);
    color: var(--text-secondary);
    line-height: 1;
    padding-bottom: 5px;
}
.cal-day-hr svg {
    width: 11px;
    height: 11px;
    color: #f87171;
    flex-shrink: 0;
}
.cal-day-hr--muted {
    color: var(--text-muted);
    opacity: 0.45;
}
.cal-day-hr--muted svg {
    color: var(--text-muted);
}
@media (max-width: 700px) {
    .cal-day-hr {
        display: none;
    }
}
/* Mute dots on other-month days */
.cal-day--other-month .cal-dot {
    opacity: 0.25;
}

/* ── Desktop: mini activity cards — styled like dashboard .activity-row ── */
.cal-day-cards {
    display: flex;
    flex-direction: column;
    gap: 3px;
    width: 100%;
    min-width: 0;
    overflow: hidden;
    flex: 1;
}
.cal-day-card {
    display: flex;
    flex-direction: column;
    gap: 2px;
    border-radius: 8px;
    padding: 4px 6px 4px 5px;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    overflow: hidden;
    flex-shrink: 0;
    cursor: pointer;
    transition:
        border-color 0.15s ease,
        transform 0.15s ease,
        box-shadow 0.15s ease;
}
.cal-day-card:hover {
    border-color: var(--border-active);
    transform: translateY(-1px);
    box-shadow: 0 4px 14px rgba(0, 0, 0, 0.28);
}
.cal-day-card:active {
    transform: translateY(0);
    box-shadow: none;
}

/* Row 1: icon box + stats */
.cal-day-card-top {
    display: flex;
    align-items: center;
    gap: 5px;
    overflow: hidden;
}

/* Coloured icon box — mini .activity-type-icon */
.cal-card-icon-box {
    width: 20px;
    height: 20px;
    border-radius: 6px;
    background: var(--accent-dim);
    color: var(--accent);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}
.cal-card-icon-box.run {
    background: var(--orange-dim);
    color: var(--orange);
}
.cal-card-icon-box.swim {
    background: var(--blue-dim);
    color: var(--blue);
}
.cal-card-icon-box.virtual {
    background: var(--purple-dim);
    color: var(--purple);
}
.cal-card-icon-box.other {
    background: rgba(136, 145, 168, 0.1);
    color: var(--text-muted);
}
.cal-card-icon {
    display: block;
}

/* Bold numeric stats — mirrors .act-stat-val */
.cal-day-card-stats {
    font-size: 11px;
    font-weight: 800;
    font-family: var(--font-num);
    letter-spacing: -0.3px;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2;
    flex: 1;
    min-width: 0;
}

/* SVG intensity bar icon */
.cal-intensity {
    flex-shrink: 0;
    margin-left: 3px;
    display: block;
    align-self: center;
    overflow: visible;
}

/* Row 2: muted name — mirrors .act-card-sub */
.cal-day-card-name {
    font-size: 9.5px;
    font-weight: 500;
    color: var(--text-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2;
    padding-left: 25px; /* align under stats text, clearing icon+gap */
}
.cal-day-more {
    font-size: 9px;
    font-weight: 700;
    color: var(--text-muted);
    padding: 1px 4px;
    opacity: 0.6;
}

/* Indoor / Outdoor tag */
.cal-env-tag {
    display: inline-block;
    font-size: 8px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    border-radius: 3px;
    padding: 0px 3px;
    margin-right: 4px;
    vertical-align: middle;
    flex-shrink: 0;
}
.cal-env-tag--indoor {
    background: rgba(160, 120, 255, 0.15);
    color: var(--purple);
    border: 1px solid rgba(160, 120, 255, 0.3);
}
.cal-env-tag--outdoor {
    background: rgba(0, 229, 160, 0.1);
    color: var(--accent);
    border: 1px solid rgba(0, 229, 160, 0.25);
}
/* Mute cards on other-month days */
.cal-day--other-month .cal-day-card {
    opacity: 0.25;
}
/* Default (desktop): show cards, hide dots */
.cal-dots {
    display: none;
}
.cal-day-cards {
    display: flex;
}

/* ── Right panel: selected day's activities ── */
.cal-day-panel {
    display: flex;
    flex-direction: column;
    min-height: 0;
    overflow: hidden;
    background: var(--bg-surface);
}
.cal-day-panel-header {
    padding: 11px 18px 9px;
    font-size: var(--text-sm);
    font-weight: 700;
    color: var(--text-primary);
    letter-spacing: -0.2px;
    border-bottom: 1px solid var(--border);
    flex-shrink: 0;
    background: var(--bg-surface);
}
.cal-day-panel-list {
    flex: 1;
    overflow-y: auto;
    padding: 4px 0;
}

/* Activity rows in day panel */
.cal-list-item {
    display: flex;
    align-items: center;
    gap: 13px;
    padding: 10px 18px;
    cursor: pointer;
    transition: background var(--transition);
    border-bottom: 1px solid var(--border);
    -webkit-tap-highlight-color: transparent;
}
.cal-list-item:last-child {
    border-bottom: none;
}
.cal-list-item:hover {
    background: var(--bg-elevated);
}
.cal-list-item:active {
    background: var(--bg-card);
}
.cal-list-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    flex-shrink: 0;
}
.cal-list-dot.cal-event--ride {
    background: var(--accent);
}
.cal-list-dot.cal-event--run {
    background: var(--orange);
}
.cal-list-dot.cal-event--swim {
    background: var(--blue);
}
.cal-list-dot.cal-event--virtual {
    background: var(--purple);
}
.cal-list-dot.cal-event--other {
    background: var(--text-muted);
}
.cal-list-info {
    flex: 1;
    min-width: 0;
}
.cal-list-name {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.cal-list-meta {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 2px;
}
.cal-list-tss {
    font-size: var(--text-xs);
    font-weight: 700;
    color: var(--text-muted);
    flex-shrink: 0;
    white-space: nowrap;
}
/* Chevron arrow for list items */
.cal-list-chevron {
    color: var(--text-muted);
    opacity: 0.4;
    flex-shrink: 0;
}
/* Empty / rest day state */
.cal-day-empty {
    padding: 28px 18px;
    text-align: center;
    color: var(--text-muted);
    font-size: var(--text-sm);
    font-style: italic;
}

/* ============================================================
   ACTIVITY DETAIL PAGE
============================================================ */

/* ── Colour-mode toggle bar ─────────────────────────────── */
.map-color-toggles {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    padding: 0 0 10px 0;
    min-height: 0; /* collapses if JS hasn't populated it yet */
}
.map-mode-btn {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 4px 11px 4px 9px;
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.12);
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-muted);
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.03em;
    cursor: pointer;
    transition:
        background 0.15s,
        color 0.15s,
        border-color 0.15s;
    white-space: nowrap;
}
.map-mode-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-primary);
    border-color: rgba(255, 255, 255, 0.22);
}
.map-mode-btn.active {
    background: rgba(0, 200, 122, 0.18);
    border-color: #00c87a;
    color: #00e5a0;
}
/* Per-mode accent colours when active */
.map-mode-btn.active[data-mode="hr"] {
    background: rgba(239, 68, 68, 0.15);
    border-color: #f87171;
    color: #fca5a5;
}
.map-mode-btn.active[data-mode="speed"] {
    background: rgba(30, 58, 138, 0.35);
    border-color: #3b82f6;
    color: #93c5fd;
}
.map-mode-btn.active[data-mode="power"] {
    background: rgba(251, 146, 60, 0.18);
    border-color: #f97316;
    color: #fdba74;
}
.map-mode-btn.active[data-mode="altitude"] {
    background: rgba(124, 58, 237, 0.18);
    border-color: #7c3aed;
    color: #c4b5fd;
}
.map-mode-icon {
    font-size: 10px;
    opacity: 0.85;
}
/* Satellite layer toggle — same pill shape, pushed to the far right */
.map-layer-btn {
    margin-left: auto;
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 4px 11px 4px 9px;
    font-size: 11px;
    font-weight: 600;
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.13);
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-muted);
    cursor: pointer;
    transition:
        background 0.15s,
        color 0.15s,
        border-color 0.15s;
    white-space: nowrap;
}
.map-layer-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-primary);
    border-color: rgba(255, 255, 255, 0.22);
}
.map-layer-btn.active {
    background: rgba(251, 191, 36, 0.15);
    border-color: #fbbf24;
    color: #fde68a;
}

/* Leaflet cursor fixes */
.leaflet-container {
    cursor: grab !important;
}
.leaflet-dragging .leaflet-container,
.leaflet-dragging .leaflet-container * {
    cursor: grabbing !important;
}
/* Prevent zoom cursor from getting stuck after scroll-wheel zoom */
.leaflet-container.leaflet-zoom-anim,
.leaflet-container:not(.leaflet-dragging) {
    cursor: grab !important;
}

/* Leaflet zoom controls — dark theme override */
.leaflet-bar {
    border: 1px solid rgba(255, 255, 255, 0.13) !important;
    box-shadow: 0 1px 5px rgba(0, 0, 0, 0.5) !important;
    border-radius: 8px !important;
    overflow: hidden;
}
.leaflet-bar a,
.leaflet-bar a:hover {
    background: rgba(20, 23, 32, 0.82) !important;
    -webkit-backdrop-filter: blur(4px);
    backdrop-filter: blur(4px);
    color: var(--text-secondary) !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
    width: 30px !important;
    height: 30px !important;
    line-height: 30px !important;
    font-size: 16px !important;
    font-weight: 400 !important;
    transition:
        background 0.15s,
        color 0.15s;
}
.leaflet-bar a:last-child {
    border-bottom: none !important;
}
.leaflet-bar a:hover {
    background: rgba(37, 43, 58, 0.95) !important;
    color: var(--text-primary) !important;
}
.leaflet-bar a.leaflet-disabled {
    opacity: 0.35 !important;
    cursor: default !important;
}

/* Satellite toggle — Leaflet in-map control */
.map-sat-control {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 4px 11px 4px 9px;
    font-size: 11px;
    font-weight: 600;
    font-family: var(--font-ui);
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.13);
    background: rgba(20, 23, 32, 0.82);
    color: var(--text-primary);
    cursor: pointer !important;
    box-shadow: 0 1px 5px rgba(0, 0, 0, 0.5);
    -webkit-backdrop-filter: blur(4px);
    backdrop-filter: blur(4px);
    transition:
        background 0.15s,
        color 0.15s,
        border-color 0.15s;
    white-space: nowrap;
    margin-bottom: 8px;
}
.map-sat-control:hover {
    background: rgba(37, 43, 58, 0.92);
    color: var(--text-primary);
    border-color: rgba(255, 255, 255, 0.22);
}
.map-sat-control.active {
    background: rgba(251, 191, 36, 0.15);
    border-color: #fbbf24;
    color: #fde68a;
}

.map-recentre-control {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    border: 1px solid rgba(255, 255, 255, 0.13);
    background: rgba(20, 23, 32, 0.82);
    color: var(--text-primary);
    cursor: pointer !important;
    box-shadow: 0 1px 5px rgba(0, 0, 0, 0.5);
    -webkit-backdrop-filter: blur(4px);
    backdrop-filter: blur(4px);
    transition:
        background 0.15s,
        border-color 0.15s,
        color 0.15s;
    margin-top: 8px;
    margin-right: 8px;
}
.map-recentre-control:hover {
    background: rgba(37, 43, 58, 0.92);
    border-color: rgba(255, 255, 255, 0.22);
    color: #fff;
}
.map-recentre-control:active {
    background: rgba(255, 255, 255, 0.08);
}

/* ── Flythrough bar ───────────────────────────────────── */
.flythrough-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 9px 0 11px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 2px;
}
.ft-play-btn {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--accent);
    color: #000;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition:
        background var(--transition),
        transform var(--transition),
        box-shadow var(--transition);
}
.ft-play-btn:hover {
    background: #00ffb3;
    transform: scale(1.08);
    box-shadow: 0 0 12px rgba(0, 229, 160, 0.45);
}
.ft-play-btn:active {
    transform: scale(0.95);
}

/* Scrubber */
.ft-scrubber-track {
    flex: 1;
    height: 4px;
    background: var(--border);
    border-radius: 2px;
    position: relative;
    cursor: pointer;
    padding: 8px 0;
    margin: -8px 0;
    box-sizing: content-box;
}
.ft-scrubber-fill {
    position: absolute;
    top: 8px;
    left: 0;
    height: 4px;
    background: var(--accent);
    border-radius: 2px;
    width: 0;
    pointer-events: none;
    transition: width 0.05s linear;
}
.ft-scrubber-thumb {
    position: absolute;
    top: 50%;
    left: 0;
    transform: translate(-50%, -50%);
    width: 13px;
    height: 13px;
    border-radius: 50%;
    background: var(--accent);
    border: 2.5px solid var(--bg-card);
    pointer-events: none;
    transition:
        transform 0.1s,
        left 0.05s linear;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.5);
}
.ft-scrubber-track:hover .ft-scrubber-thumb {
    transform: translate(-50%, -50%) scale(1.35);
}

/* Follow / speed controls */
.ft-follow-btn {
    width: 30px;
    height: 30px;
    border-radius: 8px;
    background: none;
    border: 1px solid var(--border);
    color: var(--text-muted);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: all var(--transition);
}
.ft-follow-btn:hover,
.ft-follow-btn.active {
    border-color: var(--accent);
    color: var(--accent);
    background: var(--accent-dim);
}

/* Pulsing flythrough dot */
.ft-dot-wrap {
    width: 14px;
    height: 14px;
    position: relative;
}
.ft-dot-core {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: #00e5a0;
    border: 2.5px solid #fff;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);
    position: relative;
    z-index: 1;
}
.ft-dot-ring {
    position: absolute;
    inset: -5px;
    border-radius: 50%;
    border: 2px solid rgba(0, 229, 160, 0.7);
    animation: ft-pulse 1.3s ease-out infinite;
    pointer-events: none;
}
@keyframes ft-pulse {
    0% {
        transform: scale(1);
        opacity: 0.85;
    }
    100% {
        transform: scale(2.6);
        opacity: 0;
    }
}

/* Route map + hover stats layout */
.map-with-stats {
    display: flex;
    gap: 16px;
    align-items: stretch;
    min-height: 320px; /* floor — panel content drives the actual height */
    position: relative;
}
.activity-map {
    flex: 1 1 auto;
    min-width: 0;
    min-height: 200px; /* hard floor — map never collapses below this */
    /* no fixed height: flexbox stretches to match the panel height */
    isolation: isolate; /* confine Leaflet's z-indices so they don't bleed over the sidebar */
    border-radius: var(--radius);
    overflow: hidden;
    background: var(
        --bg-elevated
    ); /* overridden inline by JS to match active map theme */
    cursor: crosshair;
}

/* Expand button in card header */
.map-expand-btn {
    margin-left: auto;
    padding: 4px 6px;
    opacity: 0.6;
    transition: opacity 0.15s;
}
.map-expand-btn:hover {
    opacity: 1;
}

/* Close button — only visible in fullscreen */
.map-close-btn {
    display: none;
}
.map-fullscreen .map-close-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 12px;
    right: 12px;
    z-index: 10;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--bg-card);
    border: 1px solid var(--border);
    color: var(--text-primary);
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    transition:
        background 0.15s,
        transform 0.15s;
}
.map-fullscreen .map-close-btn:hover {
    background: var(--bg-elevated);
    transform: scale(1.1);
}
.map-fullscreen .map-expand-btn {
    display: none;
}

/* Fullscreen map */
.map-fullscreen {
    position: fixed;
    inset: 0;
    z-index: 9999;
    margin: 0;
    border-radius: 0;
    display: flex;
    flex-direction: column;
    overflow: auto;
}
.map-fullscreen .card-header {
    flex-shrink: 0;
    border-radius: 0;
}
.map-fullscreen .map-color-toggles {
    flex-shrink: 0;
}
.map-fullscreen .flythrough-bar {
    flex-shrink: 0;
}
.map-fullscreen .map-with-stats {
    flex: 1;
    min-height: 0;
    flex-direction: column;
}
.map-fullscreen .activity-map {
    flex: 1;
    min-height: 0;
    border-radius: 12px;
    margin: 6px 6px 0;
}
/* In fullscreen the stats panel hides — data moves to fs-bottom-left */
.map-fullscreen .map-stats-panel {
    display: none;
}

/* ── Fullscreen bottom row: stats left, chart right ── */
.fs-bottom-row {
    display: none;
    flex-shrink: 0;
}
.map-fullscreen .fs-bottom-row {
    display: flex;
    gap: 6px;
    padding: 6px 6px 6px;
    border-top: 1px solid var(--border);
}
.fs-bottom-left,
.fs-bottom-right {
    flex: 1 1 50%;
    min-width: 0;
    background: rgba(15, 23, 42, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: 10px;
    padding: 8px 10px 6px;
}

/* Left panel: gauge + metrics */
.fs-bottom-left {
    display: flex;
    flex-direction: row;
    align-items: stretch;
    gap: 8px;
}
.fs-bottom-left .speed-gauge {
    width: 100px;
    flex-shrink: 0;
    align-self: center;
}
.fs-bottom-left .map-metrics {
    flex: 1;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2px;
}
.fs-bottom-left .mm-cell {
    padding: 3px 6px 4px;
}

/* Right panel: mini sparkline chart — hidden until streams loaded */
.fs-bottom-right {
    display: none;
}
.map-fullscreen .fs-bottom-right.mc-ready {
    display: block;
}

.fs-mini-chart-header {
    display: flex;
    align-items: center;
    margin-bottom: 4px;
}
.fs-mini-toggles {
    display: flex;
    gap: 4px;
    flex-wrap: wrap;
}
.fs-mini-tog {
    font-size: 10px;
    font-weight: 600;
    padding: 2px 7px;
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.12);
    background: transparent;
    color: var(--text-secondary, #94a3b8);
    cursor: pointer;
    transition: all 0.15s;
    line-height: 1.3;
}
.fs-mini-tog.active {
    color: #fff;
    border-color: var(--sc);
    background: color-mix(in srgb, var(--sc) 22%, transparent);
}
.fs-mini-tog:hover {
    border-color: rgba(255, 255, 255, 0.25);
}

#fsMiniCanvas {
    display: block;
    width: 100%;
    height: 80px;
    border-radius: 6px;
}

.fs-mini-vals {
    display: flex;
    gap: 10px;
    margin-top: 4px;
    flex-wrap: wrap;
}
.fs-mini-val {
    font-size: 11px;
    font-weight: 600;
    white-space: nowrap;
}
.fs-mini-val-num {
    font-variant-numeric: tabular-nums;
}
.fs-mini-val-unit {
    font-weight: 400;
    opacity: 0.6;
    margin-left: 1px;
    font-size: 10px;
}
.map-stats-panel {
    width: 205px;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    justify-content: space-between; /* gauge at top, metrics at bottom, full height used */
    gap: 14px;
    padding: 6px 0 4px;
    position: relative; /* sit above Leaflet canvas layers */
    z-index: 2;
}

/* ── Speed gauge ────────────────────────────────────────── */
.speed-gauge {
    width: 100%;
}
.speed-gauge svg {
    display: block;
    width: 100%;
    height: auto;
    /* viewBox is sized to contain all elements — no overflow needed */
}
.g-track {
    fill: none;
    stroke: rgba(255, 255, 255, 0.09);
    stroke-width: 8;
    stroke-linecap: round;
}
.g-fill {
    fill: none;
    stroke: url(#gaugeGrad);
    stroke-width: 8;
    stroke-linecap: round;
    transition: stroke-dasharray 0.07s linear;
}
/* SVG text colours are set via inline fill= attributes so they always
   render white/light regardless of CSS variable support in SVG context */
.g-num {
    font-size: 22px;
    font-weight: 700;
    font-family: inherit;
}
.g-unit {
    font-size: 8px;
    font-weight: 500;
    letter-spacing: 0.06em;
}
.g-zero,
.g-max {
    font-size: 7.5px;
    font-weight: 500;
}
.g-label {
    text-align: center;
    font-size: 9px;
    font-weight: 700;
    letter-spacing: 0.1em;
    color: var(--text-muted);
    text-transform: uppercase;
    margin-top: 0;
}

/* ── Garmin-style data grid ──────────────────────────────── */
.map-metrics {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4px;
}
/* A single data field cell */
.mm-cell {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.07);
    border-radius: 8px;
    padding: 5px 7px 6px;
    display: flex;
    flex-direction: column;
    gap: 1px;
    min-width: 0;
    position: relative;
    --mouse-x: 50%;
    --mouse-y: 50%;
}
.mm-cell::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.07) 0%,
        transparent 65%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
}
.mm-cell::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 1px;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.4) 0%,
        transparent 60%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
    -webkit-mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
}
.mm-cell:hover::before,
.mm-cell:hover::after {
    opacity: 1;
}
/* Time (and any other full-width cells) span both columns */
.mm-full {
    grid-column: 1 / -1;
}
/* Label row: icon + text */
.mm-header {
    display: flex;
    align-items: center;
    gap: 3px;
}
.mm-icon {
    flex-shrink: 0;
    width: 9px;
    height: 9px;
    color: var(--text-muted);
    display: flex;
    align-items: center;
    opacity: 0.7;
}
.mm-icon svg {
    width: 100%;
    height: 100%;
}

/* Heartbeat — duration driven by --hr-period set in JS */
@keyframes hrPulse {
    0% {
        transform: scale(1);
    }
    20% {
        transform: scale(1.6);
    }
    36% {
        transform: scale(1);
    }
    52% {
        transform: scale(1.25);
    }
    68% {
        transform: scale(1);
    }
    100% {
        transform: scale(1);
    }
}
.hr-icon {
    transform-origin: center;
}
.hr-beating {
    animation: hrPulse var(--hr-period, 0.75s) linear infinite;
}

.mm-lbl {
    font-size: 8.5px;
    font-weight: 700;
    letter-spacing: 0.07em;
    text-transform: uppercase;
    color: var(--text-muted);
    line-height: 1;
}
/* Number + unit row */
.mm-data {
    display: flex;
    align-items: baseline;
    gap: 2px;
    margin-top: 1px;
}
.mm-val {
    font-size: 20px;
    font-weight: 800;
    line-height: 1;
    color: var(--text-primary);
    font-variant-numeric: tabular-nums;
    letter-spacing: -0.02em;
    transition: color 0.25s ease;
    min-width: 0;
    overflow: hidden;
    text-overflow: clip;
}

.mm-unt {
    font-size: 9px;
    font-weight: 500;
    color: var(--text-muted);
    white-space: nowrap;
    flex-shrink: 0;
}

/* ── Responsive: stack map above data panel ─────────────────────────────
   Kicks in at 640 px so the map never gets squeezed below ~470 px wide   */
@media (max-width: 640px) {
    .map-with-stats {
        flex-direction: column;
        gap: 12px;
    }
    /* Map goes full-width; locked height — flex: 0 0 prevents any shrinking */
    .activity-map {
        flex: 0 0 260px;
        height: 260px;
        min-height: 260px;
    }
    /* Panel goes full-width and lays out horizontally:
       gauge on the left, data cells filling the rest */
    .map-stats-panel {
        width: 100%;
        flex-direction: row;
        align-items: flex-start;
        gap: 12px;
        padding: 0;
    }
    .speed-gauge {
        width: 130px;
        flex-shrink: 0;
    }
    .map-metrics {
        flex: 1 1 0;
        min-width: 0;
        /* Keep 2-col grid but let it fill available width */
        grid-template-columns: 1fr 1fr;
    }
    .map-fullscreen .fs-bottom-row {
        flex-direction: column;
    }
    .fs-bottom-left,
    .fs-bottom-right {
        flex: none;
        width: 100%;
    }
}
/* Alt + scroll zoom — cursor + hint overlay */
.activity-map.alt-zoom,
.activity-map.alt-zoom * {
    cursor: zoom-in !important;
}

.map-scroll-hint {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.72);
    color: #e2e8f0;
    font-size: 12px;
    font-weight: 600;
    letter-spacing: 0.03em;
    padding: 7px 16px;
    border-radius: 20px;
    pointer-events: none;
    z-index: 800;
    opacity: 0;
    transition: opacity 0.2s ease;
    white-space: nowrap;
}
.map-scroll-hint.visible {
    opacity: 1;
}

/* Attribution — small and unobtrusive, dark theme */
.activity-map .leaflet-control-attribution,
.recent-act-map .leaflet-control-attribution {
    background: rgba(10, 12, 18, 0.55) !important;
    color: rgba(255, 255, 255, 0.3) !important;
    font-size: 9px !important;
    border-radius: 4px !important;
    -webkit-backdrop-filter: blur(4px);
    backdrop-filter: blur(4px);
}
.activity-map .leaflet-control-attribution a,
.recent-act-map .leaflet-control-attribution a {
    color: rgba(255, 255, 255, 0.4) !important;
}

/* Back button — sits on the LEFT of the topbar, right after the burger */
.detail-topbar-back {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: var(--text-sm);
    white-space: nowrap;
    margin-left: 4px;
}
/* Prev/next arrows — sit on the RIGHT in topbar-actions */
.detail-nav-arrows {
    display: flex;
    align-items: center;
    gap: 2px;
}
.detail-nav-btn {
    padding: 6px 8px;
    line-height: 0;
}
.detail-nav-btn:disabled {
    opacity: 0.25;
    pointer-events: none;
}
.detail-nav-counter {
    font-size: var(--text-xs);
    color: var(--text-muted);
    font-family: var(--font-num);
    min-width: 46px;
    text-align: center;
    letter-spacing: 0.02em;
}

/* ── Activity hero ───────────────────────────────────────────────────── */
/* ── Activity Hero ─────────────────────────────────────────────────────── */
.act-hero {
    padding: 80px 0 0;
    margin-bottom: 16px;
}

/* Identity row: large icon + meta column */
.act-hero-identity {
    display: flex;
    align-items: flex-start;
    gap: 16px;
    margin-bottom: 20px;
}

/* Icon wrapper — larger rounded-square with accent tint */
.act-hero-icon-wrap {
    flex-shrink: 0;
    width: 54px;
    height: 54px;
    background: var(--accent-dim);
    border: 1px solid var(--accent-glow);
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    justify-content: center;
}
.act-hero-icon-wrap .activity-type-icon {
    width: 28px;
    height: 28px;
    background: none;
    border: none;
    padding: 0;
    font-size: 20px;
}
.act-hero-icon-wrap .activity-type-icon svg {
    width: 22px;
    height: 22px;
    stroke: var(--accent);
}

/* Meta column: eyebrow > title > date */
.act-hero-meta {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 4px;
}

/* eyebrow: type badge · platform · TSS — sits below the title */
.act-hero-eyebrow {
    display: flex;
    align-items: center;
    gap: 6px;
    flex-wrap: wrap;
    margin-top: 6px;
}
.act-type-badge {
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 2px 9px;
    font-size: var(--text-2xs);
    font-weight: 700;
    letter-spacing: 0.07em;
    text-transform: uppercase;
    color: var(--text-muted);
}
.act-tss-badge {
    background: var(--accent-dim);
    border: 1px solid var(--accent-glow);
    color: var(--accent);
    border-radius: 20px;
    padding: 2px 9px;
    font-size: var(--text-xs);
    font-weight: 700;
    font-family: var(--font-num);
    letter-spacing: 0.04em;
    white-space: nowrap;
}

/* title */
.act-hero-title {
    font-size: clamp(1.45rem, 3.5vw, 2.2rem);
    font-weight: 900;
    letter-spacing: -0.5px;
    line-height: 1.1;
    color: var(--text-primary);
    margin: 0;
    overflow-wrap: break-word;
}

/* date line */
.act-hero-date {
    font-size: var(--text-sm);
    color: var(--text-muted);
    letter-spacing: 0.01em;
}

/* ── Primary stat cards ─────────────────────────────────────────────────── */
.act-primary-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
}
.act-pstat {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 14px 14px 12px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    position: relative;
    overflow: hidden;
    transition:
        border-color var(--transition),
        background var(--transition);
}
.act-pstat::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--border);
    border-radius: 0 0 var(--radius) var(--radius);
    transition: background var(--transition);
}
.act-pstat--accent::after {
    background: var(--accent);
    opacity: 0.7;
}
.act-pstat:hover {
    background: var(--bg-elevated);
    border-color: var(--border-active);
}
/* top row: icon + label */
.act-pstat-top {
    display: flex;
    align-items: center;
    gap: 6px;
}
.act-pstat-icon {
    width: 14px;
    height: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-muted);
    flex-shrink: 0;
}
.act-pstat-icon.accent {
    color: var(--accent);
}
.act-pstat-icon svg {
    width: 13px;
    height: 13px;
    stroke-width: 2.2;
}
.act-pstat-val {
    font-size: clamp(1.45rem, 2.8vw, 2rem);
    font-weight: 900;
    font-family: var(--font-num);
    letter-spacing: -1px;
    line-height: 1;
    color: var(--text-primary);
    white-space: nowrap;
}
.act-pstat--accent .act-pstat-val {
    color: var(--accent);
}
.act-pstat-lbl {
    font-size: var(--text-2xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    line-height: 1;
}

@media (max-width: 600px) {
    .act-hero-icon-wrap {
        width: 46px;
        height: 46px;
    }
    .act-primary-stats {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
    }
    .act-pstat-val {
        font-size: 1.4rem;
    }
}

/* ── activity primary stat comparison chips ─────────────────────────────── */
.act-pstat-cmp {
    font-size: var(--text-2xs);
    font-weight: 700;
    letter-spacing: 0.04em;
    display: flex;
    align-items: center;
    gap: 3px;
    margin-top: 2px;
}
.act-pstat-cmp.cmp-up {
    color: #22c55e;
}
.act-pstat-cmp.cmp-down {
    color: var(--text-muted);
}
.act-pstat-cmp.cmp-same {
    color: var(--text-muted);
}

/* ── "How You Compare" card ─────────────────────────────────────────────── */
.detail-cmp-badge {
    font-size: var(--text-xs);
    font-weight: 600;
    padding: 4px 12px;
    border-radius: 20px;
    white-space: nowrap;
}
.detail-cmp-rows {
    display: flex;
    flex-direction: column;
    gap: 26px;
    padding-top: 4px;
}
.detail-cmp-row {
    display: grid;
    grid-template-columns: 90px 1fr 80px;
    align-items: center;
    gap: 12px;
}
.detail-cmp-label {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.07em;
    white-space: nowrap;
}
.detail-cmp-bar-wrap {
    position: relative;
    height: 14px;
    background: var(--bg-elevated);
    border-radius: 3px;
    overflow: visible;
}
.detail-cmp-bar-avg {
    position: absolute;
    top: -3px;
    bottom: -3px;
    width: 2px;
    background: var(--border-active);
    border-radius: 2px;
    z-index: 2;
    overflow: visible;
}
.detail-cmp-bar-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.5s cubic-bezier(0.25, 1, 0.5, 1);
    max-width: 100%;
}
.detail-cmp-vals {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 7px;
}
.detail-cmp-this {
    font-size: var(--text-sm);
    font-weight: 700;
    font-family: var(--font-num);
    color: var(--text-primary);
    line-height: 1;
}
.detail-cmp-avg-val {
    position: absolute;
    top: calc(100% + 5px);
    left: 50%;
    transform: translateX(-50%);
    white-space: nowrap;
    font-size: var(--text-2xs);
    color: var(--text-muted);
    line-height: 1;
}
.detail-cmp-pct {
    font-size: var(--text-2xs);
    font-weight: 700;
    padding: 2px 7px;
    border-radius: 10px;
    text-align: center;
}
.detail-cmp-pct.cmp-up {
    background: rgba(0, 229, 160, 0.12);
    color: #00e5a0;
}
.detail-cmp-pct.cmp-down {
    background: rgba(251, 146, 60, 0.12);
    color: #fb923c;
}
.detail-cmp-pct.cmp-same {
    background: var(--bg-elevated);
    color: var(--text-muted);
}

/* ── grid swap on mobile ─────────────────────────────────────────────────── */
@media (max-width: 480px) {
    .detail-cmp-row {
        grid-template-columns: 72px 1fr 60px;
        gap: 8px;
    }
}

/* secondary stats: icon tile grid */
.act-secondary-strip {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(145px, 1fr));
    gap: var(--gap-layout);
}
.act-sstat {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    padding: 13px 14px 12px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 14px;
    cursor: default;
    transition:
        border-color var(--transition),
        background var(--transition);
    position: relative;
    --mouse-x: 50%;
    --mouse-y: 50%;
}
.act-sstat::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.055) 0%,
        transparent 65%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
}
.act-sstat::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 1px;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.35) 0%,
        transparent 60%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
    -webkit-mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
}
.act-sstat:hover {
    border-color: transparent;
    background: var(--bg-elevated);
}
.act-sstat:hover::before,
.act-sstat:hover::after {
    opacity: 1;
}
.act-sstat-top {
    display: flex;
    align-items: center;
    gap: 7px;
    margin-bottom: 9px;
    width: 100%;
}
.act-sstat-icon {
    width: 28px;
    height: 28px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}
.act-sstat-icon svg {
    width: 13px;
    height: 13px;
}
.act-sstat-icon.green {
    background: var(--accent-dim);
    color: var(--accent);
}
.act-sstat-icon.orange {
    background: var(--orange-dim);
    color: var(--orange);
}
.act-sstat-icon.blue {
    background: var(--blue-dim);
    color: var(--blue);
}
.act-sstat-icon.purple {
    background: var(--purple-dim);
    color: var(--purple);
}
.act-sstat-icon.red {
    background: rgba(255, 71, 87, 0.12);
    color: var(--red);
}
.act-sstat-icon.yellow {
    background: var(--yellow-dim);
    color: var(--yellow);
}
.act-sstat-lbl {
    font-size: var(--text-2xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.07em;
    color: var(--text-muted);
    white-space: nowrap;
}
.act-sstat-val {
    font-size: clamp(1.25rem, 2.4vw, 1.55rem);
    font-weight: 800;
    font-family: var(--font-num);
    letter-spacing: -0.5px;
    color: var(--text-primary);
    white-space: nowrap;
    line-height: 1;
}
.act-sstat-cmp {
    font-size: var(--text-2xs);
    font-weight: 700;
    letter-spacing: 0.04em;
    margin-top: 10px;
}
.act-sstat-cmp.cmp-pos {
    color: #22c55e;
}
.act-sstat-cmp.cmp-neg {
    color: #f87171;
}
.act-sstat-cmp.cmp-neutral {
    color: var(--text-muted);
}

/* ── Stream charts row ───────────────────────────────────────────────── */
.detail-charts-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
}
@media (max-width: 600px) {
    .detail-charts-row {
        grid-template-columns: 1fr;
    }
}

/* Power curve + HR curve side by side */
.detail-curves-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
}
.detail-curves-row > .card[style*="display:none"],
.detail-curves-row > .card[style*="display: none"] {
    display: none !important;
}
/* If only one card is visible, let it span full width */
.detail-curves-row:has(> .card:only-child),
.detail-curves-row:has(> .card[style*="display:none"]:first-child),
.detail-curves-row:has(> .card[style*="display:none"]:last-child) {
    grid-template-columns: 1fr;
}
@media (max-width: 700px) {
    .detail-curves-row {
        grid-template-columns: 1fr;
    }
}

/* ── Activity detail: performance analysis metrics grid ──────────── */
.perf-metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
    gap: 10px;
    padding: 2px 0 4px;
}
.perf-metric {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.07);
    border-radius: 10px;
    padding: 12px 14px;
    display: flex;
    flex-direction: column;
    gap: 4px;
    position: relative;
    --mouse-x: 50%;
    --mouse-y: 50%;
}
.perf-metric::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.055) 0%,
        transparent 65%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
}
.perf-metric::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 1px;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.35) 0%,
        transparent 60%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
    -webkit-mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
}
.perf-metric:hover::before,
.perf-metric:hover::after {
    opacity: 1;
}
.perf-metric-val {
    font-size: 22px;
    font-weight: 800;
    font-variant-numeric: tabular-nums;
    letter-spacing: -0.02em;
    line-height: 1;
}
.perf-metric-lbl {
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--text-muted);
    line-height: 1.3;
}
.perf-metric-sub {
    font-size: 9.5px;
    color: var(--text-muted);
    opacity: 0.7;
    margin-top: 1px;
}

/* ── Performance card: peak power row ────────────────────────────── */
.perf-peaks-section {
    margin-top: 14px;
    padding-top: 12px;
    border-top: 1px solid rgba(255, 255, 255, 0.06);
}
.perf-peaks-label {
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--text-muted);
    margin-bottom: 8px;
}
.perf-peaks-row {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
}
.perf-peak-pill {
    flex: 1 1 0;
    min-width: 52px;
    background: rgba(0, 229, 160, 0.07);
    border: 1px solid rgba(0, 229, 160, 0.15);
    border-radius: 8px;
    padding: 7px 6px 6px;
    text-align: center;
}
.perf-peak-val {
    font-size: 15px;
    font-weight: 800;
    color: #00e5a0;
    line-height: 1.1;
}
.perf-peak-unit {
    font-size: 10px;
    font-weight: 600;
    color: rgba(0, 229, 160, 0.65);
}
.perf-peak-dur {
    font-size: 9.5px;
    color: var(--text-muted);
    margin-top: 2px;
}

/* ── Activity detail: zones side-by-side row ──────────────────────── */
.detail-zones-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
}
.detail-zones-row--single {
    grid-template-columns: 1fr;
}
@media (max-width: 900px) {
    .detail-zones-row:not(.detail-zones-row--single) {
        grid-template-columns: 1fr;
    }
}

/* ── Activity detail: power zone table ────────────────────────────── */
.detail-zone-row {
    display: flex;
    align-items: center;
    gap: 7px;
    padding: 9px 0;
    border-bottom: 1px solid var(--border);
}
.detail-zone-row:last-child {
    border-bottom: none;
}
.detail-zone-tag {
    font-size: var(--text-xs);
    font-weight: 700;
    font-family: var(--font-num);
    min-width: 26px;
    letter-spacing: 0.03em;
}
.detail-zone-name {
    font-size: var(--text-sm);
    color: var(--text-muted);
    min-width: 72px;
}
.detail-zone-bar-track {
    flex: 1;
    height: 14px;
    background: rgba(255, 255, 255, 0.06);
    border-radius: 3px;
    overflow: hidden;
}
.detail-zone-bar-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}
.detail-zone-time {
    font-size: var(--text-xs);
    color: var(--text-secondary);
    font-family: var(--font-num);
    width: 46px;
    flex-shrink: 0;
    text-align: right;
}
.detail-zone-pct {
    font-size: var(--text-xs);
    font-weight: 600;
    font-family: var(--font-num);
    width: 36px;
    flex-shrink: 0;
    text-align: right;
}
@media (max-width: 480px) {
    .detail-zone-name {
        display: none;
    }
    .detail-zone-time {
        min-width: 44px;
        font-size: var(--text-xs);
    }
}

/* ── Activity streams combined chart ─────────────────────────────────────── */
.stream-toggles {
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
    justify-content: flex-end;
}
.stream-toggle-btn {
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 0.02em;
    padding: 3px 9px;
    border-radius: 999px;
    border: 1.5px solid var(--sc, var(--border));
    background: transparent;
    color: var(--sc, var(--text-muted));
    cursor: pointer;
    transition:
        opacity 0.15s,
        background 0.15s;
    opacity: 0.38;
    white-space: nowrap;
}
.stream-toggle-btn.active {
    opacity: 1;
    background: rgba(255, 255, 255, 0.06);
}

.detail-charts-loading {
    display: flex;
    flex-direction: column;
    gap: 16px;
    padding: 8px 0 24px;
}
.skeleton-card {
    background: var(--bg-elevated);
    border-radius: var(--radius);
    padding: 20px;
}

/* ============================================================
   ZONE DISTRIBUTION CARD
============================================================ */
.zone-total-badge {
    background: var(--accent-dim);
    color: var(--accent);
    border: 1px solid var(--accent-glow);
    border-radius: 20px;
    padding: 3px 12px;
    font-size: var(--text-xs);
    font-weight: 700;
    font-family: var(--font-num);
    white-space: nowrap;
    flex-shrink: 0;
}
.zone-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.zone-row {
    display: flex;
    align-items: center;
    gap: 7px;
}
.zone-tag {
    font-size: var(--text-2xs);
    font-weight: 800;
    letter-spacing: 0.04em;
    font-family: var(--font-num);
    width: 22px;
    flex-shrink: 0;
}
.zone-row-name {
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--text-secondary);
    width: 96px;
    flex-shrink: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
@media (max-width: 480px) {
    .zone-row-name {
        display: none;
    }
}
.zone-bar-track {
    flex: 1;
    height: 14px;
    background: var(--bg-elevated);
    border-radius: 3px;
    overflow: hidden;
}
.zone-bar-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.7s cubic-bezier(0.4, 0, 0.2, 1);
}
.zone-pct {
    font-size: var(--text-xs);
    font-weight: 700;
    width: 34px;
    text-align: right;
    font-family: var(--font-num);
    flex-shrink: 0;
}
.zone-time {
    font-size: var(--text-2xs);
    color: var(--text-muted);
    width: 54px;
    text-align: right;
    flex-shrink: 0;
}
/* Bottom balance section */
.zone-balance-section {
    margin-top: 18px;
    padding-top: 16px;
    border-top: 1px solid var(--border);
}
.zone-balance-label {
    font-size: var(--text-2xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.09em;
    color: var(--text-muted);
    margin-bottom: 8px;
}
.zone-balance-bar {
    display: flex;
    height: 12px;
    border-radius: 3px;
    overflow: hidden;
}
.zone-balance-seg {
    height: 100%;
    transition: width 0.7s cubic-bezier(0.4, 0, 0.2, 1);
}
.zone-style-hint {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 9px;
}
.zone-style-hint strong {
    color: var(--text-primary);
}

/* ============================================================
   POWER CURVE
============================================================ */
.curve-peaks {
    display: flex;
    gap: 6px;
    margin-bottom: 10px;
    flex-wrap: wrap;
}
.curve-peak {
    flex: 1;
    min-width: 60px;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 6px 8px;
    text-align: center;
}
.curve-peak-val {
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--accent);
    font-family: var(--font-num);
    line-height: 1;
}
.curve-peak-unit {
    font-size: var(--text-xs);
    font-weight: 500;
    margin-left: 1px;
    opacity: 0.7;
}
.curve-peak-dur {
    font-size: var(--text-2xs);
    color: var(--text-muted);
    margin-top: 3px;
    text-transform: uppercase;
    letter-spacing: 0.07em;
    font-family: var(--font-num);
}

/* "No power for this activity" note inside peaks row */
.curve-no-power-msg {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: var(--text-xs);
    color: var(--text-muted);
    padding: 4px 2px;
}

/* Power curve comparison legend */
.curve-legend {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
}
.curve-legend-item {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 11px;
    color: var(--text-muted);
    white-space: nowrap;
}
.curve-legend-dot {
    width: 10px;
    height: 3px;
    border-radius: 2px;
    flex-shrink: 0;
}

/* ============================================================
   RESPONSIVE
============================================================ */
@media (max-width: 1100px) {
    .fitness-row {
        grid-template-columns: 1fr;
    }
}
@media (max-width: 900px) {
    .stream-charts {
        grid-template-columns: 1fr;
    }
    .cal-stats-strip .cal-hstat {
        padding: 6px 10px;
    }
    /* Tablet: keep cards but hide the name row to save space */
    .cal-day-card-name {
        display: none;
    }
    .cal-day-card {
        padding: 2px 4px 2px 5px;
    }
}
@media (max-width: 600px) {
    /* Mobile: stack calendar above day panel again */
    .cal-body {
        flex-direction: column;
    }
    .cal-left {
        flex: none;
        border-right: none;
        border-bottom: 1px solid var(--border);
    }
    .cal-day-panel {
        width: 100%;
        flex: 1;
    }
    .cal-dow-row > div {
        font-size: var(--text-2xs);
        letter-spacing: 0;
    }
    .cal-month-title {
        min-width: 130px;
        font-size: var(--text-base);
    }
    .cal-day {
        padding: 5px 1px 4px;
    }
    .cal-day-num {
        width: 24px;
        height: 24px;
        font-size: var(--text-xs);
    }
    /* Mobile: swap to dot indicators, hide cards */
    .cal-day-cards {
        display: none;
    }
    .cal-dots {
        display: flex;
    }
    .cal-dot {
        width: 4px;
        height: 4px;
    }
    .cal-day-panel {
        transition:
            flex 0.25s ease,
            opacity 0.2s ease;
    }
    .cal-body--panel-hidden .cal-day-panel {
        width: 100%;
        flex: 0 0 0px;
        opacity: 0;
        pointer-events: none;
        overflow: hidden;
    }
    .cal-body--panel-hidden .cal-left {
        flex: 1;
        border-bottom: none;
    }
    .cal-day-panel-header {
        padding: 9px 14px 7px;
    }
    .cal-list-item {
        padding: 9px 14px;
    }
}
/* ── Backdrop: always in DOM, invisible + non-interactive when closed ── */
.sidebar-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 1);
    z-index: 1150;
    opacity: 0;
    pointer-events: none;
    transition:
        opacity 0.28s cubic-bezier(0.4, 0, 0.2, 1),
        visibility 0.28s;
    visibility: hidden;
    will-change: opacity;
    touch-action: none; /* prevent scroll context from starting on backdrop */
    overscroll-behavior: none;
}
.sidebar-backdrop.open {
    opacity: 0.55;
    pointer-events: auto;
    visibility: visible;
}

/* ── Burger button (hidden on desktop) ── */
.burger-btn {
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 5px;
    width: 36px;
    height: 36px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px;
    border-radius: 8px;
    flex-shrink: 0;
    transition: background var(--transition);
    position: relative;
    z-index: 101;
}
.burger-btn:hover {
    background: var(--bg-elevated);
}
.burger-btn span {
    display: block;
    width: 20px;
    height: 2px;
    background: var(--text-secondary);
    border-radius: 2px;
    transition:
        transform 0.25s ease,
        opacity 0.2s ease;
}

/* Animate burger to X when sidebar is open */
.burger-btn.is-open span:nth-child(1) {
    transform: translateY(7px) rotate(45deg);
}
.burger-btn.is-open span:nth-child(2) {
    opacity: 0;
    transform: scaleX(0);
}
.burger-btn.is-open span:nth-child(3) {
    transform: translateY(-7px) rotate(-45deg);
}

@media (max-width: 700px) {
    :root {
        --sidebar-w: 0px;
    }
    /* Sidebar off-screen and non-interactive when closed */
    .sidebar {
        width: 220px;
        transform: translateX(-220px);
        z-index: 1200;
        pointer-events: none;
        will-change: transform;
    }
    .sidebar.open {
        transform: translateX(0);
        pointer-events: auto;
    }
    /* Topbar spans full width on mobile since sidebar-w is 0 */
    .topbar {
        left: 0;
    }
    .main {
        margin-left: 0;
        min-height: 100svh;
        min-height: 100vh;
    }
    .cal-shell {
        left: 0;
    }
    .burger-btn {
        display: flex;
    }
    .stat-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

/* ============================================================
   WORKOUT BUILDER
============================================================ */

/* ---- Top bar ---- */
.wrk-topbar {
    display: flex;
    align-items: center;
    gap: 14px;
    margin-bottom: 14px;
    flex-wrap: wrap;
}
.wrk-name-input {
    flex: 1;
    min-width: 180px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    color: var(--text-primary);
    font-family: inherit;
    font-size: var(--text-lg);
    font-weight: 700;
    padding: 9px 14px;
    outline: none;
    transition: border-color var(--transition);
}
.wrk-name-input:focus {
    border-color: var(--accent);
}
.wrk-topbar-stats {
    display: flex;
    align-items: center;
    gap: 6px;
    flex-shrink: 0;
}
.wrk-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    line-height: 1.1;
}
.wrk-stat-val {
    font-size: var(--text-lg);
    font-weight: 700;
    font-family: var(--font-num);
    color: var(--text-primary);
}
.wrk-stat-lbl {
    font-size: var(--text-xs);
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.04em;
}
.wrk-stat-sep {
    color: var(--text-muted);
    font-size: 1rem;
    padding: 0 2px;
}
.wrk-clear-btn {
    flex-shrink: 0;
    font-size: var(--text-sm);
    padding: 7px 14px;
}

/* ---- Canvas chart ---- */
.wrk-chart-card {
    padding: 14px 16px 10px;
    position: relative;
    margin-bottom: 14px;
}
.wrk-canvas {
    display: block;
    width: 100%;
    height: 200px;
    border-radius: var(--radius);
}
.wrk-chart-empty {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--text-base);
    color: var(--text-muted);
    pointer-events: none;
}

/* ---- FTP override row ---- */
.wrk-ftp-row {
    display: flex;
    align-items: center;
    gap: 6px;
}
.wrk-ftp-label {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    white-space: nowrap;
}
.wrk-ftp-input {
    width: 72px;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    color: var(--text-primary);
    font-family: inherit;
    font-size: var(--text-base);
    padding: 5px 8px;
    outline: none;
    transition: border-color var(--transition);
}
.wrk-ftp-input:focus {
    border-color: var(--accent);
}
.wrk-ftp-unit {
    font-size: var(--text-sm);
    color: var(--text-muted);
}

/* ---- Segment list ---- */
.wrk-segment-list {
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin: 10px 0;
}
.wrk-list-empty {
    text-align: center;
    color: var(--text-muted);
    font-size: var(--text-base);
    padding: 24px 0;
}
.wrk-seg-wrap {
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    transition: border-color var(--transition);
}
.wrk-seg-wrap--active {
    border-color: var(--accent);
}
.wrk-seg-row {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 9px 12px;
    cursor: pointer;
    background: var(--bg-elevated);
    transition: background var(--transition);
}
.wrk-seg-row:hover {
    background: var(--bg-card);
}
.wrk-seg-swatch {
    width: 10px;
    height: 36px;
    border-radius: 4px;
    flex-shrink: 0;
}
.wrk-seg-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 2px;
    min-width: 0;
}
.wrk-seg-type {
    font-size: var(--text-base);
    font-weight: 600;
    color: var(--text-primary);
    text-transform: capitalize;
}
.wrk-seg-detail {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.wrk-seg-actions {
    display: flex;
    gap: 4px;
    flex-shrink: 0;
}
.wrk-icon-btn {
    width: 28px;
    height: 28px;
    border-radius: 6px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    color: var(--text-secondary);
    font-size: var(--text-base);
    display: flex;
    align-items: center;
    justify-content: center;
    transition:
        background var(--transition),
        color var(--transition);
    cursor: pointer;
}
.wrk-icon-btn:hover {
    background: var(--bg-elevated);
    color: var(--text-primary);
}
.wrk-icon-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
}
.wrk-icon-btn--del:hover {
    background: rgba(255, 71, 87, 0.15);
    color: var(--red);
    border-color: var(--red);
}

/* ---- Edit panel ---- */
.wrk-edit-panel {
    background: var(--bg-card);
    border-top: 1px solid var(--border);
    padding: 14px 14px 10px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.wrk-edit-row {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
}
.wrk-edit-row label {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    min-width: 80px;
    flex-shrink: 0;
}
.wrk-dur-inputs {
    display: flex;
    align-items: center;
    gap: 5px;
    flex: 1;
}
.wrk-dur-inputs input[type="number"] {
    width: 60px;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--text-primary);
    font-family: inherit;
    font-size: var(--text-base);
    padding: 5px 8px;
    outline: none;
    transition: border-color var(--transition);
}
.wrk-dur-inputs input[type="number"]:focus {
    border-color: var(--accent);
}
.wrk-dur-inputs span {
    font-size: var(--text-sm);
    color: var(--text-muted);
}
.wrk-power-input {
    display: flex;
    align-items: center;
    gap: 8px;
    flex: 1;
}
.wrk-power-input input[type="range"] {
    flex: 1;
    accent-color: var(--accent);
    min-width: 80px;
}
.wrk-power-badge {
    font-size: var(--text-sm);
    font-weight: 700;
    font-family: var(--font-num);
    padding: 3px 8px;
    border-radius: 20px;
    color: #fff;
    min-width: 48px;
    text-align: center;
    flex-shrink: 0;
}

/* ---- Add segment bar ---- */
.wrk-add-bar {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    padding: 12px 0 4px;
    border-top: 1px solid var(--border);
    margin-top: 6px;
}
.wrk-add-btn {
    font-size: var(--text-sm);
    padding: 6px 14px;
    border-radius: 20px;
    border: 1px solid var(--border);
    color: var(--text-secondary);
    transition:
        border-color var(--transition),
        color var(--transition),
        background var(--transition);
}
.wrk-add-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
    background: var(--accent-dim);
}

/* ---- Export card ---- */
.wrk-export-card {
    display: flex;
    align-items: center;
    gap: 16px;
    flex-wrap: wrap;
    margin-top: 14px;
}
.wrk-export-info {
    flex: 1;
    min-width: 0;
}
.wrk-export-title {
    font-size: var(--text-base);
    font-weight: 600;
    color: var(--text-primary);
}
.wrk-export-sub {
    font-size: var(--text-sm);
    color: var(--text-muted);
    margin-top: 3px;
    line-height: 1.5;
}
.wrk-export-btns {
    display: flex;
    gap: 8px;
    flex-shrink: 0;
    flex-wrap: wrap;
}
.wrk-export-btns .btn {
    font-size: var(--text-base);
    padding: 8px 18px;
}

/* ---- Responsive ---- */
@media (max-width: 600px) {
    .wrk-topbar {
        gap: 8px;
    }
    .wrk-topbar-stats {
        gap: 4px;
    }
    .wrk-export-card {
        flex-direction: column;
        align-items: flex-start;
    }
}

/* .year-select → now uses .app-select.app-select--sm  (see universal select block above) */

/* ============================================================
   WEEK PROGRESS CARD
============================================================ */
/* Week Progress header right side */
.wkp-header-right {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 8px;
}
.wkp-toggles {
    display: flex;
    gap: 4px;
}
.wkp-toggle-btn {
    font-size: var(--text-2xs);
    font-weight: 600;
    padding: 4px 10px;
    border-radius: 20px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--text-muted);
    cursor: pointer;
    transition:
        background var(--transition),
        color var(--transition),
        border-color var(--transition);
}
.wkp-toggle-btn:hover {
    background: var(--bg-elevated);
    color: var(--text-primary);
    border-color: var(--border-active);
}
.wkp-toggle-btn--active {
    background: var(--accent-dim);
    color: var(--accent);
    border-color: rgba(0, 229, 160, 0.3);
}

.wkp-body {
    display: flex;
    flex-direction: column;
    gap: 14px;
    flex: 1;
}
.wkp-chart {
    width: 100%;
    flex: 1;
    min-height: 140px;
}
.wkp-stats {
    display: flex;
    flex-direction: row;
    background: var(--bg-elevated);
    border-radius: var(--radius);
    border: 1px solid var(--border);
    overflow: hidden;
}
.wkp-stat {
    padding: 12px 16px;
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
}
.wkp-divider {
    width: 1px;
    height: auto;
    background: var(--border);
    flex-shrink: 0;
}
.wkp-stat-label {
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    margin-bottom: 5px;
}
.wkp-stat-val {
    font-family: var(--font-num);
    font-size: 1.65rem;
    font-weight: 700;
    line-height: 1;
    color: var(--text-primary);
    font-variant-numeric: tabular-nums;
    margin-bottom: 4px;
}
.wkp-stat-delta {
    font-family: var(--font-num);
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--accent);
}
.wkp-stat-sub {
    font-size: var(--text-xs);
    color: var(--text-muted);
}
.wkp-ctl-delta {
    font-family: var(--font-num);
    font-size: var(--text-lg);
    font-weight: 700;
    line-height: 1.2;
    color: var(--text-primary);
    margin-bottom: 7px;
    font-variant-numeric: tabular-nums;
}
.wkp-badge {
    display: inline-block;
    font-size: var(--text-xs);
    font-weight: 700;
    padding: 3px 9px;
    border-radius: 20px;
    letter-spacing: 0.03em;
}
.wkp-badge--up {
    background: rgba(0, 229, 160, 0.15);
    color: var(--accent);
}
.wkp-badge--down {
    background: rgba(255, 71, 87, 0.15);
    color: var(--red);
}
.wkp-badge--flat {
    background: rgba(74, 158, 255, 0.12);
    color: var(--blue);
}

@media (max-width: 600px) {
    .wkp-stat-val {
        font-size: 1.25rem;
    }
    .wkp-ctl-delta {
        font-size: var(--text-base);
    }
}

/* ============================================================
   TRAINING STATUS CARD  —  Hero card
============================================================ */
#trainingStatusCard {
    display: flex;
    flex-direction: column;
    padding: 0;
    background: linear-gradient(160deg, #141828 0%, #1a1f2c 55%, #1a1f2c 100%);
    border: 1px solid rgba(0, 229, 160, 0.18);
    box-shadow:
        0 0 0 1px rgba(0, 229, 160, 0.06),
        0 8px 32px rgba(0, 0, 0, 0.45),
        inset 0 1px 0 rgba(255, 255, 255, 0.04);
    overflow: hidden;
    position: relative;
}
#trainingStatusCard::before {
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(
        ellipse 80% 50% at 50% -10%,
        rgba(0, 229, 160, 0.07) 0%,
        transparent 65%
    );
    pointer-events: none;
}

/* Header */
.trs-hero-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 16px 0;
    position: relative;
    z-index: 1;
}
.trs-hero-titles {
    display: flex;
    flex-direction: column;
    gap: 2px;
}
.trs-hero-title {
    font-size: var(--text-md);
    font-weight: 700;
    color: var(--text-primary);
    letter-spacing: 0.01em;
}
.trs-hero-sub {
    font-size: var(--text-xs);
    color: var(--text-muted);
    letter-spacing: 0.04em;
}
.trs-form-status {
    display: inline-flex;
    align-items: center;
    font-size: var(--text-xs);
    font-weight: 700;
    padding: 4px 11px;
    border-radius: 20px;
    letter-spacing: 0.04em;
    white-space: nowrap;
    flex-shrink: 0;
}

/* Gauge section */
.trs-gauge-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 4px 16px 2px;
    position: relative;
    z-index: 1;
}
.trs-gauge-glow-wrap {
    position: relative;
    width: 100%;
    max-width: 230px;
}
.trs-gauge-glow-wrap::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 70%;
    height: 30px;
    background: radial-gradient(
        ellipse,
        rgba(0, 229, 160, 0.15) 0%,
        transparent 70%
    );
    pointer-events: none;
}
.trs-gauge-container {
    position: relative;
    width: 100%;
    container-type: inline-size;
}
.trs-gauge-svg {
    width: 100%;
    display: block;
}
.trs-gauge-overlay {
    position: absolute;
    bottom: 6%;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    pointer-events: none;
    white-space: nowrap;
    width: 100%;
}
.trs-gauge-num {
    font-family: var(--font-num);
    font-size: clamp(1.4rem, 14cqw, 2.4rem);
    font-weight: 700;
    line-height: 1;
    color: var(--text-primary);
    font-variant-numeric: tabular-nums;
    text-shadow: 0 0 24px rgba(0, 229, 160, 0.3);
}
.trs-gauge-unit {
    font-size: clamp(0.6rem, 3.5cqw, var(--text-xs));
    color: var(--text-muted);
    margin-top: 2px;
    letter-spacing: 0.05em;
    text-transform: uppercase;
}
.trs-ramp-meta {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    margin-top: 2px;
}

/* Badge */
.trs-badge {
    display: inline-block;
    font-size: var(--text-xs);
    font-weight: 700;
    padding: 3px 10px;
    border-radius: 20px;
    letter-spacing: 0.04em;
}
.trs-badge--green {
    background: rgba(0, 229, 160, 0.15);
    color: var(--accent);
    box-shadow: 0 0 12px rgba(0, 229, 160, 0.12);
}
.trs-badge--green-dim {
    background: rgba(0, 229, 160, 0.12);
    color: var(--accent);
}
.trs-badge--yellow {
    background: rgba(240, 196, 41, 0.15);
    color: var(--yellow);
}
.trs-badge--red {
    background: rgba(255, 71, 87, 0.15);
    color: var(--red);
}
.trs-badge--blue {
    background: rgba(74, 158, 255, 0.15);
    color: var(--blue);
}
.trs-form-hint {
    font-size: var(--text-xs);
    color: var(--text-muted);
    text-align: center;
}

/* CTL / ATL / TSB metrics row */
.trs-metrics-row {
    display: flex;
    align-items: stretch;
    margin: 8px 16px;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: 12px;
    overflow: hidden;
    position: relative;
    z-index: 1;
}
.trs-metric-tile {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 14px 8px 12px;
    gap: 2px;
    text-align: center;
    min-width: 0;
}
.trs-metrics-sep {
    width: 1px;
    background: rgba(255, 255, 255, 0.07);
    flex-shrink: 0;
    align-self: stretch;
}
.trs-metric-val {
    font-family: var(--font-num);
    font-size: clamp(1.4rem, 5vw, 2rem);
    font-weight: 700;
    line-height: 1;
    color: var(--text-primary);
    font-variant-numeric: tabular-nums;
}
.trs-metric-val--form {
    /* color is set inline by JS based on TSB value */
}
.trs-metric-name {
    font-size: var(--text-xs);
    font-weight: 700;
    color: var(--text-secondary);
    letter-spacing: 0.06em;
    text-transform: uppercase;
    margin-top: 3px;
}
.trs-metric-desc {
    font-size: 10px;
    color: var(--text-muted);
    letter-spacing: 0.03em;
}

/* Reused label style */
.trs-metric-label {
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    margin-bottom: 2px;
}

/* Aerobic Efficiency sparkline section */
.trs-ef-wrap {
    background: rgba(255, 255, 255, 0.025);
    border-top: 1px solid rgba(255, 255, 255, 0.06);
    padding: 12px 0 0;
    overflow: hidden;
    margin-top: auto;
    position: relative;
    z-index: 1;
}
.trs-ef-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
    padding: 0 16px;
}
.trs-ef-nums {
    display: flex;
    align-items: baseline;
    gap: 8px;
    flex-shrink: 0;
}
#trsEFCurrent {
    font-size: var(--text-base);
    font-weight: 700;
    color: var(--text-primary);
    font-variant-numeric: tabular-nums;
}
#trsEFDelta {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--accent);
}
.trs-ef-chart-area {
    height: 96px;
}
.trs-ef-footer {
    display: none;
}

/* Activity detail — data source / device attribution footer */
.detail-source-footer {
    font-size: 11px;
    color: var(--text-muted);
    text-align: center;
    padding: 10px 16px 18px;
    line-height: 1.6;
    opacity: 0.7;
}
.detail-source-footer strong {
    font-weight: 500;
    color: var(--text-secondary);
}
.dsf-sep {
    margin: 0 7px;
    opacity: 0.4;
}
.dsf-link {
    color: var(--text-muted);
    text-decoration: underline;
    text-decoration-color: rgba(148, 163, 184, 0.3);
    text-underline-offset: 2px;
    transition: color var(--transition);
}
.dsf-link:hover {
    color: var(--accent);
    text-decoration-color: var(--accent);
}

/* ── Export buttons ─────────────────────────────────────────────────────── */
.detail-export-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    padding: 0 16px 16px;
}

.detail-export-btn {
    flex: 1;
    min-width: 140px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    font-size: 13px;
    font-weight: 500;
}

.detail-export-btn svg {
    width: 16px;
    height: 16px;
    flex-shrink: 0;
}

.detail-export-btn:hover {
    background: var(--bg-elevated);
    color: var(--accent);
}

@media (max-width: 600px) {
    .detail-export-btn {
        flex: 1;
        min-width: auto;
    }
}

/* ── External floating chart tooltip ──────────────────────────────────── */
#chartTooltipFloat {
    position: fixed;
    z-index: 9999;
    pointer-events: none;
    background: rgba(11, 14, 22, 0.88);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
    border: 1px solid rgba(255, 255, 255, 0.07);
    border-radius: 10px;
    padding: 10px 14px 11px;
    font-size: 12px;
    white-space: nowrap;
    opacity: 0;
    transition: opacity 0.12s ease;
    transform: translateY(-100%);
    box-shadow:
        0 8px 24px rgba(0, 0, 0, 0.55),
        0 1px 0 rgba(255, 255, 255, 0.04) inset;
}
.ctf-title {
    color: #6b7899;
    font-size: 10.5px;
    font-weight: 500;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    margin-bottom: 8px;
    padding-bottom: 7px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    line-height: 1.3;
}
.ctf-row {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #dde2f0;
    font-size: 12.5px;
    line-height: 1.75;
}
.ctf-swatch {
    width: 7px;
    height: 7px;
    border-radius: 50%;
    flex-shrink: 0;
    box-shadow: 0 0 5px currentColor;
}

/* Note shown below the activities list for placeholder/no-data entries */
.act-empty-note {
    text-align: center;
    font-size: var(--text-sm);
    color: var(--text-muted);
    padding: 10px 16px 6px;
    letter-spacing: 0.01em;
}

/* ============================================================
   TRAINING GUIDE PAGE
============================================================ */
.guide-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--gap-layout);
    align-items: start;
}

/* Intro banner spans full width */
.guide-intro-card {
    grid-column: 1 / -1;
    display: flex;
    align-items: flex-start;
    gap: 16px;
}
.guide-intro-icon {
    flex-shrink: 0;
    width: 44px;
    height: 44px;
    border-radius: 12px;
    background: var(--accent-dim);
    color: var(--accent);
    display: flex;
    align-items: center;
    justify-content: center;
}
.guide-intro-icon svg {
    width: 22px;
    height: 22px;
}
.guide-intro-title {
    font-size: var(--text-lg);
    font-weight: 700;
    margin-bottom: 6px;
}
.guide-intro-sub {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    line-height: 1.6;
}

/* Individual metric cards */
.guide-metric-card {
    display: flex;
    flex-direction: column;
    gap: 16px;
}
.guide-metric-header {
    display: flex;
    align-items: center;
    gap: 14px;
    justify-content: space-between;
}
.guide-metric-header > div:not(.guide-metric-badge) {
    flex: 1;
}
.guide-metric-badge {
    font-family: var(--font-num);
    font-size: var(--text-lg);
    font-weight: 700;
    padding: 6px 14px;
    border-radius: 10px;
    letter-spacing: -0.5px;
    flex: 0 0 auto;
    align-self: flex-start;
    width: fit-content;
}
.guide-metric-name {
    font-size: var(--text-base);
    font-weight: 700;
}
.guide-metric-aka {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 2px;
    text-transform: uppercase;
    letter-spacing: 0.06em;
}
.guide-metric-desc {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    line-height: 1.65;
}

/* Zone bars */
.guide-zones {
    display: flex;
    flex-direction: column;
    gap: 4px;
    background: var(--bg-elevated);
    border-radius: var(--radius);
    padding: 10px 14px;
}
.guide-zone-row {
    display: grid;
    grid-template-columns: 56px 90px 1fr;
    align-items: center;
    gap: 12px;
    padding: 6px 0;
    border-bottom: 1px solid var(--border);
}
.guide-zone-row:last-child {
    border-bottom: none;
}
.guide-zone-bar {
    height: 7px;
    border-radius: 3px;
    max-width: 100%;
}
.guide-zone-label {
    font-family: var(--font-num);
    font-size: var(--text-xs);
    font-weight: 700;
    color: var(--text-primary);
    white-space: nowrap;
}
.guide-zone-desc {
    font-size: var(--text-sm);
    color: var(--text-muted);
    line-height: 1.4;
}

/* Tip row */
.guide-tip {
    font-size: var(--text-xs);
    color: var(--text-secondary);
    background: var(--bg-elevated);
    border-left: 3px solid var(--accent);
    border-radius: 0 var(--radius) var(--radius) 0;
    padding: 8px 12px;
    line-height: 1.5;
}

/* Quick reference card spans full width */
.guide-ref-card {
    grid-column: 1 / -1;
}
.guide-ref-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--gap-layout);
    margin-top: 4px;
}
.guide-ref-item {
    background: var(--bg-elevated);
    border-radius: var(--radius);
    padding: 12px 14px;
}
.guide-ref-label {
    font-size: var(--text-sm);
    font-weight: 600;
    margin-bottom: 5px;
}
.guide-ref-val {
    font-size: var(--text-xs);
    color: var(--text-secondary);
    line-height: 1.5;
}

@media (max-width: 700px) {
    .guide-grid {
        grid-template-columns: 1fr;
    }
    .guide-ref-grid {
        grid-template-columns: 1fr;
    }
}

/* ============================================================
   FITNESS PAGE — ZONE DISTRIBUTION CARD
============================================================ */
.fit-zone-tabs {
    display: flex;
    gap: 4px;
}
.fit-zone-tab {
    font-size: var(--text-xs);
    font-weight: 600;
    padding: 4px 10px;
    border-radius: 20px;
    border: 1px solid var(--border);
    color: var(--text-muted);
    background: none;
    cursor: pointer;
    transition: all var(--transition);
}
.fit-zone-tab.active,
.fit-zone-tab:hover {
    background: var(--accent-dim);
    border-color: var(--accent);
    color: var(--accent);
}

/* KPI strip */
.fit-zone-kpis {
    display: flex;
    gap: 0;
    margin-bottom: 16px;
    background: var(--bg-elevated);
    border-radius: var(--radius);
    overflow: hidden;
}
.fit-zone-kpi {
    flex: 1;
    padding: 10px 14px;
    border-right: 1px solid var(--border);
}
.fit-zone-kpi:last-child {
    border-right: none;
}
.fit-zone-kpi-val {
    font-size: var(--text-md);
    font-weight: 700;
    line-height: 1;
    margin-bottom: 3px;
}
.fit-zone-kpi-lbl {
    font-size: var(--text-2xs);
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.07em;
}

/* Chart + rows layout */
.fit-zone-body {
    display: flex;
    gap: 20px;
    align-items: center;
    margin-bottom: 16px;
}
.fit-zone-chart-wrap {
    position: relative;
    flex-shrink: 0;
    width: 160px;
    height: 160px;
    container-type: inline-size;
}
.fit-zone-pie-center {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    pointer-events: none;
}
.fit-zone-pie-pct {
    font-size: 1.6rem;
    font-weight: 800;
    line-height: 1;
}
.fit-zone-pie-lbl {
    font-size: var(--text-xs);
    color: var(--text-muted);
    font-weight: 600;
    margin-top: 2px;
    text-transform: uppercase;
    letter-spacing: 0.06em;
}

/* Zone rows */
.fit-zone-rows {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 9px;
}
.fit-zone-row {
    display: flex;
    align-items: center;
    gap: 7px;
}
.fit-zone-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
}
.fit-zone-row-info {
    flex: 1;
    min-width: 0;
}
.fit-zone-row-top {
    display: flex;
    align-items: baseline;
    gap: 6px;
    margin-bottom: 4px;
}
.fit-zone-tag {
    font-size: var(--text-xs);
    font-weight: 700;
}
.fit-zone-name {
    font-size: var(--text-xs);
    color: var(--text-secondary);
}
@media (max-width: 480px) {
    .fit-zone-name {
        display: none;
    }
}
.fit-zone-watts {
    font-size: var(--text-2xs);
    color: var(--text-muted);
    margin-left: auto;
}
.fit-zone-bar-track {
    height: 12px;
    background: var(--bg-elevated);
    border-radius: 3px;
    overflow: hidden;
}
.fit-zone-bar-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}
.fit-zone-row-stats {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 1px;
    flex-shrink: 0;
    min-width: 44px;
}
.fit-zone-pct {
    font-size: var(--text-sm);
    font-weight: 700;
}
.fit-zone-time {
    font-size: var(--text-2xs);
    color: var(--text-muted);
}

/* Balance bar + style label */
.fit-zone-balance {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 4px;
}
.fit-zone-balance-label {
    display: flex;
    align-items: center;
    gap: 8px;
}
.fit-zone-style-tag {
    font-size: var(--text-xs);
    font-weight: 700;
    padding: 3px 10px;
    border-radius: 20px;
    flex-shrink: 0;
}
.fit-zone-style-hint {
    font-size: var(--text-xs);
    color: var(--text-muted);
}

@media (max-width: 600px) {
    .fit-zone-body {
        flex-direction: column;
        align-items: stretch;
    }
    .fit-zone-chart-wrap {
        width: 140px;
        height: 140px;
        align-self: center;
    }
    .fit-zone-kpis {
        flex-wrap: wrap;
    }
    .fit-zone-kpi {
        flex: 1 1 33%;
    }
}

/* ============================================================
   POWER PAGE
============================================================ */

/* ── Hero row (4 stat cards) ── */
.pwr-hero-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
}
@media (max-width: 800px) {
    .pwr-hero-row {
        grid-template-columns: repeat(2, 1fr);
    }
}
@media (max-width: 480px) {
    .pwr-hero-row {
        grid-template-columns: 1fr 1fr;
    }
}
.pwr-hero-sub {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 2px;
}
/* Text-value stat (category label) — smaller font so it fits */
.pwr-stat-text {
    font-size: 1.1rem !important;
    letter-spacing: -0.3px !important;
    line-height: 1.2 !important;
    margin-top: 4px;
}

/* ── FTP badge pill in card header ── */
.pwr-ftp-badge {
    flex-shrink: 0;
}
.pwr-ftp-badge-inner {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    background: rgba(0, 229, 160, 0.12);
    border: 1px solid rgba(0, 229, 160, 0.3);
    border-radius: 20px;
    padding: 4px 12px;
    font-size: var(--text-sm);
    color: var(--accent);
}
.pwr-ftp-badge-inner span {
    font-weight: 500;
    color: var(--text-secondary);
}
.pwr-ftp-badge-inner strong {
    font-weight: 700;
}

/* ── Zone table ── */
.pwr-zone-header {
    display: grid;
    grid-template-columns: 36px 90px 90px 72px 1fr 1fr;
    gap: 6px 10px;
    padding: 0 0 6px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 4px;
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
    align-items: center;
}
.pwr-zh-bar {
    /* empty spacer header */
}

.pwr-zone-row {
    display: grid;
    grid-template-columns: 36px 90px 90px 72px 1fr 1fr;
    gap: 6px 10px;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.04);
    transition: background var(--transition);
}
.pwr-zone-row:last-child {
    border-bottom: none;
}
.pwr-zone-row:hover {
    background: rgba(255, 255, 255, 0.025);
    border-radius: 6px;
}
.pwr-zone-id {
    font-size: var(--text-sm);
    font-weight: 800;
    font-family: var(--font-num);
}
.pwr-zone-name {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-primary);
}
.pwr-zone-watts,
.pwr-zone-wkg {
    font-family: var(--font-num);
    font-size: var(--text-sm);
    color: var(--text-secondary);
    white-space: nowrap;
}
.pwr-zone-bar-wrap {
    height: 6px;
    background: rgba(255, 255, 255, 0.06);
    border-radius: 3px;
    overflow: hidden;
}
.pwr-zone-bar {
    height: 100%;
    border-radius: 3px;
    transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}
.pwr-zone-desc {
    font-size: var(--text-xs);
    color: var(--text-muted);
    line-height: 1.4;
}

/* ── W/kg callout in peak pills ── */
.curve-peak-wkg {
    display: block;
    font-size: 9px;
    color: var(--text-muted);
    font-weight: 500;
    margin-top: 1px;
}

/* ── Empty / hint text ── */
.pwr-empty-note {
    font-size: var(--text-sm);
    color: var(--text-muted);
    padding: 10px 0;
}

/* ── Insight / encouragement cards ── */
.pwr-insights-row {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 12px;
}
.pwr-insight-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 16px;
    display: flex;
    gap: 14px;
    align-items: flex-start;
    transition:
        border-color var(--transition),
        box-shadow var(--transition);
    border-left: 3px solid var(--ic-color, var(--accent));
}
.pwr-insight-card:hover {
    border-color: var(--border-active);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}
.pwr-insight-icon {
    flex-shrink: 0;
    width: 32px;
    height: 32px;
    border-radius: 8px;
    background: rgba(0, 229, 160, 0.12);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--ic-color, var(--accent));
}
.pwr-insight-icon svg {
    width: 16px;
    height: 16px;
    stroke: currentColor;
}
.pwr-insight-body {
    flex: 1;
    min-width: 0;
}
.pwr-insight-title {
    font-size: var(--text-sm);
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 4px;
}
.pwr-insight-text {
    font-size: var(--text-xs);
    color: var(--text-secondary);
    line-height: 1.55;
}
.pwr-insight-text strong {
    color: var(--text-primary);
    font-weight: 600;
}

/* ── Responsive: stack zone table columns on narrow screens ── */
@media (max-width: 700px) {
    .pwr-zone-header {
        grid-template-columns: 36px 1fr 70px 1fr;
    }
    .pwr-zone-header .pwr-zh-wkg,
    .pwr-zone-header .pwr-zh-bar {
        display: none;
    }
    .pwr-zone-row {
        grid-template-columns: 36px 1fr 70px 1fr;
    }
    .pwr-zone-wkg,
    .pwr-zone-bar-wrap {
        display: none;
    }
    .pwr-zone-desc {
        font-size: 10px;
    }
}
@media (max-width: 500px) {
    .pwr-zone-header {
        grid-template-columns: 36px 80px 1fr;
    }
    .pwr-zone-header .pwr-zh-desc,
    .pwr-zone-header .pwr-zh-watts {
        display: none;
    }
    .pwr-zone-row {
        grid-template-columns: 36px 80px 1fr;
    }
    .pwr-zone-desc,
    .pwr-zone-watts {
        display: none;
    }
    .pwr-insights-row {
        grid-template-columns: 1fr;
    }
}

/* ============================================================
   WEATHER
============================================================ */

/* ── Universal "data not available" injected message ──
   Used by showCardNA() across all activity detail cards.
─────────────────────────────────────────────────────── */
/* Card in "not available" state — flex column so the message can fill + centre */
.card--na {
    display: flex !important;
    flex-direction: column;
    min-height: 160px;
}
.card--na .card-header {
    flex-shrink: 0;
}
.detail-na-inject {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 9px;
    padding: 24px 16px;
    color: var(--text-muted);
    font-size: var(--text-sm);
}

/* ── Outside temperature chart card ── */
.detail-temp-wrap {
    position: relative;
}
.detail-temp-unavailable {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 10px;
    color: var(--text-muted);
    font-size: var(--text-sm);
    pointer-events: none;
}
.detail-temp-unavailable svg {
    opacity: 0.4;
}

/* ── Activity weather card (Ride Conditions) ── */
.wx-tiles {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 4px;
}
.wx-tile {
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 10px 14px;
    min-width: 88px;
}
.wx-tile--main {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 12px 18px;
    flex: 0 0 auto;
    min-width: 0;
}
.wx-main-icon {
    width: 40px;
    height: 40px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
}
.wx-main-icon svg {
    width: 100%;
    height: 100%;
}
.wx-main-info {
    display: flex;
    flex-direction: column;
    gap: 3px;
}
.wx-condition {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-primary);
    text-transform: capitalize;
}
.wx-temp {
    font-size: var(--text-xl);
    font-weight: 800;
    font-family: var(--font-num);
    letter-spacing: -1px;
    line-height: 1;
    color: var(--text-primary);
}
.wx-riding-pill {
    display: inline-flex;
    align-items: center;
    font-size: var(--text-xs);
    font-weight: 600;
    padding: 2px 8px;
    border-radius: 20px;
    margin-top: 2px;
    width: fit-content;
}
.wx-riding-pill--good {
    background: rgba(0, 229, 160, 0.15);
    color: var(--accent);
}
.wx-riding-pill--fair {
    background: rgba(240, 196, 41, 0.15);
    color: var(--yellow);
}
.wx-riding-pill--poor {
    background: rgba(255, 71, 87, 0.15);
    color: var(--red);
}
.wx-lbl {
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
    margin-bottom: 4px;
}
.wx-val {
    font-size: var(--text-base);
    font-weight: 700;
    font-family: var(--font-num);
    color: var(--text-primary);
}
.wx-sub {
    font-size: var(--text-xs);
    font-weight: 500;
    color: var(--text-secondary);
}

/* ── Weather chip on recent activity cards ── */
.ra-wx-chip {
    display: flex;
    align-items: center;
    gap: 5px;
    margin-top: 8px;
    padding-top: 8px;
    border-top: 1px solid var(--border);
}
.ra-wx-icon {
    width: 18px;
    height: 18px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
}
.ra-wx-icon svg {
    width: 100%;
    height: 100%;
}
.ra-wx-temp {
    font-size: var(--text-xs);
    font-weight: 700;
    font-family: var(--font-num);
    color: var(--text-secondary);
}
.ra-wx-wind {
    font-size: var(--text-xs);
    color: var(--text-muted);
}
.ra-wx-wind::before {
    content: "·";
    margin-right: 5px;
    color: var(--border-active);
}

/* ── 7-day forecast card (dashboard) ── */
.wx-forecast-row {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 8px;
    margin-top: 8px;
}

/* ── Individual day card ── */
.wx-day {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    padding: 14px 8px 12px;
    border-radius: var(--radius-lg);
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    position: relative;
    --mouse-x: 50%;
    --mouse-y: 50%;
    cursor: pointer;
    transition:
        border-color var(--transition),
        box-shadow var(--transition);
    overflow: hidden;
}

/* Score tint — subtle top glow from the card's accent colour */
.wx-day--good {
    --wx-score-rgb: 0, 229, 160;
}
.wx-day--fair {
    --wx-score-rgb: 240, 196, 41;
}
.wx-day--poor {
    --wx-score-rgb: 255, 71, 87;
}

.wx-day::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.055) 0%,
        transparent 65%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
}

/* rim glow */
.wx-day::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 1px;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.3) 0%,
        transparent 60%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
    -webkit-mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
}

.wx-day:hover {
    border-color: transparent;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}
.wx-day:hover::before,
.wx-day:hover::after {
    opacity: 1;
}

.wx-day-name {
    font-size: var(--text-xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--text-secondary);
    position: relative;
    z-index: 1;
}
.wx-day--today .wx-day-name {
    color: var(--accent);
}

.wx-day-icon {
    width: 34px;
    height: 34px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    z-index: 1;
}
.wx-day-icon svg {
    width: 100%;
    height: 100%;
}

.wx-day-label {
    font-size: 10px;
    color: var(--text-muted);
    text-align: center;
    line-height: 1.25;
    min-height: 22px;
    display: flex;
    align-items: center;
    position: relative;
    z-index: 1;
}

.wx-day-temps {
    display: flex;
    gap: 4px;
    align-items: baseline;
    position: relative;
    z-index: 1;
}
.wx-day-hi {
    font-size: var(--text-sm);
    font-weight: 700;
    font-family: var(--font-num);
    color: var(--text-primary);
}
.wx-day-lo {
    font-size: var(--text-xs);
    font-weight: 500;
    font-family: var(--font-num);
    color: var(--text-muted);
}

.wx-day-precip {
    font-size: var(--text-xs);
    color: #60a5fa;
    font-weight: 600;
    font-family: var(--font-num);
    min-height: 16px;
    display: flex;
    align-items: center;
    gap: 2px;
    position: relative;
    z-index: 1;
}

/* Score badge pill at bottom */
.wx-score-badge {
    font-size: 9px;
    font-weight: 700;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    padding: 2px 7px;
    border-radius: 20px;
    position: relative;
    z-index: 1;
}
.wx-score-badge--good {
    background: rgba(0, 229, 160, 0.15);
    color: var(--accent);
}
.wx-score-badge--fair {
    background: rgba(240, 196, 41, 0.15);
    color: var(--yellow);
}
.wx-score-badge--poor {
    background: rgba(255, 71, 87, 0.15);
    color: var(--red);
}

.wx-riding-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
}
.wx-riding-dot--good {
    background: var(--accent);
    box-shadow: 0 0 5px rgba(0, 229, 160, 0.6);
}
.wx-riding-dot--fair {
    background: var(--yellow);
}
.wx-riding-dot--poor {
    background: var(--red);
}

/* Legend in forecast card header */
.wx-legend {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-shrink: 0;
}
.wx-legend-item {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: var(--text-xs);
    color: var(--text-muted);
}

@media (max-width: 700px) {
    .wx-forecast-row {
        grid-template-columns: repeat(4, 1fr);
    }
    .wx-forecast-row .wx-day:nth-child(n + 5) {
        display: none;
    }
    .wx-legend {
        display: none;
    }
}
@media (max-width: 480px) {
    .wx-forecast-row {
        grid-template-columns: repeat(3, 1fr);
    }
    .wx-forecast-row .wx-day:nth-child(n + 4) {
        display: none;
    }
    .wx-tile--main {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
    .wx-tiles {
        flex-direction: column;
    }
}

/* ── Weather location — settings card ── */
.wx-location-input-row {
    display: flex;
    gap: 8px;
    width: 100%;
}
.wx-city-input {
    flex: 1;
    height: 36px;
    padding: 0 12px;
    border-radius: 8px;
    border: 1.5px solid var(--border);
    background: var(--bg-base);
    color: var(--text-primary);
    font-size: 14px;
    outline: none;
    transition: border-color 0.15s;
}
.wx-city-input:focus {
    border-color: var(--accent);
}
.wx-city-input::placeholder {
    color: var(--text-muted);
    opacity: 0.45;
}

/* ── No-location placeholder in forecast card ── */
.wx-no-location {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    padding: 24px 16px;
    text-align: center;
    color: var(--text-secondary);
    font-size: 14px;
}
.wx-no-location svg {
    opacity: 0.4;
}
.wx-no-location p {
    margin: 0;
    line-height: 1.5;
}

/* =====================================================
   WEATHER PAGE
===================================================== */

/* Weather page root — must have min-width:0 so it shrinks as a flex child
   of .page-content (otherwise the flex item expands to content width and
   the inner scroll container never gets a chance to trigger) */
#weatherPageContent {
    min-width: 0;
    width: 100%;
}

/* Loading / empty states */
.wx-page-loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    padding: 60px 20px;
    color: var(--text-secondary);
    font-size: 14px;
}
.wx-page-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
    padding: 80px 20px;
    text-align: center;
    color: var(--text-secondary);
}
.wx-page-empty h3 {
    margin: 0;
    font-size: 18px;
    color: var(--text-primary);
}
.wx-page-empty p {
    margin: 0;
    font-size: 14px;
}
.wx-page-empty-icon {
    width: 56px;
    height: 56px;
    opacity: 0.5;
}
.wx-page-empty-icon svg {
    width: 100%;
    height: 100%;
}

/* Location switcher pills */
.wx-loc-switcher {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    margin-bottom: 12px;
}
@media (max-width: 600px) {
    .wx-loc-switcher {
        flex-wrap: nowrap;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        padding-bottom: 4px;
    }
    .wx-loc-switcher::-webkit-scrollbar {
        display: none;
    }
    .wx-loc-pill {
        flex-shrink: 0;
        white-space: nowrap;
    }
}
.wx-loc-pill {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 8px 14px;
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--text-secondary);
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.15s ease;
}
.wx-loc-pill:hover {
    border-color: var(--text-muted);
}
.wx-loc-pill--active {
    background: var(--accent);
    color: #0a0a0a;
    border-color: var(--accent);
}
.wx-loc-pill--active svg {
    stroke: #0a0a0a;
}
.wx-pill-icon {
    display: inline-flex;
    width: 16px;
    height: 16px;
    flex-shrink: 0;
}
.wx-pill-icon svg {
    width: 16px;
    height: 16px;
}

/* Settings location list */
.wx-loc-row {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 12px;
    border-bottom: 1px solid var(--border);
}
.wx-loc-row:last-child {
    border-bottom: none;
}
.wx-loc-row .stt-row-label {
    flex: 1;
    font-size: var(--text-sm);
}
.wx-loc-row--active .stt-row-label {
    font-weight: 600;
}
.wx-loc-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--border);
    display: inline-block;
}
.wx-loc-dot--on {
    background: var(--accent);
    box-shadow: 0 0 0 3px rgba(var(--accent-rgb, 59, 130, 246), 0.2);
}
.wx-loc-activate {
    padding: 4px;
}
.wx-loc-remove {
    padding: 4px;
    opacity: 0.5;
}
.wx-loc-remove:hover {
    opacity: 1;
}

/* Location bar */
.wxp-location-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--text-secondary);
    font-size: 14px;
    margin-bottom: 16px;
}
.wxp-location-bar svg {
    opacity: 0.6;
    flex-shrink: 0;
    width: 18px;
    height: 18px;
}
.wxp-location-bar span {
    font-weight: 500;
}
.wxp-change-loc {
    margin-left: auto;
    font-size: 13px;
}
.wxp-refresh-btn {
    font-size: 13px;
}

/* Today ride window card */
.wxp-window-card {
    margin-bottom: 16px;
}
.wxp-window-inner {
    display: flex;
    align-items: center;
    gap: 18px;
}
.wxp-window-icon {
    width: 48px;
    height: 48px;
    flex-shrink: 0;
    background: var(--bg-elevated);
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 8px;
}
.wxp-window-icon svg {
    width: 100%;
    height: 100%;
}
.wxp-window-text {
    flex: 1;
    min-width: 0;
}
.wxp-window-label {
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--text-muted);
    margin-bottom: 4px;
}
.wxp-window-time {
    font-size: var(--text-xl);
    font-weight: 800;
    font-family: var(--font-num);
    color: var(--text-primary);
    letter-spacing: -0.5px;
}
.wxp-window-time--missed {
    color: var(--text-muted);
    text-decoration: line-through;
    text-decoration-color: var(--text-muted);
}
.wxp-window-missed-note {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 5px;
}
.wxp-window-card--missed .wxp-window-label {
    color: var(--text-muted);
}
.wxp-window-temps {
    font-size: var(--text-lg);
    font-weight: 700;
    font-family: var(--font-num);
    color: var(--text-secondary);
    flex-shrink: 0;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 8px 14px;
}

/* Mini 7-day icon strip */
.wxp-mini-strip {
    display: flex;
    gap: 0;
    margin-bottom: 20px;
    border-bottom: 1px solid var(--border);
    padding-bottom: 16px;
}
.wxp-ms-day {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    padding: 4px 2px;
}
.wxp-ms-label {
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--text-muted);
}
.wxp-ms-icon {
    width: 28px;
    height: 28px;
}
.wxp-ms-icon svg {
    width: 100%;
    height: 100%;
}
.wxp-ms-temp {
    font-size: 12px;
    font-weight: 700;
    font-family: var(--font-num);
    color: var(--text-primary);
}
.wxp-ms-dot {
    width: 5px;
    height: 5px;
    border-radius: 50%;
    margin-top: 1px;
}
.wxp-ms-dot--great {
    background: var(--accent);
}
.wxp-ms-dot--good {
    background: #86efac;
}
.wxp-ms-dot--fair {
    background: var(--yellow);
}
.wxp-ms-dot--poor {
    background: var(--red);
    opacity: 0.5;
}

/* Stat tiles grid */
.wxp-stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    margin-bottom: 28px;
}
.wxp-st {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 12px 8px 10px;
    text-align: center;
    position: relative;
    overflow: hidden;
    transition: box-shadow 0.18s ease;
    --mouse-x: 50%;
    --mouse-y: 50%;
}
.wxp-st::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.055) 0%,
        transparent 65%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
}
.wxp-st::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 1px;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.35) 0%,
        transparent 60%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
    -webkit-mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
}
.wxp-st:hover::before,
.wxp-st:hover::after {
    opacity: 1;
}
.wxp-st:hover {
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
}
.wxp-st--highlight {
    background: var(--bg-card);
    border-color: rgba(0, 229, 160, 0.25);
}
.wxp-st-icon {
    font-size: 18px;
    line-height: 1;
    position: relative;
    z-index: 1;
}
.wxp-st-val {
    font-size: 22px;
    font-weight: 800;
    font-family: var(--font-num);
    color: var(--text-primary);
    line-height: 1;
    position: relative;
    z-index: 1;
}
.wxp-st-val span {
    font-size: 12px;
    font-weight: 500;
    color: var(--text-muted);
}
.wxp-st-lbl {
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
    position: relative;
    z-index: 1;
}
.wxp-st--highlight .wxp-st-val {
    color: var(--accent);
}

/* Legacy stats row (kept for safety) */
.wxp-stats-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin-bottom: 24px;
}
.wxp-stat {
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 12px;
    text-align: center;
}
.wxp-stat-val {
    font-size: 20px;
    font-weight: 800;
    font-family: var(--font-num);
    color: var(--text-primary);
    line-height: 1;
    margin-bottom: 4px;
}
.wxp-stat-lbl {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
}

/* Section titles */
.wxp-section-title {
    font-size: 13px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.07em;
    color: var(--text-muted);
    margin: 0 0 10px;
}
.wxp-section-title--bad {
    color: var(--red);
    margin-top: 20px;
}

/* ── Best Days to Ride — section label + 3-column card grid ── */
.wxp-section-label {
    font-size: var(--text-xs);
    font-weight: 700;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 10px;
    margin-top: 4px;
}
.wxp-best-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-bottom: 16px;
}
.wxp-best-card {
    display: flex;
    flex-direction: column;
    gap: 6px;
    padding: 12px;
    position: relative;
    overflow: hidden;
    transition: box-shadow 0.18s ease;
    cursor: pointer;
    --mouse-x: 50%;
    --mouse-y: 50%;
}
.wxp-best-card::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.055) 0%,
        transparent 65%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
}
.wxp-best-card::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 1px;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.35) 0%,
        transparent 60%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
    -webkit-mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
}
.wxp-best-card:hover::before,
.wxp-best-card:hover::after {
    opacity: 1;
}
.wxp-best-card:hover {
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
}
.wxp-best-head {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 6px;
}
.wxp-best-day {
    font-size: 13px;
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1.2;
}
.wxp-best-mid {
    display: flex;
    align-items: center;
    justify-content: space-between;
}
.wxp-best-icon {
    width: 36px;
    height: 36px;
    flex-shrink: 0;
}
.wxp-best-icon svg {
    width: 100%;
    height: 100%;
}
.wxp-best-stats {
    display: flex;
    flex-direction: column;
    gap: 2px;
}
.wxp-best-temp {
    font-size: var(--text-base);
    font-weight: 700;
    color: var(--text-primary);
    font-family: var(--font-num);
    line-height: 1;
}
.wxp-best-low {
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--text-muted);
}
.wxp-best-meta {
    font-size: var(--text-xs);
    color: var(--text-secondary);
    font-family: var(--font-num);
}
.wxp-best-score-bar {
    height: 4px;
    background: var(--bg-elevated);
    border-radius: 2px;
    overflow: hidden;
}
.wxp-best-score-fill {
    height: 100%;
    border-radius: 2px;
    transition: width 0.4s ease;
}
.wxp-best-score--great {
    background: var(--accent);
}
.wxp-best-score--good {
    background: #86efac;
}
.wxp-best-score--fair {
    background: var(--yellow);
}
.wxp-best-tip {
    font-size: var(--text-xs);
    color: var(--text-muted);
    flex: 1;
    line-height: 1.4;
}
.wxp-best-score-num {
    font-size: 20px;
    font-weight: 900;
    font-family: var(--font-num);
    color: var(--text-primary);
    text-align: right;
    line-height: 1;
}
.wxp-best-score-num span {
    font-size: 10px;
    font-weight: 500;
    color: var(--text-muted);
    display: inline;
    margin-top: 1px;
}
.wxp-no-rec-card .wxp-no-rec {
    margin-bottom: 0;
}

@media (max-width: 640px) {
    .wxp-best-grid {
        grid-template-columns: 1fr;
    }
}

/* Best-days recommendation list (legacy — kept for safety) */
.wxp-rec-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 24px;
}
.wxp-rec-card {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 14px 16px;
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-left-width: 3px;
    border-radius: var(--radius);
}
.wxp-rec--great {
    border-left-color: var(--accent);
}
.wxp-rec--good {
    border-left-color: #86efac;
}
.wxp-rec--fair {
    border-left-color: var(--yellow);
}
.wxp-rec-icon {
    width: 36px;
    height: 36px;
    flex-shrink: 0;
}
.wxp-rec-icon svg {
    width: 100%;
    height: 100%;
}
.wxp-rec-info {
    flex: 1;
    min-width: 0;
}
.wxp-rec-day {
    font-size: 15px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 2px;
}
.wxp-rec-detail {
    font-size: 12px;
    color: var(--text-secondary);
    font-family: var(--font-num);
    margin-bottom: 3px;
}
.wxp-rec-tip {
    font-size: 12px;
    color: var(--text-muted);
}
.wxp-rec-score {
    font-size: 28px;
    font-weight: 900;
    font-family: var(--font-num);
    color: var(--accent);
    letter-spacing: -1px;
    flex-shrink: 0;
    text-align: right;
}
.wxp-rec-score span {
    font-size: 11px;
    font-weight: 500;
    color: var(--text-muted);
    display: block;
}

/* Days to avoid */
.wxp-avoid-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 24px;
}
.wxp-avoid-card {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    background: rgba(255, 71, 87, 0.06);
    border: 1px solid rgba(255, 71, 87, 0.2);
    border-radius: var(--radius);
}
.wxp-avoid-icon {
    width: 28px;
    height: 28px;
    flex-shrink: 0;
}
.wxp-avoid-icon svg {
    width: 100%;
    height: 100%;
}
.wxp-avoid-info {
    flex: 1;
    min-width: 0;
}
.wxp-avoid-day {
    font-size: 14px;
    font-weight: 700;
    color: var(--text-primary);
}
.wxp-avoid-reasons {
    font-size: 12px;
    color: var(--text-secondary);
    margin-top: 2px;
}
.wxp-avoid-score {
    font-size: 22px;
    font-weight: 800;
    font-family: var(--font-num);
    color: var(--red);
    flex-shrink: 0;
}
.wxp-avoid-score span {
    font-size: 10px;
    color: var(--text-muted);
}
.wxp-no-rec {
    padding: 16px;
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 13px;
    color: var(--text-secondary);
    text-align: center;
}

/* Full week grid — horizontally scrollable */
/* Same pattern as .recent-act-scroll-rail — proven to work */
.wxp-week-scroll {
    display: flex;
    gap: 12px;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none; /* hide scrollbar like recent-acts */
    padding-bottom: 4px;
    margin-bottom: 32px;
    cursor: grab;
    user-select: none;
}
.wxp-week-scroll::-webkit-scrollbar {
    display: none;
}
.wxp-week-scroll.is-dragging {
    cursor: grabbing;
}

/* Data source footer */
.wxp-data-source {
    margin-top: 32px;
    padding: 16px 20px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.wxp-ds-row {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 6px;
    font-size: var(--text-xs);
}
.wxp-ds-label {
    color: var(--text-muted);
}
.wxp-ds-val {
    color: var(--text-secondary);
}
.wxp-ds-sep {
    color: var(--border);
}
.wxp-ds-link {
    color: var(--accent);
    text-decoration: none;
}
.wxp-ds-link:hover {
    text-decoration: underline;
}
.wxp-ds-endpoint {
    color: var(--text-secondary);
    background: var(--bg-base);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 2px 7px;
    font-size: 10px;
    font-family: monospace;
    word-break: break-all;
}

.wxp-day-card {
    flex: 0 0 160px;
    background: var(--bg-card); /* same grey as every .card */
    border: 1px solid var(--border);
    border-radius: var(--radius-lg); /* same rounded corners as .card */
    padding: 14px 12px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    position: relative;
    overflow: hidden;
    transition: box-shadow 0.18s ease;
    --mouse-x: 50%;
    --mouse-y: 50%;
}
/* Spotlight glow — same as recent-act-card */
.wxp-day-card::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.055) 0%,
        transparent 65%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 2;
}
.wxp-day-card::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 1px;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.35) 0%,
        transparent 60%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 2;
    -webkit-mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
}
.wxp-day-card:hover::before,
.wxp-day-card:hover::after {
    opacity: 1;
}
.wxp-day-card:hover {
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
}

.wxp-day-header {
    display: flex;
    flex-direction: column;
    gap: 6px;
}
.wxp-day-name-wrap {
    display: flex;
    align-items: baseline;
    gap: 5px;
}
.wxp-day-name {
    font-size: 12px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-primary);
}
.wxp-day-full {
    font-size: 10px;
    color: var(--text-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
/* icon + badge sit side-by-side below the name */
.wxp-day-icon-row {
    display: flex;
    align-items: center;
    gap: 6px;
}
.wxp-day-icon {
    width: 28px;
    height: 28px;
    flex-shrink: 0;
}
.wxp-day-icon svg {
    width: 100%;
    height: 100%;
}

.wxp-score-badge {
    font-size: 10px;
    font-weight: 700;
    padding: 2px 7px;
    border-radius: 20px;
    white-space: nowrap;
    flex-shrink: 0;
}
.wxp-score--great {
    background: rgba(0, 229, 160, 0.15);
    color: var(--accent);
}
.wxp-score--good {
    background: rgba(134, 239, 172, 0.15);
    color: #4ade80;
}
.wxp-score--fair {
    background: rgba(240, 196, 41, 0.15);
    color: var(--yellow);
}
.wxp-score--poor {
    background: rgba(255, 71, 87, 0.12);
    color: var(--red);
}

.wxp-day-conditions {
    display: flex;
    flex-direction: column;
    gap: 5px;
}
.wxp-cond-row {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 11px;
    color: var(--text-secondary);
}
.wxp-cond-icon {
    width: 14px;
    height: 14px;
    flex-shrink: 0;
}
.wxp-cond-icon svg {
    width: 100%;
    height: 100%;
}
.wxp-cond-label {
    font-size: 10px;
    font-weight: 700;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.04em;
    min-width: 14px;
}
.wxp-cond-val {
    font-size: 11px;
    font-family: var(--font-num);
    font-weight: 500;
    color: var(--text-secondary);
}

/* Score bar */
.wxp-score-bar-wrap {
    height: 4px;
    background: var(--bg-elevated);
    border-radius: 2px;
    overflow: hidden;
}
.wxp-score-bar {
    height: 100%;
    border-radius: 2px;
    transition: width 0.6s ease;
}
.wxp-score-bar--great {
    background: var(--accent);
}
.wxp-score-bar--good {
    background: #4ade80;
}
.wxp-score-bar--fair {
    background: var(--yellow);
}
.wxp-score-bar--poor {
    background: var(--red);
}

.wxp-reasons {
    display: flex;
    flex-direction: column;
    gap: 3px;
}
.wxp-reason {
    font-size: 10px;
    color: var(--text-muted);
    line-height: 1.3;
}

/* Responsive */
@media (max-width: 640px) {
    .wxp-stats-row {
        grid-template-columns: repeat(2, 1fr);
    }
    .wxp-stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    .wxp-best-grid {
        grid-template-columns: 1fr;
    }
    .wxp-ms-icon {
        width: 22px;
        height: 22px;
    }
    .wxp-ms-temp {
        font-size: 10px;
    }
    .wxp-window-time {
        font-size: 18px;
    }
}

/* ============================================================
   WEATHER DAY DETAIL  (wxd-)
============================================================ */

/* Hero section */
.wxd-hero {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 20px;
    margin-bottom: 16px;
}
.wxd-hero-left {
    display: flex;
    align-items: center;
    gap: 14px;
}
.wxd-hero-icon {
    width: 56px;
    height: 56px;
    flex-shrink: 0;
}
.wxd-hero-icon svg {
    width: 100%;
    height: 100%;
}
.wxd-hero-temps {
    display: flex;
    align-items: baseline;
    gap: 6px;
}
.wxd-hero-high {
    font-size: 36px;
    font-weight: 800;
    color: var(--text-primary);
    line-height: 1;
}
.wxd-hero-low {
    font-size: 18px;
    font-weight: 500;
    color: var(--text-muted);
}
.wxd-hero-right {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 10px;
    min-width: 120px;
}
.wxd-hero-badge {
    font-size: 11px !important;
    padding: 3px 9px !important;
}
.wxd-score-bar-wrap {
    width: 100%;
    height: 6px;
    background: var(--border);
    border-radius: 3px;
    overflow: hidden;
}
.wxd-score-bar {
    height: 100%;
    border-radius: 3px;
    transition: width 0.5s ease;
}
.wxd-score-bar--great {
    background: var(--accent);
}
.wxd-score-bar--good {
    background: #86efac;
}
.wxd-score-bar--fair {
    background: var(--yellow);
}
.wxd-score-bar--poor {
    background: var(--red);
}
.wxd-score-num {
    font-size: 22px;
    font-weight: 800;
    color: var(--text-primary);
    text-align: right;
}
.wxd-score-num span {
    font-size: 12px;
    color: var(--text-muted);
    font-weight: 400;
}

/* Key stats row */
.wxd-stats-row {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}
.wxd-stat {
    flex: 1;
    min-width: 72px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 3px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 10px 6px 8px;
    text-align: center;
}
.wxd-stat-icon {
    font-size: 16px;
    line-height: 1;
}
.wxd-stat-val {
    font-size: 13px;
    font-weight: 700;
    color: var(--text-primary);
    white-space: nowrap;
}
.wxd-stat-lbl {
    font-size: 10px;
    color: var(--text-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 90px;
}

/* Ride assessment reasons */
.wxd-reasons {
    display: flex;
    flex-direction: column;
    gap: 6px;
    margin-bottom: 20px;
}
.wxd-reason {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 9px 14px;
    font-size: 13px;
    color: var(--text-secondary);
}

/* Best ride window banner */
.wxd-window-banner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(0, 229, 160, 0.08);
    border: 1px solid rgba(0, 229, 160, 0.25);
    border-radius: var(--radius);
    padding: 12px 18px;
    margin-bottom: 20px;
    gap: 12px;
}
.wxd-window-label {
    font-size: 13px;
    font-weight: 600;
    color: var(--text-secondary);
}
.wxd-window-time {
    font-size: 18px;
    font-weight: 800;
    color: var(--accent);
}

/* Hourly scroll rail */
.wxd-h-legend {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 4px;
    padding: 0 4px 4px;
    font-size: 10px;
    color: var(--text-muted);
    text-align: center;
    /* shown above the scroll, roughly aligned */
    padding-left: 56px; /* icon + time offset */
}
.wxd-hourly-scroll {
    display: flex;
    gap: 8px;
    overflow-x: auto;
    padding: 4px 0 12px;
    margin-bottom: 20px;
    scrollbar-width: none;
    -ms-overflow-style: none;
    cursor: grab;
}
.wxd-hourly-scroll::-webkit-scrollbar {
    display: none;
}
.wxd-hourly-scroll.is-dragging {
    cursor: grabbing;
}

.wxd-h-card {
    flex: 0 0 68px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 10px 6px 8px;
    text-align: center;
}
.wxd-h-time {
    font-size: 11px;
    font-weight: 700;
    color: var(--text-muted);
}
.wxd-h-icon {
    width: 28px;
    height: 28px;
}
.wxd-h-icon svg {
    width: 100%;
    height: 100%;
}
.wxd-h-temp {
    font-size: 14px;
    font-weight: 700;
    color: var(--text-primary);
}
.wxd-h-wind {
    font-size: 10px;
    color: var(--text-secondary);
    white-space: nowrap;
}
.wxd-h-rain {
    font-size: 10px;
    color: var(--text-secondary);
}
.wxd-h-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    margin-top: 2px;
}
.wxd-h-dot--great {
    background: var(--accent);
}
.wxd-h-dot--good {
    background: #86efac;
}
.wxd-h-dot--fair {
    background: var(--yellow);
}
.wxd-h-dot--poor {
    background: var(--red);
    opacity: 0.6;
}

/* Ride planner tips */
.wxd-tips {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 28px;
}
.wxd-tip-card {
    display: flex;
    align-items: flex-start;
    gap: 14px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 14px 16px;
}
.wxd-tip-icon {
    font-size: 22px;
    line-height: 1;
    flex-shrink: 0;
    margin-top: 1px;
}
.wxd-tip-body {
    display: flex;
    flex-direction: column;
    gap: 3px;
}
.wxd-tip-title {
    font-size: 13px;
    font-weight: 700;
    color: var(--text-primary);
}
.wxd-tip-text {
    font-size: 13px;
    color: var(--text-secondary);
    line-height: 1.5;
}

/* Add cursor pointer to clickable day cards */
.wxp-day-card,
.wxp-best-card {
    cursor: pointer;
}

@media (max-width: 480px) {
    .wxd-hero {
        flex-direction: column;
        align-items: flex-start;
    }
    .wxd-hero-right {
        align-items: flex-start;
        width: 100%;
    }
    .wxd-stats-row {
        gap: 6px;
    }
    .wxd-stat {
        min-width: 58px;
        padding: 8px 4px 6px;
    }
    .wxd-stat-val {
        font-size: 12px;
    }
}

/* ============================================================
   ZONES PAGE  (znp-)
============================================================ */

/* Range tabs */
.znp-range-tabs {
    display: flex;
    gap: 6px;
    margin-bottom: 16px;
}
.znp-tab {
    padding: 6px 16px;
    border-radius: 20px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--text-secondary);
    font-size: var(--text-xs);
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition);
}
.znp-tab.active,
.znp-tab:hover {
    background: var(--accent);
    color: #000;
    border-color: var(--accent);
}

/* KPI strip */
.znp-kpi-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-bottom: 16px;
}
.znp-kpi-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 20px 22px 18px;
    position: relative;
    --mouse-x: 50%;
    --mouse-y: 50%;
    transition:
        border-color var(--transition),
        box-shadow var(--transition);
}
.znp-kpi-card::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.055) 0%,
        transparent 65%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
}
.znp-kpi-card::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 1px;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.3) 0%,
        transparent 60%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
    -webkit-mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
}
.znp-kpi-card:hover {
    border-color: transparent;
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.35);
}
.znp-kpi-card:hover::before,
.znp-kpi-card:hover::after {
    opacity: 1;
}

.znp-kpi-label {
    font-size: var(--text-2xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--text-muted);
    margin-bottom: 8px;
    position: relative;
    z-index: 1;
}
.znp-kpi-value {
    font-size: var(--text-2xl);
    font-weight: 800;
    font-family: var(--font-num);
    letter-spacing: -1px;
    line-height: 1;
    position: relative;
    z-index: 1;
}
.znp-kpi-sub {
    font-size: var(--text-xs);
    font-weight: 600;
    margin-top: 7px;
    position: relative;
    z-index: 1;
}

/* Zone distribution cards */
.znp-zones-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 12px;
    align-items: stretch;
}
.znp-zones-row > .card {
    display: flex;
    flex-direction: column;
}
.znp-zones-row > .card > [id$="Balance"] {
    margin-top: auto;
}

/* Total badge in card header */
.znp-total-badge {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--text-muted);
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 3px 10px;
    flex-shrink: 0;
    align-self: center;
}

/* Zone rows */
.znp-zone-row {
    display: grid;
    grid-template-columns: 26px 88px 1fr 50px 36px 34px;
    align-items: center;
    gap: 8px;
    padding: 7px 0;
    border-bottom: 1px solid var(--border);
    font-size: var(--text-xs);
}
.znp-zone-row:last-child {
    border-bottom: none;
}
.znp-zone-row--empty {
    opacity: 0.3;
}

.znp-zone-tag {
    font-size: var(--text-2xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}
.znp-zone-name {
    color: var(--text-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.znp-zone-bar-track {
    background: var(--bg-elevated);
    border-radius: 4px;
    height: 6px;
    overflow: hidden;
}
.znp-zone-bar-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.5s ease;
    min-width: 2px;
}
.znp-zone-time {
    font-family: var(--font-num);
    font-size: var(--text-2xs);
    color: var(--text-muted);
    text-align: right;
}
.znp-zone-pct {
    font-weight: 700;
    font-family: var(--font-num);
    text-align: right;
}
.znp-zone-delta {
    font-size: var(--text-2xs);
    font-weight: 600;
    text-align: right;
}

/* Balance bar */
.znp-balance-bar {
    display: flex;
    height: 8px;
    border-radius: 4px;
    overflow: hidden;
    margin-top: 14px;
    gap: 1px;
}

/* Decoupling chart legend */
.znp-decouple-legend {
    display: flex;
    gap: 20px;
    margin-top: 12px;
    flex-wrap: wrap;
}
.znp-decouple-zone {
    font-size: var(--text-xs);
    display: flex;
    align-items: center;
    gap: 7px;
}
.znp-decouple-zone::before {
    content: "";
    width: 9px;
    height: 9px;
    border-radius: 50%;
    flex-shrink: 0;
}
.znp-decouple-zone--good {
    color: var(--accent);
}
.znp-decouple-zone--fair {
    color: var(--yellow);
}
.znp-decouple-zone--poor {
    color: var(--red);
}
.znp-decouple-zone--good::before {
    background: var(--accent);
}
.znp-decouple-zone--fair::before {
    background: var(--yellow);
}
.znp-decouple-zone--poor::before {
    background: var(--red);
}

/* Insights */
.znp-insights-row {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 4px;
}
.znp-insight {
    display: flex;
    gap: 16px;
    padding: 18px 20px;
    border-radius: var(--radius-lg);
    border: 1px solid var(--border);
    background: var(--bg-card);
}
.znp-insight--warning {
    border-color: rgba(251, 191, 36, 0.3);
    background: rgba(251, 191, 36, 0.04);
}
.znp-insight--good {
    border-color: rgba(0, 229, 160, 0.3);
    background: rgba(0, 229, 160, 0.04);
}
.znp-insight-icon {
    font-size: 22px;
    flex-shrink: 0;
    line-height: 1.2;
    margin-top: 1px;
}
.znp-insight-body {
    flex: 1;
    min-width: 0;
}
.znp-insight-title {
    font-size: var(--text-sm);
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 5px;
}
.znp-insight-text {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: 8px;
}
.znp-insight-tip {
    font-size: var(--text-xs);
    color: var(--text-muted);
    font-style: italic;
}
.znp-empty {
    padding: 24px 0;
    color: var(--text-muted);
    font-size: var(--text-sm);
    text-align: center;
}

/* Responsive */
@media (max-width: 860px) {
    .znp-zones-row {
        grid-template-columns: 1fr;
    }
}
@media (max-width: 600px) {
    .znp-kpi-row {
        grid-template-columns: 1fr;
    }
    .znp-zone-row {
        grid-template-columns: 26px 1fr 1fr 50px 36px;
    }
    .znp-zone-delta {
        display: none;
    }
    .znp-decouple-legend {
        gap: 10px;
    }
}

/* ── Activity detail: Aerobic Decoupling card ── */
.detail-decouple-badge {
    font-size: var(--text-sm);
    font-weight: 700;
    font-family: var(--font-num);
    flex-shrink: 0;
    align-self: center;
}
.detail-decouple-halves {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0;
    margin-top: 14px;
    padding: 12px 16px;
    background: var(--bg-elevated);
    border-radius: var(--radius);
}
.detail-decouple-half {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
}
.detail-decouple-half--arrow {
    flex: 2;
    gap: 3px;
}
.detail-decouple-half-label {
    font-size: var(--text-2xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.07em;
    color: var(--text-muted);
}
.detail-decouple-half-val {
    font-size: var(--text-xl);
    font-weight: 800;
    font-family: var(--font-num);
    color: var(--text-primary);
}
.detail-decouple-arrow {
    font-size: 22px;
    line-height: 1;
    font-weight: 700;
}
.detail-decouple-pct {
    font-size: var(--text-xs);
    font-weight: 600;
    text-align: center;
}

/* ── Activity streams chart: zoom controls ── */
.streams-zoom-controls {
    display: flex;
    align-items: center;
    gap: 4px;
    flex-shrink: 0;
}
.streams-zoom-btn {
    width: 30px;
    height: 30px;
    border-radius: var(--radius);
    border: 1px solid var(--border);
    background: var(--bg-elevated);
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all var(--transition);
    padding: 0;
    flex-shrink: 0;
}
.streams-zoom-btn svg {
    width: 14px;
    height: 14px;
}
.streams-zoom-btn:hover {
    background: var(--border);
    color: var(--text-primary);
}
.streams-zoom-btn--reset {
    opacity: 0.35;
}
.streams-footer {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    margin-top: 14px;
    gap: 12px;
    flex-wrap: wrap;
}
.streams-footer .streams-zoom-hint {
    margin-left: auto;
}
.streams-zoom-hint {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: var(--text-2xs);
    color: var(--text-muted);
    flex-shrink: 0;
    transition: opacity 0.3s ease;
}

/* ── Gear Page ─────────────────────────────────────────────────────────────── */
.gear-section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 14px;
}
.gear-section-title {
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--text-primary);
}
.gear-section-sub {
    font-size: var(--text-sm);
    color: var(--text-muted);
    margin-top: 2px;
}

/* Bike cards row */
.gear-bikes-row {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
}
.gear-bikes-loading {
    display: flex;
    align-items: center;
    gap: 10px;
    color: var(--text-muted);
    font-size: var(--text-sm);
    padding: 16px 0;
}
.gear-bike-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 18px 24px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all var(--transition);
    min-width: 130px;
    text-align: center;
}
.gear-bike-card:hover {
    border-color: var(--accent);
    background: var(--bg-elevated);
}
.gear-bike-card--active {
    border-color: var(--accent);
    background: var(--accent-dim);
}
.gear-bike-icon {
    color: var(--accent);
    opacity: 0.8;
}
.gear-bike-card--active .gear-bike-icon {
    opacity: 1;
}
.gear-bike-name {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-primary);
    max-width: 140px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.gear-bike-km {
    font-size: var(--text-xs);
    color: var(--text-muted);
    font-weight: 500;
}
.gear-bike-card--active .gear-bike-km {
    color: var(--accent);
}

/* Components grid */
.gear-components-grid {
    display: flex;
    flex-direction: column;
    gap: 22px;
}
.gear-cat-label {
    font-size: var(--text-xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-bottom: 10px;
}
.gear-cat-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 12px;
}

/* Individual component card */
.gear-comp-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 16px;
    transition: border-color var(--transition);
    display: flex;
    flex-direction: column;
    gap: 6px;
}
.gear-comp-card--warn {
    border-color: #f9731640;
}
.gear-comp-card--overdue {
    border-color: var(--red);
}
.gear-comp-top {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 8px;
}
.gear-comp-name {
    font-size: var(--text-base);
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1.3;
}
.gear-comp-actions {
    display: flex;
    gap: 4px;
    flex-shrink: 0;
}
.gear-icon-btn {
    width: 26px;
    height: 26px;
    border-radius: 7px;
    border: 1px solid var(--border);
    background: var(--bg-elevated);
    color: var(--text-muted);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all var(--transition);
    padding: 0;
}
.gear-icon-btn:hover {
    background: var(--border);
    color: var(--text-primary);
}
.gear-icon-btn--del:hover {
    background: rgba(248, 113, 113, 0.15);
    border-color: var(--red);
    color: var(--red);
}
.gear-comp-meta {
    display: flex;
    align-items: center;
    gap: 5px;
    flex-wrap: wrap;
    font-size: var(--text-sm);
    color: var(--text-secondary);
}
.gear-comp-dot {
    color: var(--text-muted);
    font-size: 10px;
}
.gear-comp-km {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 2px;
}
.gear-comp-bar-wrap {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 4px;
}
.gear-comp-bar-track {
    flex: 1;
    height: 5px;
    background: var(--border);
    border-radius: 99px;
    overflow: hidden;
}
.gear-comp-bar-fill {
    height: 100%;
    border-radius: 99px;
    transition: width 0.4s ease;
}
.gear-comp-bar-label {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--text-muted);
    white-space: nowrap;
    min-width: 40px;
    text-align: right;
}
.gear-comp-bar-label--warn {
    color: #f97316;
}
.gear-comp-bar-label--red {
    color: var(--red);
}

/* Empty state */
.gear-empty-state {
    color: var(--text-muted);
    font-size: var(--text-sm);
    padding: 12px 0;
}
.gear-empty-state--comp {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    padding: 48px 0;
    text-align: center;
}

/* Gear modal form grid */
.gear-form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0 16px;
}
.gear-form-grid .field {
    margin-bottom: 14px;
}
/* gear selects → now use .app-select  (see universal select block above) */

/* ── Training Guide: live data enhancements ─────────────────────────────── */

/* Active zone row highlight */
.guide-zone-row--active {
    background: rgba(255, 255, 255, 0.04);
    border-radius: 8px;
    padding: 6px 10px;
    margin: 0 -10px;
    border-bottom-color: transparent !important;
}
.guide-zone-row--active .guide-zone-desc {
    color: var(--text-secondary);
}

/* "You are here" badge */
.guide-you-badge {
    display: inline-flex;
    align-items: center;
    background: var(--accent);
    color: #000;
    font-size: var(--text-2xs);
    font-weight: 800;
    padding: 4px 12px;
    border-radius: 99px;
    white-space: nowrap;
    flex-shrink: 0;
    margin-left: 4px;
}

/* Personal status card */
.guide-status-card {
    grid-column: 1 / -1;
    background: linear-gradient(
        135deg,
        var(--bg-card) 0%,
        rgba(0, 229, 160, 0.04) 100%
    );
    border-color: rgba(0, 229, 160, 0.2);
}
.guide-status-header {
    display: flex;
    align-items: center;
    gap: 14px;
    margin-bottom: 20px;
}
.guide-status-icon {
    width: 44px;
    height: 44px;
    background: var(--accent-dim);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--accent);
    flex-shrink: 0;
}
.guide-status-title {
    font-size: var(--text-lg);
    font-weight: 800;
    color: var(--text-primary);
}
.guide-status-sub {
    font-size: var(--text-sm);
    color: var(--text-muted);
    margin-top: 2px;
}
.guide-status-kpis {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
    gap: 12px;
}
.guide-status-kpi {
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 14px 16px;
}
.guide-status-kpi-val {
    font-size: 1.5rem;
    font-weight: 800;
    line-height: 1;
    margin-bottom: 6px;
}
.guide-status-kpi-label {
    font-size: var(--text-xs);
    font-weight: 700;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 3px;
}
.guide-status-kpi-desc {
    font-size: var(--text-sm);
    color: var(--text-muted);
    line-height: 1.3;
}

/* ============================================================
   WELLNESS PAGE
============================================================ */
#page-wellness #wellnessPageContent {
    display: flex;
    flex-direction: column;
    gap: var(--gap-layout);
}
.wellness-kpi-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--gap-layout);
}
@media (max-width: 700px) {
    .wellness-kpi-row {
        grid-template-columns: repeat(2, 1fr);
    }
}

/* ============================================================
   CADENCE DISTRIBUTION — highlight label for peak bin
============================================================ */
#detailCadenceChart {
    /* nothing extra needed — chart handles colour */
}

/* ============================================================
   TOUCH / MOBILE — disable mouse-driven card glow entirely
   (hover: none) catches touchscreens; (pointer: coarse) catches
   any device where the primary input is a finger, not a mouse.
============================================================ */
@media (hover: none), (pointer: coarse) {
    .stat-card::before,
    .stat-card::after,
    .recent-act-card::before,
    .recent-act-card::after,
    .fit-kpi-card::before,
    .fit-kpi-card::after,
    .mm-cell::before,
    .mm-cell::after,
    .act-pstat::before,
    .act-pstat::after,
    .act-sstat::before,
    .act-sstat::after,
    .perf-metric::before,
    .perf-metric::after,
    .wx-day::before,
    .wx-day::after,
    .wxp-st::before,
    .wxp-st::after,
    .wxp-best-card::before,
    .wxp-best-card::after,
    .wxp-day-card::before,
    .wxp-day-card::after,
    .znp-kpi-card::before,
    .znp-kpi-card::after,
    .stk-hero-card::after,
    .stk-pb-card::before,
    .stk-pb-card::after,
    .stk-badge--earned::before,
    .stk-badge--earned::after,
    .stk-stat-tile::before,
    .stk-stat-tile::after,
    .goal-dash-card::before,
    .goal-dash-card::after {
        display: none !important;
    }
}

/* Wellness page — no-data hint shown when a metric isn't logged */
.wellness-no-data {
    font-size: var(--text-sm);
    color: var(--text-muted);
    text-align: center;
    padding: 10px 16px 14px;
    font-style: italic;
}

/* ════════════════════════════════════════════════════════════
   STREAKS PAGE
════════════════════════════════════════════════════════════ */

/* ── Hero row ── */
.stk-hero-row {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr;
    gap: 12px;
    margin-bottom: 12px;
}
.stk-hero-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 24px 20px 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    transition:
        border-color var(--transition),
        box-shadow var(--transition);
    position: relative;
    overflow: hidden;
    --mouse-x: 50%;
    --mouse-y: 50%;
}
/* hero cards: ::before is used for decorative top gradient, so use ::after for rim glow */
.stk-hero-card::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 1px;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.35) 0%,
        transparent 60%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
    -webkit-mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
}
.stk-hero-card:hover {
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.35);
}
.stk-hero-card:hover::after {
    opacity: 1;
}
.stk-hero-card::before {
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(
        ellipse at 50% 0%,
        rgba(0, 229, 160, 0.06) 0%,
        transparent 70%
    );
    pointer-events: none;
}
.stk-hero-card--day {
    border-color: rgba(74, 158, 255, 0.2);
}
.stk-hero-card--day::before {
    background: radial-gradient(
        ellipse at 50% 0%,
        rgba(74, 158, 255, 0.07) 0%,
        transparent 70%
    );
}
.stk-hero-card--month {
    border-color: rgba(155, 89, 255, 0.2);
}
.stk-hero-card--month::before {
    background: radial-gradient(
        ellipse at 50% 0%,
        rgba(155, 89, 255, 0.07) 0%,
        transparent 70%
    );
}

/* Streak intensity states */
.stk-hero--warm {
    border-color: rgba(0, 229, 160, 0.3);
    box-shadow: 0 0 24px rgba(0, 229, 160, 0.08);
}
.stk-hero--hot {
    border-color: rgba(0, 229, 160, 0.5);
    box-shadow: 0 0 32px rgba(0, 229, 160, 0.14);
}
.stk-hero--legendary {
    border-color: rgba(0, 229, 160, 0.7);
    box-shadow: 0 0 40px rgba(0, 229, 160, 0.22);
}

.stk-hero-flame {
    font-size: 2rem;
    line-height: 1;
    margin-bottom: 8px;
}
.stk-hero-num {
    font-size: 3.2rem;
    font-weight: 800;
    font-family: var(--font-num);
    color: var(--accent);
    line-height: 1;
    margin-bottom: 6px;
}
.stk-hero-card--day .stk-hero-num {
    color: #4a9eff;
}
.stk-hero-card--month .stk-hero-num {
    color: #9b59ff;
}
.stk-hero-label {
    font-size: var(--text-md);
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 4px;
    letter-spacing: 0.02em;
}
.stk-hero-sub {
    font-size: var(--text-xs);
    color: var(--text-muted);
}

/* ── Weekly calendar heatmap ── */
.stk-cal-legend {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 11px;
    color: var(--text-muted);
}
.stk-leg-dot {
    width: 11px;
    height: 11px;
    border-radius: 3px;
    flex-shrink: 0;
}
.stk-leg-label {
    margin-right: 6px;
}
.stk-leg-0 {
    background: var(--bg-elevated);
}
.stk-leg-1 {
    background: rgba(0, 229, 160, 0.18);
}
.stk-leg-2 {
    background: rgba(0, 229, 160, 0.45);
}
.stk-leg-3 {
    background: rgba(0, 229, 160, 0.85);
}

.stk-cal-wrap {
    overflow-x: auto;
    padding-bottom: 4px;
}
.stk-cal-grid {
    display: inline-flex;
    flex-direction: column;
    gap: 4px;
    min-width: 100%;
}
.stk-cal-month-row,
.stk-cal-cells {
    display: flex;
    gap: 4px;
}
.stk-cal-month-lbl {
    width: 14px;
    flex-shrink: 0;
    font-size: 10px;
    color: var(--text-muted);
    white-space: nowrap;
    overflow: visible;
    text-align: left;
}
.stk-cell {
    width: 14px;
    height: 14px;
    border-radius: 3px;
    flex-shrink: 0;
    cursor: default;
    transition:
        transform 0.1s,
        opacity 0.1s;
    position: relative;
}
.stk-cell:hover {
    transform: scale(1.3);
    z-index: 2;
}
.stk-heat-0 {
    background: var(--bg-elevated);
}
.stk-heat-1 {
    background: rgba(0, 229, 160, 0.18);
}
.stk-heat-2 {
    background: rgba(0, 229, 160, 0.45);
}
.stk-heat-3 {
    background: rgba(0, 229, 160, 0.85);
}
.stk-cell--today {
    box-shadow: 0 0 0 2px var(--accent);
}

@media (max-width: 960px) {
    .stk-cal-wrap {
        overflow-x: visible;
    }
    .stk-cal-grid {
        display: block;
    }
    .stk-cal-month-row {
        display: none;
    }
    .stk-cal-cells {
        flex-wrap: wrap;
    }
}

/* ── Personal bests row ── */
.stk-pb-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-bottom: 12px;
}
.stk-pb-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: 18px 12px;
    gap: 4px;
    position: relative;
    overflow: hidden;
    --mouse-x: 50%;
    --mouse-y: 50%;
    transition:
        border-color var(--transition),
        box-shadow var(--transition);
}
.stk-pb-card::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.055) 0%,
        transparent 65%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
}
.stk-pb-card::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 1px;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.35) 0%,
        transparent 60%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
    -webkit-mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
}
.stk-pb-card:hover {
    border-color: transparent;
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.35);
}
.stk-pb-card:hover::before,
.stk-pb-card:hover::after {
    opacity: 1;
}
.stk-pb-icon {
    font-size: 1.5rem;
    margin-bottom: 4px;
}
.stk-pb-val {
    font-size: 1.25rem;
    font-weight: 800;
    font-family: var(--font-num);
    color: var(--text-primary);
    line-height: 1.2;
}
.stk-pb-label {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--text-secondary);
    margin-top: 2px;
}
.stk-pb-sub {
    font-size: 10.5px;
    color: var(--text-muted);
}

/* ── This-year monthly grid ── */
.stk-months-grid {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 6px;
    padding-top: 4px;
}
.stk-month-tile {
    border-radius: 8px;
    padding: 10px 6px 8px;
    text-align: center;
    background: var(--bg-elevated);
    position: relative;
    overflow: hidden;
}
.stk-month-heat-0 {
    background: var(--bg-elevated);
}
.stk-month-heat-1 {
    background: rgba(0, 229, 160, 0.08);
}
.stk-month-heat-2 {
    background: rgba(0, 229, 160, 0.16);
}
.stk-month-heat-3 {
    background: rgba(0, 229, 160, 0.26);
}
.stk-month-heat-4 {
    background: rgba(0, 229, 160, 0.38);
}
.stk-month--current {
    border: 1px solid rgba(0, 229, 160, 0.4);
    box-shadow: 0 0 12px rgba(0, 229, 160, 0.1);
}
.stk-month--future {
    opacity: 0.3;
}
.stk-month-name {
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
    margin-bottom: 4px;
}
.stk-month-count {
    font-size: 1.1rem;
    font-weight: 800;
    font-family: var(--font-num);
    color: var(--text-primary);
    line-height: 1;
    margin-bottom: 6px;
}
.stk-month-bar {
    height: 3px;
    background: var(--bg-card);
    border-radius: 2px;
    overflow: hidden;
}
.stk-month-bar-fill {
    height: 100%;
    background: var(--accent);
    border-radius: 2px;
    transition: width 0.6s ease;
}
.stk-year-total {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--text-muted);
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 3px 10px;
}

/* ── Badges ── */
.stk-badges-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 10px;
    padding-top: 4px;
}
.stk-badge {
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px 10px 12px;
    text-align: center;
    opacity: 0.38;
    filter: grayscale(1);
    transition:
        opacity 0.3s,
        filter 0.3s,
        border-color var(--transition),
        box-shadow var(--transition);
    position: relative;
    overflow: hidden;
    --mouse-x: 50%;
    --mouse-y: 50%;
}
.stk-badge--earned::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(0, 229, 160, 0.18) 0%,
        transparent 65%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
}
.stk-badge--earned::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 1px;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(0, 229, 160, 0.7) 0%,
        transparent 60%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
    -webkit-mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
}
.stk-badge--earned:hover {
    border-color: rgba(0, 229, 160, 0.5);
    box-shadow: 0 4px 24px rgba(0, 229, 160, 0.15);
}
.stk-badge--earned:hover::before,
.stk-badge--earned:hover::after {
    opacity: 1;
}
.stk-badge--earned {
    opacity: 1;
    filter: none;
    border-color: rgba(0, 229, 160, 0.3);
    background: rgba(0, 229, 160, 0.05);
    will-change: transform;
}
/* Smooth spring-back when the mouse leaves the badge */
.stk-badge--earned.badge-tilt-reset {
    transition:
        transform 0.55s cubic-bezier(0.23, 1, 0.32, 1),
        border-color var(--transition),
        box-shadow var(--transition);
}
.stk-badge-icon {
    font-size: 1.8rem;
    line-height: 1;
    margin-bottom: 8px;
}
.stk-badge-name {
    font-size: 11px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 3px;
}
.stk-badge-desc {
    font-size: 10px;
    color: var(--text-muted);
    line-height: 1.4;
}
.stk-badge-check {
    position: absolute;
    top: 8px;
    right: 8px;
    font-size: 10px;
    font-weight: 700;
    color: var(--accent);
}

/* ── Responsive ── */
@media (max-width: 860px) {
    .stk-hero-row {
        grid-template-columns: 1fr 1fr 1fr;
    }
    .stk-pb-row {
        grid-template-columns: repeat(2, 1fr);
    }
    .stk-months-grid {
        grid-template-columns: repeat(6, 1fr);
    }
}
@media (max-width: 580px) {
    .stk-hero-row {
        grid-template-columns: 1fr;
    }
    .stk-pb-row {
        grid-template-columns: repeat(2, 1fr);
    }
    .stk-months-grid {
        grid-template-columns: repeat(4, 1fr);
    }
    .stk-hero-num {
        font-size: 2.4rem;
    }
}

/* ── Lifetime stats grid ── */
.stk-lifetime-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 10px;
    padding-top: 4px;
}
.stk-lifetime-loading {
    font-size: var(--text-sm);
    color: var(--text-muted);
    padding: 16px 0;
}
.stk-stat-tile {
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 16px 12px 14px;
    display: flex;
    flex-direction: column;
    gap: 3px;
    position: relative;
    overflow: hidden;
    --mouse-x: 50%;
    --mouse-y: 50%;
    transition:
        border-color var(--transition),
        box-shadow var(--transition);
}
.stk-stat-tile::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.055) 0%,
        transparent 65%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
}
.stk-stat-tile::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 1px;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.35) 0%,
        transparent 60%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
    -webkit-mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
}
.stk-stat-tile:hover {
    border-color: transparent;
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.35);
}
.stk-stat-tile:hover::before,
.stk-stat-tile:hover::after {
    opacity: 1;
}
.stk-stat-tile--link {
    cursor: pointer;
}
.stk-stat-tile--link .stk-stat-fun::after {
    content: " →";
    opacity: 0.5;
    font-size: 0.85em;
}
.stk-stat-icon {
    font-size: 1.4rem;
    line-height: 1;
    margin-bottom: 6px;
}
.stk-stat-val {
    font-size: 1.2rem;
    font-weight: 800;
    font-family: var(--font-num);
    color: var(--text-primary);
    line-height: 1.1;
}
.stk-stat-label {
    font-size: 11px;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.04em;
    margin-top: 1px;
}
.stk-stat-fun {
    font-size: 10.5px;
    color: var(--text-muted);
    line-height: 1.4;
    margin-top: 4px;
}

/* ============================================================
   COMPARE PAGE
============================================================ */

/* Control Panel */
.compare-control-panel {
    display: flex;
    flex-wrap: wrap;
    gap: var(--gap-layout);
    margin-bottom: var(--gap-layout);
    padding: 12px;
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border);
}

.compare-selectors {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    flex: 1;
    min-width: 250px;
}

.compare-metric-select {
    display: flex;
    flex-direction: column;
    gap: 4px;
    flex: 1;
    min-width: 140px;
}

.compare-metric-select label {
    font-size: 12px;
    font-weight: 500;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.compare-metric-select select {
    padding: 8px 10px;
    background: var(--bg-elevated);
    color: var(--text-primary);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 14px;
    cursor: pointer;
    transition: border-color var(--transition);
}

.compare-metric-select select:hover {
    border-color: var(--accent);
}

/* Period & Grouping Section */
.compare-period-section {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    align-items: flex-start;
    flex: 1;
}

.compare-period-selector {
    display: flex;
    flex-direction: column;
    gap: 8px;
    flex-shrink: 0;
}

.compare-period-selector label {
    font-size: 12px;
    font-weight: 500;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.compare-range-pills {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
}

.compare-range-pills button {
    padding: 8px 12px;
    background: var(--bg-elevated);
    color: var(--text-secondary);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all var(--transition);
    white-space: nowrap;
}

.compare-range-pills button:hover {
    border-color: var(--accent);
    color: var(--accent);
}

.compare-range-pills button.active {
    background: var(--accent);
    color: var(--bg-base);
    border-color: var(--accent);
}

.compare-grouping-selector,
.compare-yoy-selector {
    display: flex;
    flex-direction: column;
    gap: 8px;
    min-width: 120px;
}

.compare-grouping-selector label,
.compare-yoy-selector label {
    font-size: 12px;
    font-weight: 500;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.compare-grouping-selector select {
    padding: 8px 10px;
    background: var(--bg-elevated);
    color: var(--text-primary);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 13px;
    cursor: pointer;
}

.compare-yoy-selector label {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 4px;
    font-size: 13px;
    font-weight: normal;
    text-transform: none;
    letter-spacing: normal;
    cursor: pointer;
}

.compare-yoy-selector input[type="checkbox"] {
    cursor: pointer;
}

/* Chart Type Toggle */
.chart-type-toggle {
    display: flex;
    gap: 6px;
    background: var(--bg-elevated);
    border-radius: var(--radius);
    padding: 2px;
}

.chart-type-toggle button {
    padding: 6px 12px;
    background: transparent;
    color: var(--text-secondary);
    border: none;
    border-radius: calc(var(--radius) - 2px);
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: all var(--transition);
}

.chart-type-toggle button.active {
    background: var(--accent);
    color: var(--bg-base);
}

/* Modal */
/* Removed duplicate .modal rule — using the one at line 634 instead */

.modal-content {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    max-width: 400px;
    width: 90%;
}

/* Duplicate modal rules removed — using original definitions at line 647+ */

.date-range-inputs {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
}

.date-range-inputs div {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.date-range-inputs label {
    font-size: 12px;
    font-weight: 500;
    color: var(--text-secondary);
}

.date-range-inputs input {
    padding: 8px 10px;
    background: var(--bg-elevated);
    color: var(--text-primary);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 13px;
}

/* Duplicate .modal-footer removed — using original at line 701 */

/* Stats Table */
.compare-stats-table {
    overflow-x: auto;
    padding: 12px 0;
}

.compare-stats-table table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
}

.compare-stats-table th,
.compare-stats-table td {
    padding: 10px 8px;
    text-align: right;
    border-bottom: 1px solid var(--border);
}

.compare-stats-table th:first-child,
.compare-stats-table td:first-child {
    text-align: left;
    font-weight: 500;
    color: var(--text-secondary);
}

.compare-stats-table th {
    font-weight: 600;
    color: var(--text-primary);
    background: var(--bg-elevated);
}

.compare-stats-table .stat-positive {
    color: var(--accent);
}

.compare-stats-table .stat-negative {
    color: var(--red);
}

/* Insights */
.compare-insights {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--gap-layout);
}

.compare-insights-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.compare-insight-item {
    padding: 10px 12px;
    background: var(--bg-elevated);
    border-left: 3px solid var(--accent);
    border-radius: 4px;
    font-size: 13px;
    line-height: 1.4;
}

.compare-insight-item.positive {
    border-left-color: var(--accent);
}

.compare-insight-item.negative {
    border-left-color: var(--red);
}

/* Compare Multiple Metrics */
.compare-metrics-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: 24px;
    margin: 24px var(--pad-page);
}

.compare-metric-card {
    display: flex;
    flex-direction: column;
    border: 1px solid var(--border);
    border-radius: 8px;
    background: var(--bg-card);
    overflow: hidden;
}

.compare-metric-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    border-bottom: 1px solid var(--border);
    background: rgba(255, 255, 255, 0.02);
}

.compare-card-metric-select {
    flex: 1;
    padding: 8px 10px;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    color: var(--text-primary);
    font-size: 13px;
    cursor: pointer;
}

.compare-card-metric-select:hover {
    border-color: var(--accent);
}

.compare-card-remove {
    width: 32px;
    height: 32px;
    padding: 0;
    border: none;
    background: transparent;
    color: var(--text-secondary);
    cursor: pointer;
    font-size: 16px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.compare-card-remove:hover {
    background: rgba(255, 107, 53, 0.1);
    color: var(--orange);
}

.compare-metric-content {
    display: flex;
    flex-direction: column;
    gap: 16px;
    padding: 16px;
}

.compare-chart-wrapper {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.compare-chart-type-toggle {
    display: flex;
    gap: 8px;
}

.compare-chart-type-toggle button {
    padding: 6px 12px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--text-secondary);
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 500;
    transition: all 0.2s;
}

.compare-chart-type-toggle button:hover {
    border-color: var(--accent);
    color: var(--accent);
}

.compare-chart-type-toggle button.active {
    background: var(--accent);
    border-color: var(--accent);
    color: white;
}

.compare-card-stats {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid var(--border);
}

.compare-card-stats-summary {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
}

.stat-item {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.stat-item span:first-child {
    font-size: 12px;
    color: var(--text-secondary);
    text-transform: uppercase;
    font-weight: 500;
    letter-spacing: 0.5px;
}

.stat-item strong {
    font-size: 18px;
    color: var(--text-primary);
    font-weight: 600;
}

.stat-item .stat-prev {
    font-size: 11px;
    color: var(--text-secondary);
}

.stat-item strong.stat-positive {
    color: var(--accent);
}

.stat-item strong.stat-negative {
    color: var(--orange);
}

/* Mobile Responsive */
@media (max-width: 640px) {
    .compare-control-panel {
        flex-direction: column;
    }

    .compare-selectors {
        flex-direction: column;
    }

    .compare-metric-select {
        width: 100%;
    }

    .compare-period-section {
        flex-direction: column;
        width: 100%;
    }

    .compare-period-selector,
    .compare-grouping-selector,
    .compare-yoy-selector {
        width: 100%;
    }

    .compare-range-pills {
        justify-content: space-between;
    }

    .compare-range-pills button {
        flex: 1;
        font-size: 12px;
    }

    .compare-insights {
        grid-template-columns: 1fr;
    }

    .date-range-inputs {
        grid-template-columns: 1fr;
    }

    .modal-content {
        max-width: 90%;
    }

    .compare-metrics-container {
        grid-template-columns: 1fr;
        margin: 16px 0;
    }

    .compare-card-stats-summary {
        grid-template-columns: 1fr;
    }
}

/* ========================== GOALS & TARGETS ========================== */

/* Goals Page Header */
#goalsStreaksSection {
    display: flex;
    flex-direction: column;
    gap: var(--gap-layout);
}

.goals-section-divider {
    margin-top: 12px;
    margin-bottom: 4px;
    padding-top: 24px;
    border-top: 1px solid var(--border);
}

.goals-header {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    margin-bottom: 20px;
}

/* Goals Grid */
.goals-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: var(--gap-layout);
}

/* Goal Card */
.goal-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 14px;
    transition:
        border-color var(--transition),
        box-shadow var(--transition);
}

.goal-card:hover {
    border-color: var(--accent);
    box-shadow: 0 4px 20px rgba(0, 229, 160, 0.08);
}

.goal-card-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
}

.goal-card-metric {
    display: flex;
    align-items: center;
    gap: 10px;
}

.goal-metric-icon {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-elevated);
    color: var(--accent);
    flex-shrink: 0;
}

.goal-card-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
}

.goal-card-period {
    font-size: 12px;
    color: var(--text-secondary);
    margin-top: 2px;
}

.goal-card-actions {
    display: flex;
    gap: 2px;
}

.goal-card-actions button {
    background: none;
    border: none;
    color: var(--text-secondary);
    padding: 4px 6px;
    border-radius: var(--radius);
    cursor: pointer;
    transition: all var(--transition);
    opacity: 0.5;
}

.goal-card:hover .goal-card-actions button {
    opacity: 1;
}

.goal-card-actions button:hover {
    color: var(--text-primary);
    background: var(--bg-elevated);
}

/* Goal Progress Section */
.goal-progress-section {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.goal-progress-bar-wrap {
    width: 100%;
    height: 10px;
    background: var(--bg-elevated);
    border-radius: 5px;
    overflow: visible;
    position: relative;
}

.goal-progress-bar {
    height: 100%;
    border-radius: 5px;
    transition: width 0.6s cubic-bezier(0.22, 1, 0.36, 1);
    min-width: 2px;
    max-width: 100%;
}

.goal-progress-bar--green {
    background: var(--accent);
}
.goal-progress-bar--yellow {
    background: var(--yellow, #f5a623);
}
.goal-progress-bar--red {
    background: var(--red);
}

/* Expected pace marker */
.goal-progress-expected {
    position: absolute;
    top: -2px;
    width: 2px;
    height: 14px;
    background: var(--text-secondary);
    opacity: 0.4;
    border-radius: 1px;
    pointer-events: none;
}

.goal-progress-info {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
}

.goal-progress-value {
    font-size: 20px;
    font-weight: 700;
    color: var(--text-primary);
}

.goal-progress-unit {
    font-size: 13px;
    font-weight: 500;
    color: var(--text-secondary);
}

.goal-progress-badge {
    display: inline-flex;
    align-items: center;
    padding: 3px 10px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.goal-progress-badge--green {
    background: rgba(0, 229, 160, 0.12);
    color: var(--accent);
}
.goal-progress-badge--yellow {
    background: rgba(245, 166, 35, 0.12);
    color: var(--yellow, #f5a623);
}
.goal-progress-badge--red {
    background: rgba(255, 69, 58, 0.12);
    color: var(--red);
}

.goal-progress-pct {
    font-size: 12px;
    color: var(--text-secondary);
}

/* Goal Empty State */
.goals-empty {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-secondary);
}

.goals-empty svg {
    width: 64px;
    height: 64px;
    margin-bottom: 16px;
    opacity: 0.3;
    stroke: var(--text-secondary);
}

.goals-empty h3 {
    font-size: 17px;
    color: var(--text-secondary);
    margin: 0 0 8px 0;
}

.goals-empty p {
    font-size: 14px;
    margin-bottom: 20px;
}

/* Goal Form Overlay */
.goal-form-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.55);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    animation: goalFadeIn 0.2s ease;
}

@keyframes goalFadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

.goal-form-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 24px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 16px 48px rgba(0, 0, 0, 0.3);
}

.goal-form-title {
    font-size: 17px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 20px;
}

.goal-form-field {
    display: flex;
    flex-direction: column;
    gap: 6px;
    margin-bottom: 16px;
}

.goal-form-field label {
    font-size: 12px;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.goal-form-field select,
.goal-form-field input {
    padding: 10px 12px;
    background: var(--bg-elevated);
    color: var(--text-primary);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 14px;
    font-family: inherit;
    transition: border-color var(--transition);
    -moz-appearance: textfield;
}

.goal-form-field select {
    appearance: none;
    -webkit-appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2388929c' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    padding-right: 32px;
    cursor: pointer;
}

.goal-form-field select:focus,
.goal-form-field input:focus {
    outline: none;
    border-color: var(--accent);
}

/* Custom number input wrapper */
.goal-number-wrap {
    position: relative;
    display: flex;
    align-items: stretch;
}

.goal-number-wrap input {
    flex: 1;
    border-top-right-radius: 0 !important;
    border-bottom-right-radius: 0 !important;
    border-right: none !important;
}

.goal-number-wrap input::-webkit-inner-spin-button,
.goal-number-wrap input::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

.goal-number-btns {
    display: flex;
    flex-direction: column;
    width: 32px;
    flex-shrink: 0;
}

.goal-number-btns button {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0;
    transition: all var(--transition);
    font-size: 0;
    line-height: 0;
}

.goal-number-btns button:first-child {
    border-top-right-radius: var(--radius);
    border-bottom: none;
}

.goal-number-btns button:last-child {
    border-bottom-right-radius: var(--radius);
}

.goal-number-btns button svg,
.goal-number-btns button svg path {
    width: 12px;
    height: 12px;
    stroke: var(--text-secondary) !important;
    stroke-width: 2.5 !important;
    fill: none !important;
    stroke-linecap: round;
    stroke-linejoin: round;
    transition: stroke var(--transition);
}

.goal-number-btns button:hover {
    background: var(--border);
}

.goal-number-btns button:hover svg,
.goal-number-btns button:hover svg path {
    stroke: var(--accent) !important;
}

.goal-number-btns button:active {
    background: var(--accent);
}

.goal-number-btns button:active svg,
.goal-number-btns button:active svg path {
    stroke: var(--bg-base) !important;
}

.goal-form-actions {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
    margin-top: 20px;
}

/* ── Dashboard section headers ── */
.dash-section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    margin-bottom: 12px;
}
.dash-section-title {
    font-size: var(--text-xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
}
.dash-section-link {
    font-size: var(--text-xs);
    color: var(--accent);
    text-decoration: none;
    font-weight: 500;
}
.dash-section-link:hover {
    text-decoration: underline;
}

/* ── Dashboard Goals – horizontal scroll ── */
.goals-dash-scroll {
    display: flex;
    gap: 12px;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    padding-bottom: 4px;
    scrollbar-width: none;
}
.goals-dash-scroll::-webkit-scrollbar {
    display: none;
}

@media (max-width: 600px) {
    /* Apple Music-style edge-to-edge horizontal scroll on mobile.
       Negative margins bleed to screen edge; padding keeps first/last
       item inset at the normal content gutter. */
    .goals-dash-scroll,
    .wxp-week-scroll {
        margin-left: calc(-1 * var(--pad-page));
        margin-right: calc(-1 * var(--pad-page));
        padding-left: var(--pad-page);
        padding-right: var(--pad-page);
        scroll-padding-inline: var(--pad-page);
    }
}

.goal-dash-card {
    min-width: 260px;
    max-width: 320px;
    flex: 0 0 auto;
    scroll-snap-align: start;
    padding: 16px;
    cursor: pointer;
    position: relative;
    overflow: hidden;
}
.goal-dash-card::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.055) 0%,
        transparent 65%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
}
.goal-dash-card::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 1px;
    background: radial-gradient(
        circle at var(--mouse-x) var(--mouse-y),
        rgba(255, 255, 255, 0.35) 0%,
        transparent 60%
    );
    opacity: 0;
    transition: opacity 0.35s ease;
    pointer-events: none;
    z-index: 0;
    -webkit-mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
}
.goal-dash-card:hover {
    border-color: transparent;
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.35);
}
.goal-dash-card:hover::before,
.goal-dash-card:hover::after {
    opacity: 1;
}

.goal-dash-top {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 14px;
}
.goal-dash-info {
    flex: 1;
    min-width: 0;
}
.goal-dash-title {
    font-size: var(--text-sm);
    font-weight: 700;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.goal-dash-period {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 2px;
}

.goal-dash-progress {
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.goal-dash-stats {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
}
.goal-dash-value {
    font-size: var(--text-xs);
    color: var(--text-secondary);
    font-family: var(--font-num);
}
.goal-dash-pct {
    font-size: 11px;
    color: var(--text-muted);
}

/* Responsive */
@media (max-width: 640px) {
    .goals-grid {
        grid-template-columns: 1fr;
    }

    .goals-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
    }

    .goal-progress-value {
        font-size: 16px;
    }

    .goals-dash-label {
        min-width: 70px;
        font-size: 11px;
    }

    .goals-dash-val {
        min-width: 70px;
        font-size: 11px;
    }
}

/* ============================================================
   HEAT MAP PAGE — Full-bleed immersive layout
============================================================ */

/* ── Shell: fixed position filling viewport below topbar ── */
.hm-wrapper {
    position: fixed;
    left: 0;
    right: 0;
    top: 48px;
    height: calc(100vh - 48px);
    z-index: 100;
    overflow: hidden;
}

/* ── Map container: fills entire shell ── */
.hm-map-container {
    position: absolute;
    inset: 0;
}
.hm-map {
    width: 100%;
    height: 100%;
    background: #1a1c22;
}

/* ── Shared floating overlay panel ── */
.hm-overlay {
    position: absolute;
    z-index: 450;
    pointer-events: auto;
}

/* ── Unified bottom panel ── */
.hm-overlay--bottom {
    bottom: 16px;
    left: 16px;
    right: 16px;
}

/* ── Grabber handle (hidden on desktop) ── */
.hm-grabber {
    display: none;
}
.hm-grabber-pill {
    width: 36px;
    height: 4px;
    border-radius: 2px;
    background: rgba(255, 255, 255, 0.3);
}

.hm-bottom-panel {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 10px 16px;
    padding: 14px 16px;
    background: rgba(11, 14, 22, 0.82);
    -webkit-backdrop-filter: blur(14px);
    backdrop-filter: blur(14px);
    border: 1px solid rgba(255, 255, 255, 0.07);
    border-radius: var(--radius);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4), 0 1px 0 rgba(255, 255, 255, 0.04) inset;
}

/* Desktop: unwrap section divs so children flow in the wrapping row */
.hm-panel-stats,
.hm-panel-filters {
    display: contents;
}
.hm-panel-animate {
    width: 100%;
}
.hm-stats {
    display: flex;
    gap: 6px;
    flex-shrink: 0;
}
.hm-stat {
    padding: 6px 12px;
    display: flex;
    flex-direction: column;
    gap: 1px;
    border-radius: var(--radius);
    background: rgba(255, 255, 255, 0.04);
}
.hm-stat-val {
    font-size: 22px;
    font-weight: 700;
    color: var(--accent);
    letter-spacing: -0.5px;
}
.hm-stat-label {
    font-size: 9px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Controls sit to the right of stats */
.hm-controls {
    display: flex;
    gap: 14px;
    flex-wrap: wrap;
    flex: 1;
    justify-content: flex-end;
    align-items: center;
}
.hm-control-group {
    display: flex;
    align-items: center;
    gap: 6px;
}
.hm-label {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    color: var(--text-muted);
    font-weight: 600;
    white-space: nowrap;
}
.hm-pills {
    display: flex;
    gap: 3px;
    flex-wrap: wrap;
}
.hm-pill {
    padding: 4px 10px;
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    background: transparent;
    color: var(--text-secondary);
    font-size: 11px;
    cursor: pointer;
    transition: all 0.15s ease;
    font-family: inherit;
    white-space: nowrap;
}
.hm-pill:hover {
    border-color: var(--accent);
    color: var(--text-primary);
}
.hm-pill.active {
    background: var(--accent);
    color: var(--bg-base);
    border-color: var(--accent);
    font-weight: 600;
}

/* ── Legend pill: top-center floating ── */
.hm-overlay--legend {
    top: 16px;
    left: 50%;
    transform: translateX(-50%);
}
/* Row 2: Animate bar */
.hm-panel-animate {
    display: flex;
    align-items: center;
}
.hm-legend {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 11px;
    color: var(--text-secondary);
    padding: 6px 14px;
    border-radius: 20px;
    background: rgba(11, 14, 22, 0.82);
    -webkit-backdrop-filter: blur(14px);
    backdrop-filter: blur(14px);
    border: 1px solid rgba(255, 255, 255, 0.07);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4), 0 1px 0 rgba(255, 255, 255, 0.04) inset;
    white-space: nowrap;
}
.hm-legend:empty {
    display: none;
}
.hm-legend-dot {
    display: inline-block;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    margin-right: 4px;
    vertical-align: middle;
}
.hm-legend-gradient {
    width: 100px;
    height: 8px;
    border-radius: 4px;
    background: linear-gradient(
        to right,
        #1a1a5e,
        #0074d9,
        #00e5a0,
        #ffdc00,
        #ff4136,
        #ff0066
    );
}
.hm-legend-gradient--speed {
    background: linear-gradient(
        to right,
        #0074d9,
        #00e5a0,
        #ffdc00,
        #ff851b,
        #ff4136
    );
}
.hm-animate-bar {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
}
.hm-animate-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 5px 14px;
    border-radius: 20px;
    border: 1px solid var(--accent);
    background: var(--accent-dim);
    color: var(--accent);
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.15s ease;
    font-family: inherit;
    white-space: nowrap;
}
.hm-animate-btn:hover {
    background: var(--accent);
    color: var(--bg-base);
}
.hm-speed-pills {
    display: flex;
    gap: 2px;
}
.hm-speed-pill {
    padding: 3px 8px;
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    background: transparent;
    color: var(--text-muted);
    font-size: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.15s ease;
    font-family: inherit;
}
.hm-speed-pill:hover {
    border-color: var(--accent);
    color: var(--text-primary);
}
.hm-speed-pill.active {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-primary);
    border-color: rgba(255, 255, 255, 0.2);
}
.hm-animate-btn svg {
    width: 14px;
    height: 14px;
}
.hm-animate-progress {
    flex: 1;
    height: 4px;
    background: rgba(255, 255, 255, 0.06);
    border-radius: 2px;
    overflow: hidden;
}
.hm-animate-bar-fill {
    height: 100%;
    width: 0%;
    background: var(--accent);
    border-radius: 2px;
    transition: width 0.1s linear;
}
.hm-animate-count {
    font-size: 11px;
    color: var(--text-muted);
    white-space: nowrap;
}

/* ── Loading overlay ── */
.hm-loading {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
    background: rgba(13, 15, 20, 0.85);
    z-index: 500;
    -webkit-backdrop-filter: blur(4px);
    backdrop-filter: blur(4px);
}
.hm-loading-spinner {
    width: 36px;
    height: 36px;
    border: 3px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: hmSpin 0.8s linear infinite;
}
@keyframes hmSpin {
    to { transform: rotate(360deg); }
}
.hm-loading-text {
    font-size: 14px;
    color: var(--text-primary);
    font-weight: 600;
}
.hm-loading-sub {
    font-size: 12px;
    color: var(--text-muted);
}

/* Lock page scroll when interacting with heatmap */
body.hm-map-active,
body.hm-map-dragging {
    overflow: hidden !important;
}
body.hm-map-active html,
body.hm-map-dragging html,
.hm-map-active,
.hm-map-dragging {
    overflow: hidden !important;
    overscroll-behavior: none !important;
}
.hm-map-dragging * {
    user-select: none !important;
    -webkit-user-select: none !important;
}

/* ── Mobile responsive — bottom sheet ── */
@media (max-width: 700px) {
    .hm-wrapper {
        left: 0;
    }

    /* Edge-to-edge bottom sheet */
    .hm-overlay--bottom {
        left: 0;
        right: 0;
        bottom: 0;
        transition: transform 0.35s cubic-bezier(0.34, 1.4, 0.64, 1);
        will-change: transform;
    }
    .hm-overlay--bottom.hm-sheet-collapsed {
        transform: translateY(var(--hm-collapse-h, 0px));
    }
    .hm-overlay--bottom.hm-sheet-hidden {
        transform: translateY(var(--hm-hide-h, 0px));
    }
    .hm-bottom-panel {
        padding: 0 14px 14px;
        margin-bottom: -60px;
        padding-bottom: 74px; /* 14px real + 60px overshoot buffer */
        gap: 16px;
        border-radius: 16px 16px 0 0;
    }

    /* Grabber visible on mobile */
    .hm-grabber {
        display: flex;
        justify-content: center;
        padding: 10px 0 2px;
        cursor: grab;
        touch-action: none;
    }

    /* Restore section wrappers on mobile (overrides desktop display:contents) */
    .hm-panel-stats,
    .hm-panel-filters,
    .hm-panel-animate {
        display: block;
    }
    /* Divider lines between sections */
    .hm-panel-filters,
    .hm-panel-animate {
        padding-top: 14px;
        border-top: 1px solid rgba(255, 255, 255, 0.06);
    }
    /* Stack panel vertically on mobile */
    .hm-bottom-panel {
        flex-direction: column;
        align-items: stretch;
    }
    .hm-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 4px;
        width: 100%;
    }
    .hm-stat-val {
        font-size: 18px;
    }
    .hm-controls {
        justify-content: flex-start;
        gap: 8px;
    }
    .hm-animate-count {
        display: none;
    }

    /* Replay button: icon only on mobile */
    .hm-animate-btn #hmAnimateLabel {
        display: none;
    }
    .hm-animate-btn {
        padding: 6px 10px;
    }
}

/* ============================================================
   IMPORT PAGE
============================================================ */

/* ── Source tabs ── */
.imp-source-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: var(--gap-layout);
}
.imp-tab {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    border-radius: 8px;
    font-size: var(--text-sm);
    font-weight: 600;
    background: var(--bg-elevated);
    color: var(--text-secondary);
    border: 1px solid var(--border);
    cursor: pointer;
    transition: all var(--transition);
    position: relative;
}
.imp-tab:hover:not(:disabled) {
    color: var(--text-primary);
    border-color: var(--border-active);
}
.imp-tab--active {
    background: var(--accent-dim);
    color: var(--accent);
    border-color: var(--accent);
}
.imp-tab:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}
.imp-tab-badge {
    font-size: 9px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    background: var(--orange-dim);
    color: var(--orange);
    padding: 2px 6px;
    border-radius: 4px;
}

/* ── Drop zone ── */
.imp-dropzone {
    border: 2px dashed var(--border);
    border-radius: var(--radius-lg);
    padding: 48px 24px;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    cursor: pointer;
    transition: all 0.25s ease;
    background: var(--bg-card);
    position: relative;
}
.imp-dropzone:hover {
    border-color: var(--accent);
    background: var(--accent-faint);
}
.imp-dropzone.imp-dropzone--dragover {
    border-color: var(--accent);
    background: var(--accent-dim);
    transform: scale(1.01);
}
.imp-dropzone-icon {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background: var(--accent-dim);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 16px;
}
.imp-dropzone-icon svg {
    width: 28px;
    height: 28px;
    color: var(--accent);
}
.imp-dropzone-title {
    font-size: var(--text-md);
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 4px;
}
.imp-dropzone-sub {
    font-size: var(--text-xs);
    color: var(--text-muted);
}
.imp-dropzone-formats {
    display: flex;
    gap: 8px;
    margin-top: 20px;
    flex-wrap: wrap;
    justify-content: center;
}
.imp-dropzone-formats span {
    font-size: var(--text-2xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 3px 10px;
    border-radius: 4px;
    background: var(--bg-elevated);
    color: var(--text-muted);
    border: 1px solid var(--border);
}

/* ── Queue ── */
.imp-queue-card {
    margin-top: var(--gap-layout);
}
.imp-queue-list {
    display: flex;
    flex-direction: column;
    gap: 6px;
    max-height: 320px;
    overflow-y: auto;
}
.imp-queue-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: var(--radius);
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    transition: all var(--transition);
}
.imp-queue-item:hover {
    border-color: var(--border-active);
}
.imp-qi-icon {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}
.imp-qi-icon--ride {
    background: var(--accent-dim);
    color: var(--accent);
}
.imp-qi-icon--run {
    background: var(--blue-dim);
    color: var(--blue);
}
.imp-qi-icon--swim {
    background: var(--purple-dim);
    color: var(--purple);
}
.imp-qi-icon--other {
    background: var(--orange-dim);
    color: var(--orange);
}

.imp-qi-info {
    flex: 1;
    min-width: 0;
}
.imp-qi-name {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.imp-qi-meta {
    font-size: var(--text-xs);
    color: var(--text-muted);
    display: flex;
    gap: 12px;
    margin-top: 2px;
}
.imp-qi-status {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: var(--text-xs);
    font-weight: 600;
    flex-shrink: 0;
}
.imp-qi-status--pending {
    color: var(--text-muted);
}
.imp-qi-status--processing {
    color: var(--blue);
}
.imp-qi-status--done {
    color: var(--accent);
}
.imp-qi-status--error {
    color: var(--red);
}
.imp-qi-status--skipped {
    color: var(--yellow);
}

.imp-qi-progress {
    width: 60px;
    height: 4px;
    border-radius: 2px;
    background: var(--bg-base);
    overflow: hidden;
}
.imp-qi-progress-bar {
    height: 100%;
    border-radius: 2px;
    background: var(--accent);
    transition: width 0.3s ease;
}
.imp-qi-remove {
    width: 28px;
    height: 28px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-muted);
    cursor: pointer;
    transition: all var(--transition);
    flex-shrink: 0;
}
.imp-qi-remove:hover {
    color: var(--red);
    background: var(--red-dim);
}

/* ── Import options ── */
.imp-options-grid {
    display: flex;
    flex-direction: column;
    gap: 2px;
}
.imp-toggle-row {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    border-radius: var(--radius);
    cursor: pointer;
    transition: background var(--transition);
    flex-wrap: wrap;
}
.imp-toggle-row:hover {
    background: var(--bg-elevated);
}
.imp-toggle-label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-primary);
    flex: 1;
    min-width: 160px;
}
.imp-toggle-label svg {
    color: var(--text-muted);
    flex-shrink: 0;
}
.imp-toggle-hint {
    font-size: var(--text-xs);
    color: var(--text-muted);
    flex: 1;
    min-width: 140px;
}
/* hidden checkbox */
.imp-toggle-row input[type="checkbox"] {
    display: none;
}
/* toggle switch track */
.imp-toggle-switch {
    width: 40px;
    height: 22px;
    border-radius: 11px;
    background: var(--bg-base);
    border: 1px solid var(--border);
    position: relative;
    transition: all 0.2s ease;
    flex-shrink: 0;
}
.imp-toggle-switch::after {
    content: "";
    position: absolute;
    top: 2px;
    left: 2px;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: var(--text-muted);
    transition: all 0.2s ease;
}
.imp-toggle-row input[type="checkbox"]:checked + .imp-toggle-switch {
    background: var(--accent);
    border-color: var(--accent);
}
.imp-toggle-row input[type="checkbox"]:checked + .imp-toggle-switch::after {
    left: 20px;
    background: #fff;
}

/* ── History ── */
.imp-history-list {
    display: flex;
    flex-direction: column;
    gap: 4px;
    max-height: 280px;
    overflow-y: auto;
}
.imp-history-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 32px 16px;
    color: var(--text-muted);
    text-align: center;
}
.imp-history-empty p {
    font-size: var(--text-xs);
}
.imp-history-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 10px;
    border-radius: var(--radius-sm);
    transition: background var(--transition);
}
.imp-history-item:hover {
    background: var(--bg-elevated);
}
.imp-hi-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
}
.imp-hi-dot--success {
    background: var(--accent);
}
.imp-hi-dot--error {
    background: var(--red);
}
.imp-hi-dot--skipped {
    background: var(--yellow);
}
.imp-hi-info {
    flex: 1;
    min-width: 0;
}
.imp-hi-name {
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.imp-hi-meta {
    font-size: var(--text-2xs);
    color: var(--text-muted);
}
.imp-hi-date {
    font-size: var(--text-2xs);
    color: var(--text-muted);
    flex-shrink: 0;
}

/* ── Strava coming soon ── */
.imp-strava-soon {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: 64px 24px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
}
.imp-strava-soon-title {
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--text-primary);
    margin-top: 16px;
}
.imp-strava-soon-sub {
    font-size: var(--text-sm);
    color: var(--text-muted);
    margin-top: 6px;
    max-width: 320px;
}

/* ── Mobile responsive ── */
@media (max-width: 600px) {
    .imp-dropzone {
        padding: 32px 16px;
    }
    .imp-toggle-row {
        padding: 10px 8px;
    }
    .imp-toggle-hint {
        width: 100%;
        flex-basis: 100%;
        padding-left: 24px;
        margin-top: 2px;
    }
    .imp-qi-meta {
        gap: 8px;
    }
}

/* ============================================================
   RATE LIMIT BAR  (Settings → Smart Sync)
============================================================ */
.rl-bar-wrap {
    padding: 4px 0 0;
}
.rl-bar-header {
    display: flex;
    align-items: baseline;
    gap: 4px;
    margin-bottom: 8px;
}
.rl-bar-used {
    font-size: var(--text-lg);
    font-weight: 800;
    font-family: var(--font-num);
    color: var(--text-primary);
}
.rl-bar-label {
    font-size: var(--text-xs);
    color: var(--text-muted);
    font-weight: 500;
}
.rl-bar-window {
    font-size: var(--text-2xs);
    color: var(--text-muted);
    margin-left: auto;
    text-transform: uppercase;
    letter-spacing: 0.4px;
    font-weight: 600;
}
.rl-bar-track {
    width: 100%;
    height: 10px;
    border-radius: 5px;
    background: var(--bg-base);
    overflow: hidden;
    position: relative;
}
.rl-bar-fill {
    height: 100%;
    border-radius: 5px;
    background: var(--accent);
    transition:
        width 0.4s ease,
        background 0.4s ease;
    min-width: 0;
}
.rl-bar-fill--warn {
    background: var(--yellow);
}
.rl-bar-fill--danger {
    background: var(--red);
}
.rl-bar-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 6px;
}
.rl-bar-hint {
    font-size: var(--text-2xs);
    color: var(--text-muted);
}
.rl-bar-reset {
    font-size: var(--text-2xs);
    color: var(--text-muted);
}

/* ── Hide all scrollbars on mobile ── */
@media (max-width: 700px) {
    *,
    *::before,
    *::after {
        scrollbar-width: none !important;           /* Firefox */
        -ms-overflow-style: none !important;         /* IE / Edge legacy */
    }
    *::-webkit-scrollbar {
        display: none !important;                    /* Chrome, Safari, Opera */
    }
}

/* ── Reduced motion preference ───────────────────────────── */
@media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }
}

/* ── Focus visible for keyboard accessibility ────────────── */
:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
}

button:focus-visible,
a:focus-visible,
input:focus-visible,
select:focus-visible,
textarea:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
}

.nav-item:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: -2px;
    border-radius: var(--radius-sm);
}

.card:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
    border-radius: var(--radius);
}
