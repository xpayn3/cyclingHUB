/* ============================================================
   DESIGN TOKENS
============================================================ */
:root {
    --bg-base: #0d0f14;
    --bg-surface: #13161e;
    --bg-elevated: #1a1e2a;
    --bg-card: #1e2330;
    --border: #252b3a;
    --border-active: #3a4260;
    --accent: #00e5a0;
    --accent-dim: rgba(0, 229, 160, 0.12);
    --accent-glow: rgba(0, 229, 160, 0.25);
    --orange: #ff6b35;
    --orange-dim: rgba(255, 107, 53, 0.12);
    --blue: #4a9eff;
    --blue-dim: rgba(74, 158, 255, 0.12);
    --purple: #9b59ff;
    --purple-dim: rgba(155, 89, 255, 0.12);
    --red: #ff4757;
    --yellow: #f0c429;
    --yellow-dim: rgba(240, 196, 41, 0.12);
    --text-primary: #eef0f8;
    --text-secondary: #8891a8;
    --text-muted: #525d72;
    --sidebar-w: 220px;
    --radius: 10px;
    --radius-lg: 16px;
    --transition: 0.18s ease;

    /* ── Spacing ─────────────────────────────────────────────
     Change these to adjust all padding/gaps across the app.
     --pad-page   : left/right gutters of the main content area
     --gap-layout : space between cards and between sections
     --pad-card   : inner padding inside every card
  ──────────────────────────────────────────────────────── */
    --pad-page: 14px;
    --gap-layout: 14px;
    --pad-card: 12px 12px;

    /* ── Typography ──────────────────────────────────────────
     --font-ui  : all UI text — body, labels, buttons, nav
     --font-num : numbers, stats, data values, timecodes
     Change these two to swap fonts globally.
  ──────────────────────────────────────────────────────── */
    --font-ui:  'Inter', system-ui, -apple-system, sans-serif;
    --font-num: 'Inter', system-ui, -apple-system, sans-serif;

    /* ── Font size scale ─────────────────────────────────────
     Base html font-size: 15px
     --text-2xs : micro labels, badges, superscripts  (~9px)
     --text-xs  : label caps, secondary meta          (~11px)
     --text-sm  : secondary body, sub-labels          (~12px)
     --text-base: primary body                        (~13px)
     --text-md  : card sub-values, row labels         (~15px)
     --text-lg  : primary card values, chart axis     (~18px)
     --text-xl  : hero stat values                    (~27px)
     --text-2xl : largest display numbers             (~36px)
  ──────────────────────────────────────────────────────── */
    --text-2xs:  0.62rem;   /*  ~9px  — micro badges, superscripts    */
    --text-xs:   0.72rem;   /* ~11px  — uppercase labels, meta info   */
    --text-sm:   0.8rem;    /* ~12px  — secondary body, sub-labels    */
    --text-base: 0.875rem;  /* ~13px  — primary body text             */
    --text-md:   1rem;      /*  15px  — card sub-headings, row values */
    --text-lg:   1.1rem;    /* ~17px  — section titles                */
    --text-xl:   1.9rem;    /* ~28px  — primary stat values           */
    --text-2xl:  2.2rem;    /* ~33px  — hero gauge numbers            */
}

/* ============================================================
   RESET & BASE
============================================================ */
*,
*::before,
*::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}
html {
    font-size: 15px;
    overflow-x: hidden; /* prevent horizontal scroll on html */
    max-width: 100%;
    background: var(--bg-base); /* match body — prevents black strip showing behind fixed body on iOS Safari */
}
body {
    font-family: var(--font-ui);
    background: var(--bg-base);
    color: var(--text-primary);
    overflow-x: hidden;
    max-width: 100%;
    touch-action: pan-y; /* lock touch scroll to vertical only */
    overscroll-behavior-x: none; /* prevent horizontal swipe bounce */
}
a {
    color: inherit;
    text-decoration: none;
}
button {
    cursor: pointer;
    border: none;
    background: none;
    font-family: inherit;
    color: inherit;
}
svg {
    display: block;
}
input,
select {
    font-family: inherit;
}
code {
    font-family: var(--font-num);
    font-size: 0.82em;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 1px 6px;
    color: var(--accent);
}

/* ============================================================
   SIDEBAR
============================================================ */
.sidebar {
    width: var(--sidebar-w);
    min-height: 100vh;
    min-height: 100dvh;
    background: var(--bg-surface);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    z-index: 1100; /* above Leaflet's max of 1000 */
    padding-top: env(safe-area-inset-top);
    transition: transform 0.28s cubic-bezier(0.4, 0, 0.2, 1);
}
.sidebar-logo {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 22px 20px;
    border-bottom: 1px solid var(--border);
}
.logo-icon {
    width: 34px;
    height: 34px;
    background: var(--accent);
    border-radius: 9px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}
.logo-icon svg {
    width: 18px;
    height: 18px;
}
.logo-text {
    font-size: var(--text-lg);
    font-weight: 800;
    letter-spacing: -0.3px;
}
.logo-text span {
    color: var(--accent);
}
.sidebar-nav {
    flex: 1;
    padding: 14px 10px;
    display: flex;
    flex-direction: column;
    gap: 2px;
    overflow-y: auto;
}
.nav-section-label {
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    padding: 10px 10px 4px;
}
.sidebar-nav > .nav-section-label:not(:first-child) {
    margin-top: 8px;
}
.nav-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 9px 12px;
    border-radius: 8px;
    color: var(--text-secondary);
    font-size: var(--text-base);
    font-weight: 500;
    transition:
        background var(--transition),
        color var(--transition);
    cursor: pointer;
    user-select: none;
}
.nav-item svg {
    width: 17px;
    height: 17px;
    flex-shrink: 0;
}
.nav-item:hover {
    background: var(--bg-elevated);
    color: var(--text-primary);
}
.nav-item.active {
    background: var(--accent-dim);
    color: var(--accent);
}
.nav-item .badge {
    margin-left: auto;
    background: var(--accent);
    color: var(--bg-base);
    font-size: var(--text-2xs);
    font-weight: 700;
    padding: 2px 7px;
    border-radius: 20px;
}
.sidebar-footer {
    padding: 14px 10px;
    padding-bottom: calc(14px + env(safe-area-inset-bottom));
    border-top: 1px solid var(--border);
    background: var(--bg-surface);
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.athlete-chip {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 8px;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    cursor: pointer;
    transition: border-color var(--transition);
}
.athlete-chip:hover {
    border-color: var(--border-active);
}
.sidebar-actions {
    display: flex;
    gap: 8px;
}
.sidebar-action-btn {
    flex: 1;
    justify-content: center;
    gap: 7px;
    font-size: var(--text-sm);
    padding: 8px 10px;
}
.athlete-avatar {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), var(--blue));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--text-sm);
    font-weight: 700;
    color: var(--bg-base);
    flex-shrink: 0;
}
.athlete-info {
    flex: 1;
    min-width: 0;
}
.athlete-name {
    font-size: var(--text-sm);
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.athlete-sub {
    font-size: var(--text-xs);
    color: var(--text-muted);
}
.connection-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
}
.connection-dot.connected {
    background: var(--accent);
    box-shadow: 0 0 6px var(--accent);
}
.connection-dot.disconnected {
    background: var(--text-muted);
}

/* ============================================================
   MAIN LAYOUT
============================================================ */
.main {
    margin-left: var(--sidebar-w);
    min-height: 100svh;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    min-width: 0;
}
.topbar {
    height: calc(48px + env(safe-area-inset-top));
    background: var(--bg-surface);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    padding: env(safe-area-inset-top) 16px 0;
    gap: 10px;
    position: fixed;
    top: 0;
    left: var(--sidebar-w);
    right: 0;
    z-index: 1100; /* above Leaflet's max of 1000 */
    flex-shrink: 0;
}
.topbar-actions {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-left: auto;
}
.topbar--hidden {
    display: none;
}
.topbar-month-label {
    font-size: 1.05rem;
    font-weight: 700;
    letter-spacing: -0.3px;
    color: var(--text-primary);
    white-space: nowrap;
}

/* ── Page headline ── */
.page-headline {
    padding: 4px 0 8px;
}
.page-headline--hidden {
    display: none;
}
.page-headline-title {
    font-size: 1.6rem;
    font-weight: 800;
    letter-spacing: -0.5px;
    line-height: 1.1;
}
.page-headline-sub {
    font-size: var(--text-sm);
    color: var(--text-muted);
    margin-top: 4px;
}
.page-content {
    flex: 1;
    padding: calc(48px + env(safe-area-inset-top) + 14px) var(--pad-page)
        max(20px, env(safe-area-inset-bottom));
    display: flex;
    flex-direction: column;
    gap: var(--gap-layout);
}
/* When topbar is hidden (calendar full-viewport layout), remove reserved topbar space */
.topbar--hidden ~ .page-content {
    padding-top: var(--pad-page);
}

/* ============================================================
   BUTTONS
============================================================ */
.btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 7px 14px;
    border-radius: 8px;
    font-size: var(--text-sm);
    font-weight: 600;
    transition: all var(--transition);
}
.btn svg {
    width: 14px;
    height: 14px;
}
.btn-primary {
    background: var(--accent);
    color: var(--bg-base);
}
.btn-primary:hover {
    background: #00ffa8;
    box-shadow: 0 0 16px var(--accent-glow);
}
.btn-primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}
.btn-ghost {
    background: var(--bg-elevated);
    color: var(--text-secondary);
    border: 1px solid var(--border);
}
.btn-ghost:hover {
    color: var(--text-primary);
    border-color: var(--border-active);
}
.btn-icon {
    width: 34px;
    height: 34px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    padding: 0;
}
.btn-icon svg {
    width: 18px;
    height: 18px;
}
.btn-danger {
    background: rgba(255, 71, 87, 0.12);
    color: var(--red);
    border: 1px solid rgba(255, 71, 87, 0.25);
}
.btn-danger:hover {
    background: rgba(255, 71, 87, 0.2);
}
.btn-spinning svg {
    animation: spin 0.7s linear infinite;
}
.date-range-pill {
    display: flex;
    align-items: center;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
}
.date-range-pill button {
    padding: 6px 12px;
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--text-secondary);
    transition: all var(--transition);
    border-right: 1px solid var(--border);
}
.date-range-pill button:last-child {
    border-right: none;
}
.date-range-pill button:hover,
.date-range-pill button.active {
    background: var(--accent-dim);
    color: var(--accent);
}

/* ============================================================
   CONNECT MODAL
============================================================ */
.modal-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.75);
    z-index: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease;
}
.modal-backdrop.open {
    opacity: 1;
    pointer-events: all;
}
.modal {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 18px;
    width: 100%;
    max-width: 480px;
    overflow: hidden;
    transform: translateY(12px);
    transition: transform 0.2s ease;
}
.modal-backdrop.open .modal {
    transform: translateY(0);
}
.modal-header {
    padding: 24px 28px 0;
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
}
.modal-header-icon {
    width: 46px;
    height: 46px;
    background: var(--accent-dim);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 16px;
}
.modal-header-icon svg {
    width: 22px;
    height: 22px;
    color: var(--accent);
}
.modal-close {
    width: 30px;
    height: 30px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-muted);
    background: var(--bg-elevated);
    transition: all var(--transition);
}
.modal-close:hover {
    color: var(--text-primary);
    background: var(--border);
}
.modal-close svg {
    width: 14px;
    height: 14px;
}
.modal-body {
    padding: 0 28px 28px;
}
.modal-title {
    font-size: var(--text-lg);
    font-weight: 800;
    margin-bottom: 6px;
}
.modal-desc {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    line-height: 1.5;
    margin-bottom: 22px;
}
.modal-footer {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
    padding-top: 4px;
}

/* Form fields */
.field {
    margin-bottom: 16px;
}
.field label {
    display: block;
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}
.field input {
    width: 100%;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 9px;
    padding: 10px 14px;
    color: var(--text-primary);
    font-size: var(--text-base);
    outline: none;
    transition:
        border-color var(--transition),
        box-shadow var(--transition);
}
.field input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-dim);
}
.field input::placeholder {
    color: var(--text-muted);
}
.field input.error {
    border-color: var(--red);
}
.field-hint {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 5px;
    line-height: 1.4;
}
.field-hint a {
    color: var(--accent);
}
.field-error {
    font-size: var(--text-xs);
    color: var(--red);
    margin-top: 5px;
    display: none;
}
.field-error.show {
    display: block;
}
.input-with-toggle {
    position: relative;
}
.input-with-toggle input {
    padding-right: 42px;
}
.toggle-visibility {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px;
    transition: color var(--transition);
}
.toggle-visibility:hover {
    color: var(--text-primary);
}
.toggle-visibility svg {
    width: 16px;
    height: 16px;
}

/* Callout */
.callout {
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-left: 3px solid var(--accent);
    border-radius: 8px;
    padding: 12px 14px;
    margin-bottom: 20px;
    font-size: var(--text-sm);
    line-height: 1.5;
    color: var(--text-secondary);
}
.callout strong {
    color: var(--text-primary);
}
.callout ol {
    margin-left: 16px;
    margin-top: 6px;
}
.callout li {
    margin-bottom: 3px;
}

/* ============================================================
   STAT CARDS
============================================================ */
.section-label {
    font-size: var(--text-xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    margin-bottom: 4px;
}
.stat-grid-label {
    font-size: var(--text-xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    margin-bottom: 4px;
    display: flex;
    align-items: center;
    gap: 8px;
}
.stat-grid-label span {
    font-weight: 500;
    text-transform: none;
    letter-spacing: 0;
    color: var(--text-secondary);
    font-size: var(--text-xs);
}

/* Visual divider between dashboard sections */
.dash-section-divider {
    border: none;
    border-top: 1px solid var(--border);
    margin: 4px 0;
}
.stat-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(155px, 1fr));
    gap: var(--gap-layout);
}
.stat-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: var(--pad-card);
    display: flex;
    flex-direction: column;
    gap: 8px;
    transition:
        border-color var(--transition),
        box-shadow var(--transition);
}
.stat-card:hover {
    border-color: var(--border-active);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}
.stat-card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
}
.stat-label {
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.07em;
    color: var(--text-muted);
}
.stat-icon {
    width: 28px;
    height: 28px;
    border-radius: 7px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.stat-icon svg {
    width: 14px;
    height: 14px;
}
.stat-icon.green {
    background: var(--accent-dim);
    color: var(--accent);
}
.stat-icon.orange {
    background: var(--orange-dim);
    color: var(--orange);
}
.stat-icon.blue {
    background: var(--blue-dim);
    color: var(--blue);
}
.stat-icon.purple {
    background: var(--purple-dim);
    color: var(--purple);
}
.stat-value {
    font-size: var(--text-xl);
    font-weight: 800;
    letter-spacing: -1px;
    font-family: var(--font-num);
    line-height: 1;
}
.stat-value .unit {
    font-size: var(--text-base);
    font-weight: 500;
    color: var(--text-secondary);
    font-family: var(--font-ui);
    letter-spacing: 0;
}
.stat-delta {
    font-family: var(--font-ui);
    font-size: var(--text-sm);
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 4px;
}
.stat-delta.up {
    color: var(--accent);
}
.stat-delta.down {
    color: var(--red);
}
.stat-delta.neutral {
    color: var(--text-muted);
}

/* ============================================================
   CARD
============================================================ */
.card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: var(--pad-card);
    min-width: 0;
}
.card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;
}
.card-title {
    font-size: var(--text-base);
    font-weight: 700;
}
.card-subtitle {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 2px;
}
.card--narrow {
    max-width: 580px;
}
.card--clickable {
    cursor: pointer;
    transition: border-color var(--transition), background var(--transition);
}
.card--clickable:hover {
    border-color: var(--border-active);
    background: #212735;
}
.card--clickable:active {
    background: var(--bg-elevated);
}
/* Two cards sitting side by side in one row, equal height */
/* ── Recent Activity card ──────────────────────────────────────────────── */
/* Scroll rail — App Store-style horizontal carousel */
.recent-act-scroll-rail {
    display: flex;
    gap: 14px;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    padding-bottom: 4px; /* prevent box-shadow clipping */
}
.recent-act-scroll-rail::-webkit-scrollbar {
    display: none;
}

/* Each card: fixed width, never shrinks */
.recent-act-card {
    flex: 0 0 420px;
    overflow: hidden;
    padding: 0;                    /* no card padding — info side handles its own */
}

@media (max-width: 600px) {
    .recent-act-card {
        flex: 0 0 calc(100vw - 28px);
    }
}
.recent-act-body {
    display: flex;
    flex-wrap: nowrap;
    gap: 0;
    align-items: stretch;
    height: 230px;                 /* explicit height = consistent across all cards */
}
.recent-act-info {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 6px;
    justify-content: space-between;
    padding: 10px 10px 10px 12px;  /* padding lives here, not on the card */
}
.recent-act-header {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 4px;
    min-width: 0;
}
.recent-act-text {
    min-width: 0;
}
.recent-act-icon {
    width: 30px;
    height: 30px;
    border-radius: 8px;
    background: var(--accent-dim);
    color: var(--accent);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}
.recent-act-icon svg { width: 18px; height: 18px; }
.recent-act-name {
    font-size: var(--text-md);
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1.3;
}
.recent-act-date {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 2px;
}
.recent-act-stats {
    display: flex;
    flex-wrap: wrap;
    gap: 0;
    padding-top: 8px;
    border-top: 1px solid var(--border);
    margin-top: auto;
}
.ra-stat {
    display: flex;
    flex-direction: column;
    gap: 3px;
    padding-right: 16px;
    margin-right: 16px;
    margin-bottom: 6px;
    position: relative;
}
.ra-stat:not(:last-child)::after {
    content: '';
    position: absolute;
    right: 0;
    top: 0;
    bottom: 10px;
    width: 1px;
    background: var(--border);
}
.ra-stat-lbl {
    font-size: var(--text-2xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    line-height: 1;
}
.ra-stat-val {
    font-size: 1.2rem;
    font-weight: 700;
    font-family: var(--font-num);
    color: var(--text-primary);
    line-height: 1;
    letter-spacing: -0.02em;
}
.ra-stat-unit {
    font-size: var(--text-xs);
    font-weight: 500;
    color: var(--text-secondary);
    letter-spacing: 0;
}
.ra-tss {
    display: flex;
    flex-direction: column;
    gap: 3px;
    margin-top: 6px;
    margin-bottom: 8px;
}
.ra-tss-lbl {
    font-size: var(--text-2xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    line-height: 1;
}
.ra-tss-val {
    font-size: 1.15rem;
    font-weight: 700;
    font-family: var(--font-num);
    color: var(--accent);
    line-height: 1;
    letter-spacing: -0.02em;
}
.ra-tss-val span {
    font-size: var(--text-xs);
    font-weight: 500;
    color: var(--text-secondary);
    letter-spacing: 0;
}
.recent-act-map {
    width: 190px;
    flex-shrink: 0;
    border-radius: 0 var(--radius-lg) var(--radius-lg) 0;
    overflow: hidden;
    background: var(--bg-elevated);
    position: relative;
    align-self: stretch;
}
.ra-map-empty {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--text-xs);
    color: var(--text-muted);
}
@media (max-width: 600px) {
    .recent-act-body {
        flex-direction: column;
        height: auto;
    }
    .recent-act-info {
        padding: 10px 12px 0;
    }
    .recent-act-map {
        display: block;
        width: 100%;
        height: 160px;
        border-radius: 0 0 var(--radius-lg) var(--radius-lg);
        order: -1;
    }
    .recent-act-stats {
        padding-bottom: 10px;
        width: 100%;
    }
    .ra-stat {
        flex: 1;
        min-width: 0;
        padding: 0;
        margin: 0;
        text-align: left;
        align-items: flex-start;
    }
    .ra-stat:not(:last-child)::after {
        display: none;
    }
}

.card-row {
    display: flex;
    gap: var(--gap-layout);
    align-items: stretch;
}
.card-row > .card {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
}
.card-row > .card .chart-wrap {
    flex: 1;
}
@media (max-width: 900px) {
    .card-row {
        flex-direction: column;
    }
}
/* Reusable right-side slot in card headers (legend + controls) */
.card-header-controls {
    display: flex;
    align-items: center;
    gap: 16px;
}

/* ============================================================
   FITNESS ROW (Training Load + Status)
============================================================ */
.fitness-row {
    display: grid;
    grid-template-columns: 1fr minmax(0, 340px);
    gap: var(--gap-layout);
    align-items: stretch;
}
.fitness-row .card {
    display: flex;
    flex-direction: column;
}
.fitness-row .card .chart-wrap {
    flex: 1;
    min-height: 160px;
}

/* Fitness gauges */
.fitness-gauges {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--gap-layout);
}
.gauge-card {
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: var(--pad-card);
    text-align: center;
}
.gauge-label {
    font-size: var(--text-xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.09em;
    color: var(--text-muted);
    margin-bottom: 8px;
}
.gauge-value {
    font-size: var(--text-2xl);
    font-weight: 800;
    font-family: var(--font-num);
    letter-spacing: -1.5px;
    line-height: 1;
}
.gauge-name {
    font-size: var(--text-xs);
    color: var(--text-secondary);
    margin-top: 4px;
}
.gauge-bar {
    height: 4px;
    background: var(--border);
    border-radius: 2px;
    margin-top: 10px;
    overflow: hidden;
}
.gauge-bar-fill {
    height: 100%;
    border-radius: 2px;
    transition: width 0.6s ease;
}

/* Gauge ID-specific colors */
#gaugeCTL {
    color: var(--accent);
}
#gaugeATL {
    color: var(--orange);
}
#gaugeTSB {
    color: var(--blue);
}
#barCTL {
    background: var(--accent);
}
#barATL {
    background: var(--orange);
}
#barTSB {
    background: var(--blue);
}

/* Weekly TSS section inside Fitness Status card */
.weekly-tss-section {
    margin-top: 16px;
}
.weekly-tss-label {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-muted);
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 0.06em;
}
.weekly-tss-section .chart-wrap {
    height: 90px;
}

/* Chart legend */
.chart-legend {
    display: flex;
    gap: 14px;
    font-size: var(--text-xs);
    color: var(--text-muted);
}
.chart-legend-item {
    display: flex;
    align-items: center;
    gap: 5px;
}
.chart-legend-dot {
    width: 10px;
    height: 3px;
    display: inline-block;
    border-radius: 2px;
}

/* ============================================================
   CHART
============================================================ */
.chart-wrap {
    position: relative;
    height: 200px;
}
.chart-wrap--fitness {
    height: 270px;
}

/* Range label shown in Training Load card header (replaces the pill) */
.fitness-range-label {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--text-muted);
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 3px 9px;
    letter-spacing: 0.03em;
    white-space: nowrap;
}

/* ============================================================
   ACTIVITY LIST
============================================================ */
/* ---- Activity list containers ---- */
.activity-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

/* ── Activities page sort bar ─────────────────────────────────────── */
.sort-bar {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 10px 0 14px;
    flex-wrap: wrap;
    border-bottom: 1px solid var(--border);
    margin-bottom: 4px;
}
.sort-label {
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    margin-right: 2px;
}
.sort-btn {
    background: none;
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 4px 11px;
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--text-secondary);
    cursor: pointer;
    transition:
        border-color var(--transition),
        color var(--transition),
        background var(--transition);
    white-space: nowrap;
}
.sort-btn:hover {
    border-color: var(--border-active);
    color: var(--text-primary);
}
.sort-btn.active {
    border-color: var(--accent);
    color: var(--accent);
    background: var(--accent-dim);
}
.sort-arrow {
    font-size: var(--text-xs);
}

/* ---- Activity row — single horizontal line ---- */
.activity-row {
    display: flex;
    flex-direction: row;
    align-items: center;
    padding: 10px 14px;
    gap: 12px;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    cursor: pointer;
    overflow: hidden;
    transition:
        border-color var(--transition),
        background var(--transition),
        transform var(--transition),
        box-shadow var(--transition);
}
.activity-row:hover {
    background: var(--bg-card);
    border-color: var(--border-active);
    transform: translateY(-1px);
    box-shadow: 0 6px 24px rgba(0, 0, 0, 0.3);
}
.activity-row:active {
    transform: translateY(0);
    box-shadow: none;
}

/* Icon */
.activity-type-icon {
    width: 34px;
    height: 34px;
    border-radius: 10px;
    background: var(--accent-dim);
    color: var(--accent);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}
.activity-type-icon svg {
    width: 17px;
    height: 17px;
}
.activity-type-icon.run {
    background: var(--orange-dim);
    color: var(--orange);
}
.activity-type-icon.swim {
    background: var(--blue-dim);
    color: var(--blue);
}
.activity-type-icon.virtual {
    background: var(--purple-dim);
    color: var(--purple);
}

/* Name + date — grows to fill available space; stats stay right-aligned */
.act-card-info {
    flex: 1 1 0;
    min-width: 0;
}
.act-card-name {
    font-size: var(--text-base);
    font-weight: 700;
    letter-spacing: -0.2px;
    white-space: normal;
    word-break: break-word;
    overflow-wrap: anywhere;
}
.act-card-sub {
    display: flex;
    align-items: center;
    gap: 5px;
    margin-top: 2px;
}
.act-card-date {
    font-size: var(--text-xs);
    color: var(--text-muted);
}
.act-card-badge {
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 1px 5px;
    font-size: var(--text-2xs);
    font-weight: 600;
    letter-spacing: 0.04em;
    color: var(--text-secondary);
}
/* Platform source tag (e.g. "Zwift") — accent-tinted pill */
.act-platform-tag {
    background: rgba(0, 229, 160, 0.10);
    border: 1px solid rgba(0, 229, 160, 0.28);
    border-radius: 4px;
    padding: 1px 6px;
    font-size: var(--text-2xs);
    font-weight: 700;
    letter-spacing: 0.05em;
    color: var(--accent);
    text-transform: uppercase;
}
.activity-tss {
    padding: 2px 8px;
    border-radius: 20px;
    font-size: var(--text-xs);
    font-weight: 700;
    background: var(--accent-dim);
    color: var(--accent);
    font-family: var(--font-num);
    white-space: nowrap;
    flex-shrink: 0;
    line-height: 1.5;
    margin-left: auto;
}

/* Stats — inline, pushed to the right of name */
.act-card-stats {
    display: flex;
    gap: 0;
    flex: 1;
    justify-content: flex-end;
}
.act-stat {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    min-width: 48px;
    padding: 0 10px;
}
.act-stat + .act-stat {
    border-left: 1px solid var(--border);
}
.act-stat:last-child {
    padding-right: 0;
}
.act-stat-val {
    font-size: var(--text-sm);
    font-weight: 800;
    font-family: var(--font-num);
    letter-spacing: -0.5px;
    line-height: 1.2;
    white-space: nowrap;
}
.act-stat-lbl {
    font-size: var(--text-2xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.07em;
    color: var(--text-muted);
    margin-top: 1px;
}

/* Activity list — mobile: stack stats below the name */
@media (max-width: 600px) {
    .activity-row {
        flex-wrap: wrap;
        align-items: flex-start;
    }
    .act-card-info {
        flex: 1;
    }
    .activity-tss {
        margin-left: auto;
    }
    .act-card-stats {
        flex-basis: 100%;
        justify-content: space-between;
        margin-top: 8px;
        padding: 8px 0 0;
        border-top: 1px solid var(--border);
    }
    .act-stat {
        flex: 1;
        align-items: center;
        padding: 0 4px;
    }
}

/* ============================================================
   FITNESS PAGE
============================================================ */

/* ── KPI row: 6 cards ── */
.fit-kpi-row {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 12px;
}
.fit-kpi-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 18px 20px 16px;
}
.fit-kpi-label {
    font-size: var(--text-2xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--text-muted);
    margin-bottom: 6px;
}
.fit-kpi-value {
    font-size: var(--text-2xl);
    font-weight: 800;
    font-family: var(--font-num);
    letter-spacing: -2px;
    line-height: 1;
}
.fit-kpi-name {
    font-size: var(--text-xs);
    color: var(--text-secondary);
    margin-top: 5px;
}
.fit-kpi-hint {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--text-muted);
    margin-top: 3px;
    letter-spacing: 0.03em;
}
.fit-kpi-bar {
    height: 6px;
    background: var(--border);
    border-radius: 2px;
    margin-top: 14px;
    overflow: hidden;
}
.fit-kpi-bar-fill {
    height: 100%;
    border-radius: 2px;
    width: 0;
    transition: width 0.6s ease;
}

/* Fitness KPI colour variants */
.fit-kpi-value--ctl {
    color: var(--accent);
}
.fit-kpi-value--atl {
    color: var(--orange);
}
.fit-kpi-bar-fill--ctl {
    background: var(--accent);
}
.fit-kpi-bar-fill--atl {
    background: var(--orange);
}

/* ── Wellness strip ── */
.fit-wellness-strip {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
}
.fit-wcard {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 16px 18px;
    transition: border-color var(--transition);
}
.fit-wcard:hover {
    border-color: var(--border-active);
}
.fit-wcard-label {
    font-size: var(--text-2xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--text-muted);
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 5px;
}
.fit-wcard-val {
    font-size: var(--text-xl);
    font-weight: 800;
    font-family: var(--font-num);
    letter-spacing: -1.5px;
    line-height: 1;
    color: var(--text-primary);
}
.fit-wcard-sub {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 5px;
}
.fit-wcard-trend {
    font-size: var(--text-base);
    font-weight: 700;
}

/* ── Range pills ── */
.fit-range-pills {
    display: flex;
    gap: 2px;
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 3px;
}
.fit-range-pills button {
    background: none;
    border: none;
    color: var(--text-muted);
    font-size: var(--text-xs);
    font-weight: 600;
    padding: 3px 10px;
    border-radius: 6px;
    cursor: pointer;
    transition: all var(--transition);
}
.fit-range-pills button:hover {
    color: var(--text-primary);
    background: var(--bg-elevated);
}
.fit-range-pills button.active {
    background: var(--bg-elevated);
    color: var(--text-primary);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

/* Chart heights */
.chart-wrap--lg {
    height: 280px;
}
.chart-wrap--md {
    height: 200px;
}

/* ── Activity heatmap ── */
.fit-heatmap-scroll {
    overflow-x: auto;
    padding-bottom: 4px;
    scrollbar-width: none;
    -ms-overflow-style: none;
    min-width: 0;
    width: 100%;
}
.fit-heatmap-scroll::-webkit-scrollbar {
    display: none;
}
.fit-heatmap {
    display: flex;
    gap: 3px;
    align-items: flex-start;
    min-width: max-content;
    padding: 4px 0;
}
.fit-hm-days {
    display: flex;
    flex-direction: column;
    gap: 3px;
    margin-right: 4px;
    margin-top: 18px;
}
.fit-hm-day-label {
    width: 14px;
    height: 12px;
    font-size: var(--text-2xs);
    color: var(--text-muted);
    display: flex;
    align-items: center;
}
.fit-hm-col {
    display: flex;
    flex-direction: column;
    gap: 3px;
}
.fit-hm-month-lbl {
    height: 16px;
    font-size: var(--text-2xs);
    color: var(--text-muted);
    white-space: nowrap;
    margin-bottom: 2px;
}
.fit-hm-cell {
    width: 12px;
    height: 12px;
    border-radius: 2px;
    cursor: default;
    transition: opacity 0.15s;
}
.fit-hm-cell:hover {
    opacity: 0.75;
}
.fit-hm-cell--future {
    background: var(--bg-surface);
    opacity: 0.25;
}
.fit-hm-cell--0 {
    background: var(--bg-elevated);
}
.fit-hm-cell--1 {
    background: rgba(0, 229, 160, 0.18);
}
.fit-hm-cell--2 {
    background: rgba(0, 229, 160, 0.42);
}
.fit-hm-cell--3 {
    background: rgba(0, 229, 160, 0.68);
}
.fit-hm-cell--4 {
    background: var(--accent);
}

/* Heatmap legend (in card-header-controls) */
.fit-hm-legend {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: var(--text-2xs);
    color: var(--text-muted);
}
.fit-hm-swatch {
    width: 10px;
    height: 10px;
    border-radius: 2px;
    flex-shrink: 0;
}
.fit-hm-swatch--0 {
    background: var(--bg-elevated);
}
.fit-hm-swatch--1 {
    background: rgba(0, 229, 160, 0.2);
}
.fit-hm-swatch--2 {
    background: rgba(0, 229, 160, 0.45);
}
.fit-hm-swatch--3 {
    background: rgba(0, 229, 160, 0.68);
}
.fit-hm-swatch--4 {
    background: var(--accent);
}

/* ── Training Calendar + Weekly Load row (equal height) ── */
.fit-cal-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
    align-items: stretch;
}
.fit-card-flex {
    display: flex;
    flex-direction: column;
    min-width: 0;
}
.fit-heatmap-fill {
    flex: 1;
    display: flex;
    align-items: center;
    min-width: 0;
}
.fit-chart-fill {
    flex: 1;
    min-height: 160px;
}

/* ── Monthly table ── */
.fit-monthly-wrap {
    overflow-x: auto;
}
.fit-monthly-table {
    width: 100%;
    border-collapse: collapse;
    font-size: var(--text-sm);
}
.fit-monthly-table thead th {
    text-align: left;
    font-size: var(--text-2xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    padding: 0 10px 10px 0;
    border-bottom: 1px solid var(--border);
}
.fit-monthly-table tbody tr {
    border-bottom: 1px solid var(--border);
    transition: background var(--transition);
}
.fit-monthly-table tbody tr:last-child {
    border-bottom: none;
}
.fit-monthly-table tbody tr:hover {
    background: var(--bg-elevated);
}
.fit-monthly-table td {
    padding: 10px 10px 10px 0;
    color: var(--text-secondary);
    font-variant-numeric: tabular-nums;
}
.fit-month-label {
    color: var(--text-primary) !important;
    font-weight: 600;
}
.fit-tss-cell {
    color: var(--accent) !important;
    font-weight: 700;
    font-family: var(--font-num);
}

/* ── Responsive ── */
@media (max-width: 1100px) {
    .fit-kpi-row {
        grid-template-columns: repeat(3, 1fr);
    }
}
@media (max-width: 900px) {
    .fit-kpi-row {
        grid-template-columns: repeat(3, 1fr);
    }
    .fit-wellness-strip {
        grid-template-columns: repeat(2, 1fr);
    }
    .fit-cal-row {
        grid-template-columns: 1fr;
    }
}
@media (max-width: 600px) {
    .fit-kpi-row {
        grid-template-columns: repeat(2, 1fr);
    }
    .fit-wellness-strip {
        grid-template-columns: repeat(2, 1fr);
    }
    .fit-hm-legend {
        display: none;
    }
}

/* ============================================================
   SETTINGS PAGE
============================================================ */
.settings-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--gap-layout);
    align-items: start;
}
.settings-col {
    display: flex;
    flex-direction: column;
    gap: var(--gap-layout);
}
@media (max-width: 860px) {
    .settings-grid { grid-template-columns: 1fr; }
}
.settings-section {
    margin-bottom: 16px;
}
.settings-section-title {
    font-size: var(--text-sm);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.07em;
    color: var(--text-muted);
    margin-bottom: 14px;
}
.settings-row {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 10px 12px;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    margin-bottom: 6px;
}
.settings-row-info {
    flex: 1;
}
.settings-row-label {
    font-size: var(--text-base);
    font-weight: 600;
    margin-bottom: 2px;
}
.settings-row-sub {
    font-size: var(--text-sm);
    color: var(--text-muted);
}
.settings-row-value {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    font-family: var(--font-num);
    background: var(--bg-card);
    padding: 4px 10px;
    border-radius: 6px;
    border: 1px solid var(--border);
}
.connection-status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: var(--text-sm);
    font-weight: 600;
}
.connection-status-badge.connected {
    background: var(--accent-dim);
    color: var(--accent);
}
.connection-status-badge.disconnected {
    background: rgba(255, 71, 87, 0.12);
    color: var(--red);
}
.settings-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}
/* Avatar row */
.settings-row--avatar { align-items: center; gap: 14px; }
.avatar-preview-wrap {
    position: relative;
    flex-shrink: 0;
}
.avatar-preview {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), var(--blue));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--bg-base);
    overflow: hidden;
    border: 2px solid var(--border);
}
.avatar-edit-btn {
    position: absolute;
    bottom: -2px;
    right: -2px;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: var(--accent);
    border: 2px solid var(--bg-elevated);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background var(--transition);
}
.avatar-edit-btn:hover { background: var(--text-primary); }
.avatar-edit-btn svg { width: 11px; height: 11px; stroke: var(--bg-base); }
.btn-sm { padding: 4px 10px; font-size: var(--text-sm); }
.about-text {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    line-height: 1.6;
}

/* ============================================================
   LOADING & TOAST
============================================================ */
.loading-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(13, 15, 20, 0.8);
    z-index: 400;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 12px;
}
.loading-overlay.active {
    display: flex;
}
.spinner {
    width: 36px;
    height: 36px;
    border: 3px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
}
.spinner-sm {
    width: 14px;
    height: 14px;
    border-width: 2px;
    border-top-color: var(--bg-base);
}
@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}
.loading-text {
    font-size: var(--text-base);
    color: var(--text-secondary);
}
.toast-container {
    position: fixed;
    bottom: 28px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 600;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    pointer-events: none;
}
.toast {
    pointer-events: all;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 9px 16px 9px 12px;
    border-radius: 999px;
    font-size: var(--text-sm);
    font-weight: 500;
    white-space: nowrap;
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    box-shadow: 0 4px 24px rgba(0,0,0,0.35), 0 1px 0 rgba(255,255,255,0.04) inset;
    animation: toastIn 0.28s cubic-bezier(0.34, 1.56, 0.64, 1);
    background: color-mix(in srgb, var(--bg-elevated) 90%, transparent);
    border: 1px solid var(--border);
    color: var(--text-primary);
}
.toast-icon {
    width: 18px;
    height: 18px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
}
.toast-icon svg {
    width: 16px;
    height: 16px;
    stroke-width: 2.5;
}
.toast.success .toast-icon svg { stroke: #22c55e; }
.toast.error   .toast-icon svg { stroke: var(--red); }
.toast.info    .toast-icon svg { stroke: var(--blue); }
.toast.success { border-color: #22c55e30; }
.toast.error   { border-color: color-mix(in srgb, var(--red) 30%, transparent); }
.toast.info    { border-color: color-mix(in srgb, var(--blue) 30%, transparent); }
@keyframes toastIn {
    from {
        opacity: 0;
        transform: translateY(10px) scale(0.92);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* ============================================================
   EMPTY STATE
============================================================ */
.empty-state {
    text-align: center;
    padding: 48px 20px;
    color: var(--text-muted);
}
.empty-state--xl {
    padding: 60px 20px;
}
.empty-state svg {
    width: 40px;
    height: 40px;
    margin: 0 auto 12px;
    opacity: 0.35;
}
.empty-state p {
    font-size: var(--text-base);
    line-height: 1.5;
}
.empty-state .btn {
    margin: 16px auto 0;
}

/* ============================================================
   PAGE VISIBILITY
============================================================ */
.page {
    display: none;
}
.page.active {
    display: contents;
}

@keyframes pageFadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to   { opacity: 1; transform: translateY(0);   }
}
.page.active > * {
    animation: pageFadeIn 0.22s ease-out both;
}

/* ============================================================
   CALENDAR PAGE
============================================================ */
/* Full-height mode: strip page-content padding when calendar is active */
.page-content--calendar {
    padding: 0 !important;
    gap: 0 !important;
}

/* Shell is fixed, sits below the topbar */
.cal-shell {
    position: fixed;
    left: var(--sidebar-w);
    right: 0;
    top: calc(48px + env(safe-area-inset-top));
    bottom: 0;
    z-index: 2;
    display: flex;
    flex-direction: column;
    background: var(--bg-card);
    overflow: hidden;
}

/* ── Header (nav + month stats) ── */
.cal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 13px 20px;
    border-bottom: 1px solid var(--border);
    background: var(--bg-surface);
    flex-shrink: 0;
    gap: 12px;
    flex-wrap: wrap;
}
.cal-header-nav {
    display: flex;
    align-items: center;
    gap: 4px;
}
.cal-month-title {
    font-size: var(--text-lg);
    font-weight: 800;
    letter-spacing: -0.4px;
    color: var(--text-primary);
    min-width: 168px;
    text-align: center;
}
.cal-today-btn {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--accent);
    background: var(--accent-dim);
    border: 1px solid rgba(0, 229, 160, 0.18);
    border-radius: 20px;
    padding: 4px 13px;
    cursor: pointer;
    margin-left: 6px;
    transition:
        background var(--transition),
        border-color var(--transition);
}
.cal-today-btn:hover {
    background: rgba(0, 229, 160, 0.22);
    border-color: var(--accent);
}

/* Month stats strip — above month grid */
.cal-stats-strip {
    display: flex;
    align-items: stretch;
    border-bottom: 1px solid var(--border);
    background: var(--bg-elevated);
}
.cal-hstat {
    display: flex;
    flex-direction: column;
    justify-content: center;
    flex: 1;
    padding: 13px 16px;
    gap: 1px;
}
.cal-hstat-div {
    width: 1px;
    background: var(--border);
    align-self: stretch;
}
.cal-hstat-val {
    font-size: var(--text-base);
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1.15;
}
.cal-hstat-label {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: var(--text-2xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--text-muted);
}
.cal-hstat-label svg {
    width: 11px;
    height: 11px;
    flex-shrink: 0;
    opacity: 0.7;
}

/* ── Top section wrapper (60% of remaining space) ── */
.cal-top {
    flex: 3;
    display: flex;
    flex-direction: column;
    min-height: 0;
    overflow: hidden;
}

/* ── Day-of-week strip ── */
.cal-dow-row {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    border-bottom: 1px solid var(--border);
    background: var(--bg-surface);
    flex-shrink: 0;
}
.cal-dow-row > div {
    padding: 7px 0;
    text-align: center;
    font-size: var(--text-2xs);
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
}
.cal-dow--weekend {
    opacity: 0.45;
}

/* ── Calendar grid ── */
.cal-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    grid-auto-rows: 1fr;
    flex: 1;
    min-height: 0;
}

/* ── Compact iOS-style day cells ── */
.cal-day {
    border-right: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
    padding: 6px 2px 5px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    cursor: pointer;
    transition: background var(--transition);
    gap: 4px;
    overflow: hidden;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
}
.cal-day:nth-child(7n) {
    border-right: none;
}
.cal-day:hover {
    background: var(--bg-elevated);
}
.cal-day:active {
    background: var(--bg-card);
}
.cal-day--other-month {
    background: var(--bg-base);
}
.cal-day--other-month:hover {
    background: var(--bg-base);
}
.cal-day--other-month .cal-day-num {
    opacity: 0.22;
}
.cal-day--weekend:not(.cal-day--other-month) {
    background: rgba(255, 255, 255, 0.013);
}

/* Day number circle */
.cal-day-num {
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--text-secondary);
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    flex-shrink: 0;
    line-height: 1;
    transition:
        background var(--transition),
        color var(--transition);
}
/* Today: filled green circle */
.cal-day--today .cal-day-num {
    background: var(--accent);
    color: #0d0f14;
    font-weight: 800;
}
/* Selected (not today): white/light circle */
.cal-day--selected:not(.cal-day--today) .cal-day-num {
    background: var(--text-primary);
    color: var(--bg-base);
    font-weight: 700;
}
/* Selected today: brighter accent */
.cal-day--selected.cal-day--today .cal-day-num {
    box-shadow: 0 0 0 3px rgba(0, 229, 160, 0.35);
}

/* Activity dot indicators */
.cal-dots {
    display: flex;
    gap: 3px;
    justify-content: center;
    align-items: center;
    min-height: 6px;
}
.cal-dot {
    width: 5px;
    height: 5px;
    border-radius: 50%;
    flex-shrink: 0;
    opacity: 0.9;
}
.cal-dot.cal-event--ride    { background: var(--accent); }
.cal-dot.cal-event--run     { background: var(--orange); }
.cal-dot.cal-event--swim    { background: var(--blue); }
.cal-dot.cal-event--virtual { background: var(--purple); }
.cal-dot.cal-event--other   { background: var(--text-muted); }

/* Heart rate pill — bottom-centre of day cell, desktop only */
.cal-day-hr {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 3px;
    margin-top: auto;
    font-size: var(--text-sm);
    font-weight: 500;
    font-family: var(--font-num);
    color: var(--text-secondary);
    line-height: 1;
    padding-bottom: 5px;
}
.cal-day-hr svg {
    width: 11px;
    height: 11px;
    color: #f87171;
    flex-shrink: 0;
}
@media (max-width: 700px) {
    .cal-day-hr { display: none; }
}
/* Mute dots on other-month days */
.cal-day--other-month .cal-dot { opacity: 0.25; }

/* ── Desktop: mini activity cards — styled like dashboard .activity-row ── */
.cal-day-cards {
    display: flex;
    flex-direction: column;
    gap: 3px;
    width: 100%;
    min-width: 0;
    overflow: hidden;
    flex: 1;
}
.cal-day-card {
    display: flex;
    flex-direction: column;
    gap: 2px;
    border-radius: 8px;
    padding: 4px 6px 4px 5px;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    overflow: hidden;
    flex-shrink: 0;
    cursor: pointer;
    transition:
        border-color 0.15s ease,
        transform    0.15s ease,
        box-shadow   0.15s ease;
}
.cal-day-card:hover {
    border-color: var(--border-active);
    transform: translateY(-1px);
    box-shadow: 0 4px 14px rgba(0, 0, 0, 0.28);
}
.cal-day-card:active {
    transform: translateY(0);
    box-shadow: none;
}

/* Row 1: icon box + stats */
.cal-day-card-top {
    display: flex;
    align-items: center;
    gap: 5px;
    overflow: hidden;
}

/* Coloured icon box — mini .activity-type-icon */
.cal-card-icon-box {
    width: 20px;
    height: 20px;
    border-radius: 6px;
    background: var(--accent-dim);
    color: var(--accent);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}
.cal-card-icon-box.run     { background: var(--orange-dim); color: var(--orange); }
.cal-card-icon-box.swim    { background: var(--blue-dim);   color: var(--blue); }
.cal-card-icon-box.virtual { background: var(--purple-dim); color: var(--purple); }
.cal-card-icon-box.other   { background: rgba(136,145,168,0.10); color: var(--text-muted); }
.cal-card-icon { display: block; }

/* Bold numeric stats — mirrors .act-stat-val */
.cal-day-card-stats {
    font-size: 11px;
    font-weight: 800;
    font-family: var(--font-num);
    letter-spacing: -0.3px;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2;
    flex: 1;
    min-width: 0;
}

/* SVG intensity bar icon */
.cal-intensity {
    flex-shrink: 0;
    margin-left: 3px;
    display: block;
    align-self: center;
    overflow: visible;
}

/* Row 2: muted name — mirrors .act-card-sub */
.cal-day-card-name {
    font-size: 9.5px;
    font-weight: 500;
    color: var(--text-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2;
    padding-left: 25px; /* align under stats text, clearing icon+gap */
}
.cal-day-more {
    font-size: 9px;
    font-weight: 700;
    color: var(--text-muted);
    padding: 1px 4px;
    opacity: 0.6;
}

/* Indoor / Outdoor tag */
.cal-env-tag {
    display: inline-block;
    font-size: 8px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    border-radius: 3px;
    padding: 0px 3px;
    margin-right: 4px;
    vertical-align: middle;
    flex-shrink: 0;
}
.cal-env-tag--indoor {
    background: rgba(160, 120, 255, 0.15);
    color: var(--purple);
    border: 1px solid rgba(160, 120, 255, 0.3);
}
.cal-env-tag--outdoor {
    background: rgba(0, 229, 160, 0.10);
    color: var(--accent);
    border: 1px solid rgba(0, 229, 160, 0.25);
}
/* Mute cards on other-month days */
.cal-day--other-month .cal-day-card { opacity: 0.25; }
/* Default (desktop): show cards, hide dots */
.cal-dots      { display: none; }
.cal-day-cards { display: flex; }

/* ── Bottom panel: selected day's activities (40%) ── */
.cal-day-panel {
    flex: 2;
    display: flex;
    flex-direction: column;
    border-top: 1px solid var(--border);
    min-height: 0;
    overflow: hidden;
    background: var(--bg-surface);
}
.cal-day-panel-header {
    padding: 11px 18px 9px;
    font-size: var(--text-sm);
    font-weight: 700;
    color: var(--text-primary);
    letter-spacing: -0.2px;
    border-bottom: 1px solid var(--border);
    flex-shrink: 0;
    background: var(--bg-surface);
}
.cal-day-panel-list {
    flex: 1;
    overflow-y: auto;
    padding: 4px 0;
}

/* Activity rows in day panel */
.cal-list-item {
    display: flex;
    align-items: center;
    gap: 13px;
    padding: 10px 18px;
    cursor: pointer;
    transition: background var(--transition);
    border-bottom: 1px solid var(--border);
    -webkit-tap-highlight-color: transparent;
}
.cal-list-item:last-child {
    border-bottom: none;
}
.cal-list-item:hover {
    background: var(--bg-elevated);
}
.cal-list-item:active {
    background: var(--bg-card);
}
.cal-list-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    flex-shrink: 0;
}
.cal-list-dot.cal-event--ride    { background: var(--accent); }
.cal-list-dot.cal-event--run     { background: var(--orange); }
.cal-list-dot.cal-event--swim    { background: var(--blue); }
.cal-list-dot.cal-event--virtual { background: var(--purple); }
.cal-list-dot.cal-event--other   { background: var(--text-muted); }
.cal-list-info {
    flex: 1;
    min-width: 0;
}
.cal-list-name {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.cal-list-meta {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 2px;
}
.cal-list-tss {
    font-size: var(--text-xs);
    font-weight: 700;
    color: var(--text-muted);
    flex-shrink: 0;
    white-space: nowrap;
}
/* Chevron arrow for list items */
.cal-list-chevron {
    color: var(--text-muted);
    opacity: 0.4;
    flex-shrink: 0;
}
/* Empty / rest day state */
.cal-day-empty {
    padding: 28px 18px;
    text-align: center;
    color: var(--text-muted);
    font-size: var(--text-sm);
    font-style: italic;
}

/* ============================================================
   ACTIVITY DETAIL PAGE
============================================================ */

/* ── Colour-mode toggle bar ─────────────────────────────── */
.map-color-toggles {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    padding: 0 0 10px 0;
    min-height: 0;   /* collapses if JS hasn't populated it yet */
}
.map-mode-btn {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 4px 11px 4px 9px;
    border-radius: 20px;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.05);
    color: var(--text-muted);
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.03em;
    cursor: pointer;
    transition: background 0.15s, color 0.15s, border-color 0.15s;
    white-space: nowrap;
}
.map-mode-btn:hover {
    background: rgba(255,255,255,0.10);
    color: var(--text);
    border-color: rgba(255,255,255,0.22);
}
.map-mode-btn.active {
    background: rgba(0,200,122,0.18);
    border-color: #00c87a;
    color: #00e5a0;
}
/* Per-mode accent colours when active */
.map-mode-btn.active[data-mode="hr"]       { background: rgba(239,68,68,0.15);  border-color: #f87171; color: #fca5a5; }
.map-mode-btn.active[data-mode="speed"]    { background: rgba(30,58,138,0.35);  border-color: #3b82f6; color: #93c5fd; }
.map-mode-btn.active[data-mode="power"]    { background: rgba(251,146,60,0.18); border-color: #f97316; color: #fdba74; }
.map-mode-btn.active[data-mode="altitude"] { background: rgba(124,58,237,0.18); border-color: #7c3aed; color: #c4b5fd; }
.map-mode-icon {
    font-size: 10px;
    opacity: 0.85;
}
/* Satellite layer toggle — same pill shape, pushed to the far right */
.map-layer-btn {
    margin-left: auto;
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 4px 11px 4px 9px;
    font-size: 11px;
    font-weight: 600;
    border-radius: 20px;
    border: 1px solid rgba(255,255,255,0.13);
    background: rgba(255,255,255,0.05);
    color: var(--text-muted);
    cursor: pointer;
    transition: background 0.15s, color 0.15s, border-color 0.15s;
    white-space: nowrap;
}
.map-layer-btn:hover {
    background: rgba(255,255,255,0.10);
    color: var(--text);
    border-color: rgba(255,255,255,0.22);
}
.map-layer-btn.active {
    background: rgba(251,191,36,0.15);
    border-color: #fbbf24;
    color: #fde68a;
}

/* Leaflet cursor fixes */
.leaflet-container {
    cursor: grab !important;
}
.leaflet-dragging .leaflet-container,
.leaflet-dragging .leaflet-container * {
    cursor: grabbing !important;
}
/* Prevent zoom cursor from getting stuck after scroll-wheel zoom */
.leaflet-container.leaflet-zoom-anim,
.leaflet-container:not(.leaflet-dragging) {
    cursor: grab !important;
}

/* Leaflet zoom controls — dark theme override */
.leaflet-bar {
    border: 1px solid rgba(255,255,255,0.13) !important;
    box-shadow: 0 1px 5px rgba(0,0,0,0.5) !important;
    border-radius: 8px !important;
    overflow: hidden;
}
.leaflet-bar a,
.leaflet-bar a:hover {
    background: rgba(20,23,32,0.82) !important;
    backdrop-filter: blur(4px);
    color: var(--text-secondary) !important;
    border-bottom: 1px solid rgba(255,255,255,0.08) !important;
    width: 30px !important;
    height: 30px !important;
    line-height: 30px !important;
    font-size: 16px !important;
    font-weight: 400 !important;
    transition: background 0.15s, color 0.15s;
}
.leaflet-bar a:last-child {
    border-bottom: none !important;
}
.leaflet-bar a:hover {
    background: rgba(37,43,58,0.95) !important;
    color: var(--text-primary) !important;
}
.leaflet-bar a.leaflet-disabled {
    opacity: 0.35 !important;
    cursor: default !important;
}

/* Satellite toggle — Leaflet in-map control */
.map-sat-control {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 4px 11px 4px 9px;
    font-size: 11px;
    font-weight: 600;
    font-family: var(--font-ui);
    border-radius: 20px;
    border: 1px solid rgba(255,255,255,0.13);
    background: rgba(20,23,32,0.82);
    color: var(--text-primary);
    cursor: pointer !important;
    box-shadow: 0 1px 5px rgba(0,0,0,0.5);
    backdrop-filter: blur(4px);
    transition: background 0.15s, color 0.15s, border-color 0.15s;
    white-space: nowrap;
    margin-bottom: 8px;
}
.map-sat-control:hover {
    background: rgba(37,43,58,0.92);
    color: var(--text-primary);
    border-color: rgba(255,255,255,0.22);
}
.map-sat-control.active {
    background: rgba(251,191,36,0.15);
    border-color: #fbbf24;
    color: #fde68a;
}

.map-recentre-control {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    border: 1px solid rgba(255,255,255,0.13);
    background: rgba(20,23,32,0.82);
    color: var(--text-primary);
    cursor: pointer !important;
    box-shadow: 0 1px 5px rgba(0,0,0,0.5);
    backdrop-filter: blur(4px);
    transition: background 0.15s, border-color 0.15s, color 0.15s;
    margin-top: 8px;
    margin-right: 8px;
}
.map-recentre-control:hover {
    background: rgba(37,43,58,0.92);
    border-color: rgba(255,255,255,0.22);
    color: #fff;
}
.map-recentre-control:active {
    background: rgba(255,255,255,0.08);
}

/* Route map + hover stats layout */
.map-with-stats {
    display: flex;
    gap: 16px;
    align-items: stretch;
    min-height: 320px; /* floor — panel content drives the actual height */
}
.activity-map {
    flex: 1 1 auto;
    min-width: 0;
    min-height: 200px; /* hard floor — map never collapses below this */
    /* no fixed height: flexbox stretches to match the panel height */
    isolation: isolate; /* confine Leaflet's z-indices so they don't bleed over the sidebar */
    border-radius: var(--radius);
    overflow: hidden;
    background: var(--bg-elevated);
    cursor: crosshair;
}
.map-stats-panel {
    width: 205px;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    justify-content: space-between; /* gauge at top, metrics at bottom, full height used */
    gap: 14px;
    padding: 6px 0 4px;
    position: relative;   /* sit above Leaflet canvas layers */
    z-index: 2;
}

/* ── Speed gauge ────────────────────────────────────────── */
.speed-gauge {
    width: 100%;
}
.speed-gauge svg {
    display: block;
    width: 100%;
    height: auto;
    /* viewBox is sized to contain all elements — no overflow needed */
}
.g-track {
    fill: none;
    stroke: rgba(255,255,255,0.09);
    stroke-width: 8;
    stroke-linecap: round;
}
.g-fill {
    fill: none;
    stroke: url(#gaugeGrad);
    stroke-width: 8;
    stroke-linecap: round;
    transition: stroke-dasharray 0.07s linear;
}
/* SVG text colours are set via inline fill= attributes so they always
   render white/light regardless of CSS variable support in SVG context */
.g-num  { font-size: 22px; font-weight: 700; font-family: inherit; }
.g-unit { font-size: 8px;  font-weight: 500; letter-spacing: 0.06em; }
.g-zero, .g-max { font-size: 7.5px; font-weight: 500; }
.g-label {
    text-align: center;
    font-size: 9px;
    font-weight: 700;
    letter-spacing: 0.1em;
    color: var(--text-muted);
    text-transform: uppercase;
    margin-top: 0;
}

/* ── Garmin-style data grid ──────────────────────────────── */
.map-metrics {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4px;
}
/* A single data field cell */
.mm-cell {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: 8px;
    padding: 5px 7px 6px;
    display: flex;
    flex-direction: column;
    gap: 1px;
    min-width: 0;
}
/* Time (and any other full-width cells) span both columns */
.mm-full {
    grid-column: 1 / -1;
}
/* Label row: icon + text */
.mm-header {
    display: flex;
    align-items: center;
    gap: 3px;
}
.mm-icon {
    flex-shrink: 0;
    width: 9px;
    height: 9px;
    color: var(--text-muted);
    display: flex;
    align-items: center;
    opacity: 0.7;
}
.mm-icon svg { width: 100%; height: 100%; }

/* Heartbeat — duration driven by --hr-period set in JS */
@keyframes hrPulse {
    0%   { transform: scale(1);    }
    20%  { transform: scale(1.6);  }
    36%  { transform: scale(1);    }
    52%  { transform: scale(1.25); }
    68%  { transform: scale(1);    }
    100% { transform: scale(1);    }
}
.hr-icon    { transform-origin: center; }
.hr-beating { animation: hrPulse var(--hr-period, 0.75s) linear infinite; }

.mm-lbl {
    font-size: 8.5px;
    font-weight: 700;
    letter-spacing: 0.07em;
    text-transform: uppercase;
    color: var(--text-muted);
    line-height: 1;
}
/* Number + unit row */
.mm-data {
    display: flex;
    align-items: baseline;
    gap: 2px;
    margin-top: 1px;
}
.mm-val {
    font-size: 20px;
    font-weight: 800;
    line-height: 1;
    color: var(--text);
    font-variant-numeric: tabular-nums;
    letter-spacing: -0.02em;
    transition: color 0.25s ease;
    min-width: 0;
    overflow: hidden;
    text-overflow: clip;
}

.mm-unt {
    font-size: 9px;
    font-weight: 500;
    color: var(--text-muted);
    white-space: nowrap;
    flex-shrink: 0;
}

/* ── Responsive: stack map above data panel ─────────────────────────────
   Kicks in at 640 px so the map never gets squeezed below ~470 px wide   */
@media (max-width: 640px) {
    .map-with-stats {
        flex-direction: column;
        gap: 12px;
    }
    /* Map goes full-width; locked height — flex: 0 0 prevents any shrinking */
    .activity-map {
        flex: 0 0 260px;
        height: 260px;
        min-height: 260px;
    }
    /* Panel goes full-width and lays out horizontally:
       gauge on the left, data cells filling the rest */
    .map-stats-panel {
        width: 100%;
        flex-direction: row;
        align-items: flex-start;
        gap: 12px;
        padding: 0;
    }
    .speed-gauge {
        width: 130px;
        flex-shrink: 0;
    }
    .map-metrics {
        flex: 1 1 0;
        min-width: 0;
        /* Keep 2-col grid but let it fill available width */
        grid-template-columns: 1fr 1fr;
    }
}
/* Alt + scroll zoom — cursor + hint overlay */
.activity-map.alt-zoom,
.activity-map.alt-zoom * { cursor: zoom-in !important; }

.map-scroll-hint {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.72);
    color: #e2e8f0;
    font-size: 12px;
    font-weight: 600;
    letter-spacing: 0.03em;
    padding: 7px 16px;
    border-radius: 20px;
    pointer-events: none;
    z-index: 800;
    opacity: 0;
    transition: opacity 0.2s ease;
    white-space: nowrap;
}
.map-scroll-hint.visible { opacity: 1; }

/* Attribution — small and unobtrusive, dark theme */
.activity-map .leaflet-control-attribution,
.recent-act-map .leaflet-control-attribution {
    background: rgba(10,12,18,0.55) !important;
    color: rgba(255,255,255,0.3) !important;
    font-size: 9px !important;
    border-radius: 4px !important;
    backdrop-filter: blur(4px);
}
.activity-map .leaflet-control-attribution a,
.recent-act-map .leaflet-control-attribution a {
    color: rgba(255,255,255,0.4) !important;
}

/* Back button — sits on the LEFT of the topbar, right after the burger */
.detail-topbar-back {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: var(--text-sm);
    white-space: nowrap;
    margin-left: 4px;
}
/* Prev/next arrows — sit on the RIGHT in topbar-actions */
.detail-nav-arrows {
    display: flex;
    align-items: center;
    gap: 2px;
}
.detail-nav-btn {
    padding: 6px 8px;
    line-height: 0;
}
.detail-nav-btn:disabled {
    opacity: 0.25;
    pointer-events: none;
}
.detail-nav-counter {
    font-size: var(--text-xs);
    color: var(--text-muted);
    font-family: var(--font-num);
    min-width: 46px;
    text-align: center;
    letter-spacing: 0.02em;
}

/* ── Activity hero ───────────────────────────────────────────────────── */
.act-hero {
    padding: 20px 0 28px;
    margin-bottom: 20px;
}

/* eyebrow: icon · type badge · TSS — sits below the title */
.act-hero-eyebrow {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 8px;
    margin-bottom: 10px;
}
.act-type-badge {
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 2px 10px;
    font-size: var(--text-2xs);
    font-weight: 700;
    letter-spacing: 0.07em;
    text-transform: uppercase;
    color: var(--text-muted);
}
.act-tss-badge {
    background: var(--accent-dim);
    border: 1px solid var(--accent-glow);
    color: var(--accent);
    border-radius: 20px;
    padding: 2px 10px;
    font-size: var(--text-xs);
    font-weight: 700;
    font-family: var(--font-num);
    letter-spacing: 0.04em;
    white-space: nowrap;
}

/* title */
.act-hero-title {
    font-size: clamp(1.7rem, 4vw, 2.6rem);
    font-weight: 900;
    letter-spacing: -1px;
    line-height: 1.05;
    color: var(--text-primary);
    margin: 0 0 6px;
    overflow-wrap: break-word;
}

/* date line */
.act-hero-date {
    font-size: var(--text-sm);
    color: var(--text-muted);
    margin-bottom: 24px;
    letter-spacing: 0.01em;
}

/* primary stats: 4-column bordered grid */
.act-primary-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
}
.act-pstat {
    padding: 14px 14px 12px;
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    text-align: left;
    gap: 6px;
    transition: background var(--transition);
}
.act-pstat:hover {
    background: var(--bg-elevated);
}
.act-pstat:last-child {
    border-right: none;
}
.act-pstat-val {
    font-size: clamp(1.55rem, 3vw, 2.1rem);
    font-weight: 900;
    font-family: var(--font-num);
    letter-spacing: -1.5px;
    line-height: 1;
    color: var(--text-primary);
    white-space: nowrap;
}
.act-pstat--accent .act-pstat-val {
    color: var(--accent);
}
.act-pstat-lbl {
    font-size: var(--text-2xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.09em;
    color: var(--text-muted);
}
@media (max-width: 600px) {
    .act-primary-stats {
        grid-template-columns: repeat(2, 1fr);
    }
    .act-pstat:nth-child(2) {
        border-right: none;
    }
    .act-pstat:nth-child(1),
    .act-pstat:nth-child(2) {
        border-bottom: 1px solid var(--border);
    }
    .act-pstat-val {
        font-size: 1.5rem;
    }
}

/* ── activity primary stat comparison chips ─────────────────────────────── */
.act-pstat-cmp {
    font-size: var(--text-2xs);
    font-weight: 700;
    letter-spacing: 0.04em;
    display: flex;
    align-items: center;
    gap: 3px;
    margin-top: 2px;
}
.act-pstat-cmp.cmp-up   { color: #22c55e; }
.act-pstat-cmp.cmp-down { color: var(--text-muted); }
.act-pstat-cmp.cmp-same { color: var(--text-muted); }

/* ── "How You Compare" card ─────────────────────────────────────────────── */
.detail-cmp-badge {
    font-size: var(--text-xs);
    font-weight: 600;
    padding: 4px 12px;
    border-radius: 20px;
    white-space: nowrap;
}
.detail-cmp-rows {
    display: flex;
    flex-direction: column;
    gap: 26px;
    padding-top: 4px;
}
.detail-cmp-row {
    display: grid;
    grid-template-columns: 90px 1fr 80px;
    align-items: center;
    gap: 12px;
}
.detail-cmp-label {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.07em;
    white-space: nowrap;
}
.detail-cmp-bar-wrap {
    position: relative;
    height: 14px;
    background: var(--bg-elevated);
    border-radius: 3px;
    overflow: visible;
}
.detail-cmp-bar-avg {
    position: absolute;
    top: -3px;
    bottom: -3px;
    width: 2px;
    background: var(--border-active);
    border-radius: 2px;
    z-index: 2;
    overflow: visible;
}
.detail-cmp-bar-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.5s cubic-bezier(0.25, 1, 0.5, 1);
    max-width: 100%;
}
.detail-cmp-vals {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 7px;
}
.detail-cmp-this {
    font-size: var(--text-sm);
    font-weight: 700;
    font-family: var(--font-num);
    color: var(--text-primary);
    line-height: 1;
}
.detail-cmp-avg-val {
    position: absolute;
    top: calc(100% + 5px);
    left: 50%;
    transform: translateX(-50%);
    white-space: nowrap;
    font-size: var(--text-2xs);
    color: var(--text-muted);
    line-height: 1;
}
.detail-cmp-pct {
    font-size: var(--text-2xs);
    font-weight: 700;
    padding: 2px 7px;
    border-radius: 10px;
    text-align: center;
}
.detail-cmp-pct.cmp-up   { background: rgba(0,229,160,0.12);  color: #00e5a0; }
.detail-cmp-pct.cmp-down { background: rgba(251,146,60,0.12); color: #fb923c; }
.detail-cmp-pct.cmp-same { background: var(--bg-elevated);    color: var(--text-muted); }

/* ── grid swap on mobile ─────────────────────────────────────────────────── */
@media (max-width: 480px) {
    .detail-cmp-row {
        grid-template-columns: 72px 1fr 60px;
        gap: 8px;
    }
}

/* secondary stats: icon tile grid */
.act-secondary-strip {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(145px, 1fr));
    gap: var(--gap-layout);
}
.act-sstat {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    padding: 13px 14px 12px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 14px;
    cursor: default;
    transition: border-color var(--transition), background var(--transition);
}
.act-sstat:hover {
    border-color: var(--border-active);
    background: var(--bg-elevated);
}
.act-sstat-top {
    display: flex;
    align-items: center;
    gap: 7px;
    margin-bottom: 9px;
    width: 100%;
}
.act-sstat-icon {
    width: 28px;
    height: 28px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}
.act-sstat-icon svg { width: 13px; height: 13px; }
.act-sstat-icon.green  { background: var(--accent-dim);          color: var(--accent); }
.act-sstat-icon.orange { background: var(--orange-dim);          color: var(--orange); }
.act-sstat-icon.blue   { background: var(--blue-dim);            color: var(--blue); }
.act-sstat-icon.purple { background: var(--purple-dim);          color: var(--purple); }
.act-sstat-icon.red    { background: rgba(255,71,87,0.12);       color: var(--red); }
.act-sstat-icon.yellow { background: var(--yellow-dim);          color: var(--yellow); }
.act-sstat-lbl {
    font-size: var(--text-2xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.07em;
    color: var(--text-muted);
    white-space: nowrap;
}
.act-sstat-val {
    font-size: clamp(1.25rem, 2.4vw, 1.55rem);
    font-weight: 800;
    font-family: var(--font-num);
    letter-spacing: -0.5px;
    color: var(--text-primary);
    white-space: nowrap;
    line-height: 1;
}
.act-sstat-cmp {
    font-size: var(--text-2xs);
    font-weight: 700;
    letter-spacing: 0.04em;
    margin-top: 10px;
}
.act-sstat-cmp.cmp-pos     { color: #22c55e; }
.act-sstat-cmp.cmp-neg     { color: #f87171; }
.act-sstat-cmp.cmp-neutral { color: var(--text-muted); }

/* ── Stream charts row ───────────────────────────────────────────────── */
.detail-charts-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
}
@media (max-width: 600px) {
    .detail-charts-row {
        grid-template-columns: 1fr;
    }
}

/* Power curve + HR curve side by side */
.detail-curves-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
}
.detail-curves-row > .card[style*="display:none"],
.detail-curves-row > .card[style*="display: none"] {
    display: none !important;
}
/* If only one card is visible, let it span full width */
.detail-curves-row:has(> .card:only-child),
.detail-curves-row:has(> .card[style*="display:none"]:first-child),
.detail-curves-row:has(> .card[style*="display:none"]:last-child) {
    grid-template-columns: 1fr;
}
@media (max-width: 700px) {
    .detail-curves-row {
        grid-template-columns: 1fr;
    }
}

/* ── Activity detail: performance analysis metrics grid ──────────── */
.perf-metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
    gap: 10px;
    padding: 2px 0 4px;
}
.perf-metric {
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: 10px;
    padding: 12px 14px;
    display: flex;
    flex-direction: column;
    gap: 4px;
}
.perf-metric-val {
    font-size: 22px;
    font-weight: 800;
    font-variant-numeric: tabular-nums;
    letter-spacing: -0.02em;
    line-height: 1;
}
.perf-metric-lbl {
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--text-muted);
    line-height: 1.3;
}
.perf-metric-sub {
    font-size: 9.5px;
    color: var(--text-muted);
    opacity: 0.7;
    margin-top: 1px;
}

/* ── Performance card: peak power row ────────────────────────────── */
.perf-peaks-section {
    margin-top: 14px;
    padding-top: 12px;
    border-top: 1px solid rgba(255,255,255,0.06);
}
.perf-peaks-label {
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--text-muted);
    margin-bottom: 8px;
}
.perf-peaks-row {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
}
.perf-peak-pill {
    flex: 1 1 0;
    min-width: 52px;
    background: rgba(0,229,160,0.07);
    border: 1px solid rgba(0,229,160,0.15);
    border-radius: 8px;
    padding: 7px 6px 6px;
    text-align: center;
}
.perf-peak-val {
    font-size: 15px;
    font-weight: 800;
    color: #00e5a0;
    line-height: 1.1;
}
.perf-peak-unit {
    font-size: 10px;
    font-weight: 600;
    color: rgba(0,229,160,0.65);
}
.perf-peak-dur {
    font-size: 9.5px;
    color: var(--text-muted);
    margin-top: 2px;
}

/* ── Activity detail: zones side-by-side row ──────────────────────── */
.detail-zones-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
}
.detail-zones-row--single {
    grid-template-columns: 1fr;
}
@media (max-width: 900px) {
    .detail-zones-row:not(.detail-zones-row--single) {
        grid-template-columns: 1fr;
    }
}

/* ── Activity detail: power zone table ────────────────────────────── */
.detail-zone-row {
    display: flex;
    align-items: center;
    gap: 7px;
    padding: 9px 0;
    border-bottom: 1px solid var(--border);
}
.detail-zone-row:last-child {
    border-bottom: none;
}
.detail-zone-tag {
    font-size: var(--text-xs);
    font-weight: 700;
    font-family: var(--font-num);
    min-width: 26px;
    letter-spacing: 0.03em;
}
.detail-zone-name {
    font-size: var(--text-sm);
    color: var(--text-muted);
    min-width: 72px;
}
.detail-zone-bar-track {
    flex: 1;
    height: 14px;
    background: rgba(255, 255, 255, 0.06);
    border-radius: 3px;
    overflow: hidden;
}
.detail-zone-bar-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}
.detail-zone-time {
    font-size: var(--text-xs);
    color: var(--text-secondary);
    font-family: var(--font-num);
    width: 46px;
    flex-shrink: 0;
    text-align: right;
}
.detail-zone-pct {
    font-size: var(--text-xs);
    font-weight: 600;
    font-family: var(--font-num);
    width: 36px;
    flex-shrink: 0;
    text-align: right;
}
@media (max-width: 480px) {
    .detail-zone-name {
        display: none;
    }
    .detail-zone-time {
        min-width: 44px;
        font-size: var(--text-xs);
    }
}

/* ── Activity streams combined chart ─────────────────────────────────────── */
.stream-toggles {
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
    justify-content: flex-end;
}
.stream-toggle-btn {
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 0.02em;
    padding: 3px 9px;
    border-radius: 999px;
    border: 1.5px solid var(--sc, var(--border));
    background: transparent;
    color: var(--sc, var(--text-muted));
    cursor: pointer;
    transition: opacity 0.15s, background 0.15s;
    opacity: 0.38;
    white-space: nowrap;
}
.stream-toggle-btn.active {
    opacity: 1;
    background: rgba(255,255,255,0.06);
}

.detail-charts-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 28px;
    color: var(--text-muted);
    font-size: var(--text-base);
}
.detail-charts-loading .spinner {
    width: 20px;
    height: 20px;
    border-width: 2px;
    flex-shrink: 0;
}

/* ============================================================
   ZONE DISTRIBUTION CARD
============================================================ */
.zone-total-badge {
    background: var(--accent-dim);
    color: var(--accent);
    border: 1px solid var(--accent-glow);
    border-radius: 20px;
    padding: 3px 12px;
    font-size: var(--text-xs);
    font-weight: 700;
    font-family: var(--font-num);
    white-space: nowrap;
    flex-shrink: 0;
}
.zone-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.zone-row {
    display: flex;
    align-items: center;
    gap: 7px;
}
.zone-tag {
    font-size: var(--text-2xs);
    font-weight: 800;
    letter-spacing: 0.04em;
    font-family: var(--font-num);
    width: 22px;
    flex-shrink: 0;
}
.zone-row-name {
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--text-secondary);
    width: 66px;
    flex-shrink: 0;
}
@media (max-width: 480px) {
    .zone-row-name { display: none; }
}
.zone-bar-track {
    flex: 1;
    height: 14px;
    background: var(--bg-elevated);
    border-radius: 3px;
    overflow: hidden;
}
.zone-bar-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.7s cubic-bezier(0.4, 0, 0.2, 1);
}
.zone-pct {
    font-size: var(--text-xs);
    font-weight: 700;
    width: 34px;
    text-align: right;
    font-family: var(--font-num);
    flex-shrink: 0;
}
.zone-time {
    font-size: var(--text-2xs);
    color: var(--text-muted);
    width: 54px;
    text-align: right;
    flex-shrink: 0;
}
/* Bottom balance section */
.zone-balance-section {
    margin-top: 18px;
    padding-top: 16px;
    border-top: 1px solid var(--border);
}
.zone-balance-label {
    font-size: var(--text-2xs);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.09em;
    color: var(--text-muted);
    margin-bottom: 8px;
}
.zone-balance-bar {
    display: flex;
    height: 12px;
    border-radius: 3px;
    overflow: hidden;
}
.zone-balance-seg {
    height: 100%;
    transition: width 0.7s cubic-bezier(0.4, 0, 0.2, 1);
}
.zone-style-hint {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 9px;
}
.zone-style-hint strong {
    color: var(--text-primary);
}

/* ============================================================
   POWER CURVE
============================================================ */
.curve-peaks {
    display: flex;
    gap: 6px;
    margin-bottom: 10px;
    flex-wrap: wrap;
}
.curve-peak {
    flex: 1;
    min-width: 60px;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 6px 8px;
    text-align: center;
}
.curve-peak-val {
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--accent);
    font-family: var(--font-num);
    line-height: 1;
}
.curve-peak-unit {
    font-size: var(--text-xs);
    font-weight: 500;
    margin-left: 1px;
    opacity: 0.7;
}
.curve-peak-dur {
    font-size: var(--text-2xs);
    color: var(--text-muted);
    margin-top: 3px;
    text-transform: uppercase;
    letter-spacing: 0.07em;
    font-family: var(--font-num);
}

/* Power curve comparison legend */
.curve-legend {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
}
.curve-legend-item {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 11px;
    color: var(--text-muted);
    white-space: nowrap;
}
.curve-legend-dot {
    width: 10px;
    height: 3px;
    border-radius: 2px;
    flex-shrink: 0;
}

/* ============================================================
   RESPONSIVE
============================================================ */
@media (max-width: 1100px) {
    .fitness-row {
        grid-template-columns: 1fr;
    }
}
@media (max-width: 900px) {
    .stream-charts {
        grid-template-columns: 1fr;
    }
    .cal-stats-strip .cal-hstat {
        padding: 6px 10px;
    }
    /* Tablet: keep cards but hide the name row to save space */
    .cal-day-card-name {
        display: none;
    }
    .cal-day-card {
        padding: 2px 4px 2px 5px;
    }
}
@media (max-width: 600px) {
    .cal-dow-row > div {
        font-size: var(--text-2xs);
        letter-spacing: 0;
    }
    .cal-month-title {
        min-width: 130px;
        font-size: var(--text-base);
    }
    .cal-day {
        padding: 5px 1px 4px;
    }
    .cal-day-num {
        width: 24px;
        height: 24px;
        font-size: var(--text-xs);
    }
    /* Mobile: swap to dot indicators, hide cards */
    .cal-day-cards { display: none; }
    .cal-dots       { display: flex; }
    .cal-dot {
        width: 4px;
        height: 4px;
    }
    .cal-day-panel-header {
        padding: 9px 14px 7px;
    }
    .cal-list-item {
        padding: 9px 14px;
    }
}
/* ── Backdrop: always in DOM, invisible + non-interactive when closed ── */
.sidebar-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.55);
    z-index: 1150;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.28s ease;
    visibility: hidden;
}
.sidebar-backdrop.open {
    opacity: 1;
    pointer-events: auto;
    visibility: visible;
}

/* ── Burger button (hidden on desktop) ── */
.burger-btn {
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 5px;
    width: 36px;
    height: 36px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px;
    border-radius: 8px;
    flex-shrink: 0;
    transition: background var(--transition);
    position: relative;
    z-index: 101;
}
.burger-btn:hover {
    background: var(--bg-elevated);
}
.burger-btn span {
    display: block;
    width: 20px;
    height: 2px;
    background: var(--text-secondary);
    border-radius: 2px;
    transition:
        transform 0.25s ease,
        opacity 0.2s ease;
}

/* Animate burger to X when sidebar is open */
.burger-btn.is-open span:nth-child(1) {
    transform: translateY(7px) rotate(45deg);
}
.burger-btn.is-open span:nth-child(2) {
    opacity: 0;
    transform: scaleX(0);
}
.burger-btn.is-open span:nth-child(3) {
    transform: translateY(-7px) rotate(-45deg);
}

@media (max-width: 700px) {
    :root {
        --sidebar-w: 0px;
    }
    /* Sidebar off-screen and non-interactive when closed */
    .sidebar {
        width: 220px;
        transform: translateX(-220px);
        z-index: 1200;
        pointer-events: none;
    }
    .sidebar.open {
        transform: translateX(0);
        pointer-events: auto;
    }
    /* Topbar spans full width on mobile since sidebar-w is 0 */
    .topbar {
        left: 0;
    }
    .main {
        margin-left: 0;
        min-height: 100svh;
        min-height: 100vh;
    }
    .cal-shell {
        left: 0;
    }
    .burger-btn {
        display: flex;
    }
    .stat-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

/* ============================================================
   WORKOUT BUILDER
============================================================ */

/* ---- Top bar ---- */
.wrk-topbar {
    display: flex;
    align-items: center;
    gap: 14px;
    margin-bottom: 14px;
    flex-wrap: wrap;
}
.wrk-name-input {
    flex: 1;
    min-width: 180px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    color: var(--text-primary);
    font-family: inherit;
    font-size: var(--text-lg);
    font-weight: 700;
    padding: 9px 14px;
    outline: none;
    transition: border-color var(--transition);
}
.wrk-name-input:focus {
    border-color: var(--accent);
}
.wrk-topbar-stats {
    display: flex;
    align-items: center;
    gap: 6px;
    flex-shrink: 0;
}
.wrk-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    line-height: 1.1;
}
.wrk-stat-val {
    font-size: var(--text-lg);
    font-weight: 700;
    font-family: var(--font-num);
    color: var(--text-primary);
}
.wrk-stat-lbl {
    font-size: var(--text-xs);
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.04em;
}
.wrk-stat-sep {
    color: var(--text-muted);
    font-size: 1rem;
    padding: 0 2px;
}
.wrk-clear-btn {
    flex-shrink: 0;
    font-size: var(--text-sm);
    padding: 7px 14px;
}

/* ---- Canvas chart ---- */
.wrk-chart-card {
    padding: 14px 16px 10px;
    position: relative;
    margin-bottom: 14px;
}
.wrk-canvas {
    display: block;
    width: 100%;
    height: 200px;
    border-radius: var(--radius);
}
.wrk-chart-empty {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--text-base);
    color: var(--text-muted);
    pointer-events: none;
}

/* ---- FTP override row ---- */
.wrk-ftp-row {
    display: flex;
    align-items: center;
    gap: 6px;
}
.wrk-ftp-label {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    white-space: nowrap;
}
.wrk-ftp-input {
    width: 72px;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    color: var(--text-primary);
    font-family: inherit;
    font-size: var(--text-base);
    padding: 5px 8px;
    outline: none;
    transition: border-color var(--transition);
}
.wrk-ftp-input:focus {
    border-color: var(--accent);
}
.wrk-ftp-unit {
    font-size: var(--text-sm);
    color: var(--text-muted);
}

/* ---- Segment list ---- */
.wrk-segment-list {
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin: 10px 0;
}
.wrk-list-empty {
    text-align: center;
    color: var(--text-muted);
    font-size: var(--text-base);
    padding: 24px 0;
}
.wrk-seg-wrap {
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    transition: border-color var(--transition);
}
.wrk-seg-wrap--active {
    border-color: var(--accent);
}
.wrk-seg-row {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 9px 12px;
    cursor: pointer;
    background: var(--bg-elevated);
    transition: background var(--transition);
}
.wrk-seg-row:hover {
    background: var(--bg-card);
}
.wrk-seg-swatch {
    width: 10px;
    height: 36px;
    border-radius: 4px;
    flex-shrink: 0;
}
.wrk-seg-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 2px;
    min-width: 0;
}
.wrk-seg-type {
    font-size: var(--text-base);
    font-weight: 600;
    color: var(--text-primary);
    text-transform: capitalize;
}
.wrk-seg-detail {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.wrk-seg-actions {
    display: flex;
    gap: 4px;
    flex-shrink: 0;
}
.wrk-icon-btn {
    width: 28px;
    height: 28px;
    border-radius: 6px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    color: var(--text-secondary);
    font-size: var(--text-base);
    display: flex;
    align-items: center;
    justify-content: center;
    transition:
        background var(--transition),
        color var(--transition);
    cursor: pointer;
}
.wrk-icon-btn:hover {
    background: var(--bg-elevated);
    color: var(--text-primary);
}
.wrk-icon-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
}
.wrk-icon-btn--del:hover {
    background: rgba(255, 71, 87, 0.15);
    color: var(--red);
    border-color: var(--red);
}

/* ---- Edit panel ---- */
.wrk-edit-panel {
    background: var(--bg-card);
    border-top: 1px solid var(--border);
    padding: 14px 14px 10px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.wrk-edit-row {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
}
.wrk-edit-row label {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    min-width: 80px;
    flex-shrink: 0;
}
.wrk-dur-inputs {
    display: flex;
    align-items: center;
    gap: 5px;
    flex: 1;
}
.wrk-dur-inputs input[type="number"] {
    width: 60px;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--text-primary);
    font-family: inherit;
    font-size: var(--text-base);
    padding: 5px 8px;
    outline: none;
    transition: border-color var(--transition);
}
.wrk-dur-inputs input[type="number"]:focus {
    border-color: var(--accent);
}
.wrk-dur-inputs span {
    font-size: var(--text-sm);
    color: var(--text-muted);
}
.wrk-power-input {
    display: flex;
    align-items: center;
    gap: 8px;
    flex: 1;
}
.wrk-power-input input[type="range"] {
    flex: 1;
    accent-color: var(--accent);
    min-width: 80px;
}
.wrk-power-badge {
    font-size: var(--text-sm);
    font-weight: 700;
    font-family: var(--font-num);
    padding: 3px 8px;
    border-radius: 20px;
    color: #fff;
    min-width: 48px;
    text-align: center;
    flex-shrink: 0;
}

/* ---- Add segment bar ---- */
.wrk-add-bar {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    padding: 12px 0 4px;
    border-top: 1px solid var(--border);
    margin-top: 6px;
}
.wrk-add-btn {
    font-size: var(--text-sm);
    padding: 6px 14px;
    border-radius: 20px;
    border: 1px solid var(--border);
    color: var(--text-secondary);
    transition:
        border-color var(--transition),
        color var(--transition),
        background var(--transition);
}
.wrk-add-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
    background: var(--accent-dim);
}

/* ---- Export card ---- */
.wrk-export-card {
    display: flex;
    align-items: center;
    gap: 16px;
    flex-wrap: wrap;
    margin-top: 14px;
}
.wrk-export-info {
    flex: 1;
    min-width: 0;
}
.wrk-export-title {
    font-size: var(--text-base);
    font-weight: 600;
    color: var(--text-primary);
}
.wrk-export-sub {
    font-size: var(--text-sm);
    color: var(--text-muted);
    margin-top: 3px;
    line-height: 1.5;
}
.wrk-export-btns {
    display: flex;
    gap: 8px;
    flex-shrink: 0;
    flex-wrap: wrap;
}
.wrk-export-btns .btn {
    font-size: var(--text-base);
    padding: 8px 18px;
}

/* ---- Responsive ---- */
@media (max-width: 600px) {
    .wrk-topbar {
        gap: 8px;
    }
    .wrk-topbar-stats {
        gap: 4px;
    }
    .wrk-export-card {
        flex-direction: column;
        align-items: flex-start;
    }
}

/* ============================================================
   YEAR FILTER DROPDOWN  (Activities page)
============================================================ */
.year-select {
    appearance: none;
    -webkit-appearance: none;
    background: var(--bg-elevated)
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%238891a8'/%3E%3C/svg%3E")
        no-repeat right 10px center;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    color: var(--text-secondary);
    font-family: inherit;
    font-size: var(--text-sm);
    font-weight: 500;
    padding: 6px 30px 6px 12px;
    cursor: pointer;
    outline: none;
    transition:
        border-color var(--transition),
        color var(--transition);
    flex-shrink: 0;
}
.year-select:hover {
    border-color: var(--border-active);
    color: var(--text-primary);
}
.year-select:focus {
    border-color: var(--accent);
    color: var(--text-primary);
}
.year-select option {
    background: var(--bg-elevated);
    color: var(--text-primary);
}

/* ============================================================
   WEEK PROGRESS CARD
============================================================ */
/* Week Progress header right side */
.wkp-header-right {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 8px;
}
.wkp-toggles {
    display: flex;
    gap: 4px;
}
.wkp-toggle-btn {
    font-size: var(--text-2xs);
    font-weight: 600;
    padding: 4px 10px;
    border-radius: 20px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--text-muted);
    cursor: pointer;
    transition:
        background var(--transition),
        color var(--transition),
        border-color var(--transition);
}
.wkp-toggle-btn:hover {
    background: var(--bg-elevated);
    color: var(--text-primary);
    border-color: var(--border-active);
}
.wkp-toggle-btn--active {
    background: var(--accent-dim);
    color: var(--accent);
    border-color: rgba(0, 229, 160, 0.3);
}

.wkp-body {
    display: flex;
    flex-direction: column;
    gap: 14px;
}
.wkp-chart {
    width: 100%;
    height: 190px;
}
.wkp-stats {
    display: flex;
    flex-direction: row;
    background: var(--bg-elevated);
    border-radius: var(--radius);
    border: 1px solid var(--border);
    overflow: hidden;
}
.wkp-stat {
    padding: 12px 16px;
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
}
.wkp-divider {
    width: 1px;
    height: auto;
    background: var(--border);
    flex-shrink: 0;
}
.wkp-stat-label {
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    margin-bottom: 5px;
}
.wkp-stat-val {
    font-family: var(--font-num);
    font-size: 1.65rem;
    font-weight: 700;
    line-height: 1;
    color: var(--text-primary);
    font-variant-numeric: tabular-nums;
    margin-bottom: 4px;
}
.wkp-stat-delta {
    font-family: var(--font-num);
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--accent);
}
.wkp-stat-sub {
    font-size: var(--text-xs);
    color: var(--text-muted);
}
.wkp-ctl-delta {
    font-family: var(--font-num);
    font-size: var(--text-lg);
    font-weight: 700;
    line-height: 1.2;
    color: var(--text-primary);
    margin-bottom: 7px;
    font-variant-numeric: tabular-nums;
}
.wkp-badge {
    display: inline-block;
    font-size: var(--text-xs);
    font-weight: 700;
    padding: 3px 9px;
    border-radius: 20px;
    letter-spacing: 0.03em;
}
.wkp-badge--up {
    background: rgba(0, 229, 160, 0.15);
    color: var(--accent);
}
.wkp-badge--down {
    background: rgba(255, 71, 87, 0.15);
    color: var(--red);
}
.wkp-badge--flat {
    background: rgba(74, 158, 255, 0.12);
    color: var(--blue);
}

@media (max-width: 600px) {
    .wkp-stat-val {
        font-size: 1.25rem;
    }
    .wkp-ctl-delta {
        font-size: var(--text-base);
    }
}

/* ============================================================
   TRAINING STATUS CARD
============================================================ */
#trainingStatusCard {
    display: flex;
    flex-direction: column;
}
.trs-body {
    display: flex;
    flex-direction: column;
    gap: 14px;
    flex: 1;
}
/* Top row: ramp gauge (left) + form status (right) */
.trs-top-row {
    display: flex;
    gap: 14px;
    align-items: stretch;
}
.trs-ramp-wrap {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
}
.trs-form-wrap {
    flex: 1;
    min-width: 0;
    container-type: inline-size;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 14px 16px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 4px;
}
.trs-fitness-row {
    display: flex;
    align-items: flex-start;
    gap: 0;
}
.trs-fitness-metric {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 2px;
}
.trs-fitness-div {
    width: 1px;
    height: 48px;
    background: var(--border);
    margin: 0 14px;
    align-self: center;
    flex-shrink: 0;
}
.trs-metric-label {
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    margin-bottom: 2px;
    align-self: flex-start;
    width: 100%;
}
/* Ramp gauge SVG */
.trs-gauge-container {
    position: relative;
    width: 100%;
    max-width: 200px;
    container-type: inline-size;
}
.trs-gauge-svg {
    width: 100%;
    display: block;
}
.trs-gauge-overlay {
    position: absolute;
    bottom: 6%;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    pointer-events: none;
    white-space: nowrap;
    width: 100%;
}
.trs-gauge-num {
    font-family: var(--font-num);
    font-size: clamp(1.1rem, 12cqw, 2rem);
    font-weight: 700;
    line-height: 1;
    color: var(--text-primary);
    font-variant-numeric: tabular-nums;
}
.trs-gauge-unit {
    font-size: clamp(0.55rem, 3cqw, var(--text-2xs));
    color: var(--text-muted);
    margin-top: 2px;
    letter-spacing: 0.04em;
}
/* Reusable badge used for ramp zone labels */
.trs-badge {
    display: inline-block;
    font-size: var(--text-xs);
    font-weight: 700;
    padding: 3px 9px;
    border-radius: 20px;
    letter-spacing: 0.03em;
    margin-top: 6px;
}
.trs-badge--green {
    background: rgba(0, 229, 160, 0.15);
    color: var(--accent);
}
.trs-badge--green-dim {
    background: rgba(136, 200, 96, 0.12);
    color: #88c860;
}
.trs-badge--yellow {
    background: rgba(240, 196, 41, 0.15);
    color: var(--yellow);
}
.trs-badge--red {
    background: rgba(255, 71, 87, 0.15);
    color: var(--red);
}
.trs-badge--blue {
    background: rgba(74, 158, 255, 0.15);
    color: var(--blue);
}
/* Form/TSB values */
.trs-form-num {
    font-family: var(--font-num);
    font-size: clamp(1.6rem, 6cqw, 2.8rem);
    font-weight: 700;
    line-height: 1;
    font-variant-numeric: tabular-nums;
    margin: 2px 0 4px;
}
.trs-form-status {
    display: inline-block;
    font-size: var(--text-sm);
    font-weight: 700;
    padding: 4px 12px;
    border-radius: 20px;
    letter-spacing: 0.02em;
    margin-top: 2px;
}
.trs-form-hint {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 2px;
}
/* Aerobic Efficiency sparkline section */
.trs-ef-wrap {
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 12px 0 0;
    overflow: hidden;
    margin-top: auto;
}
.trs-ef-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
    padding: 0 14px;
}
.trs-ef-nums {
    display: flex;
    align-items: baseline;
    gap: 8px;
    flex-shrink: 0;
}
#trsEFCurrent {
    font-size: var(--text-base);
    font-weight: 700;
    color: var(--text-primary);
    font-variant-numeric: tabular-nums;
}
#trsEFDelta {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--accent);
}
.trs-ef-chart-area {
    height: 96px;
}
.trs-ef-footer {
    display: none;
}

@media (max-width: 600px) {
    .trs-top-row {
        flex-direction: column;
    }
    .trs-form-num {
        font-size: 1.8rem;
    }
}

/* Note shown below the activities list for placeholder/no-data entries */
.act-empty-note {
    text-align: center;
    font-size: var(--text-sm);
    color: var(--text-muted);
    padding: 10px 16px 6px;
    letter-spacing: 0.01em;
}

/* ============================================================
   TRAINING GUIDE PAGE
============================================================ */
.guide-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--gap-layout);
    align-items: start;
}

/* Intro banner spans full width */
.guide-intro-card {
    grid-column: 1 / -1;
    display: flex;
    align-items: flex-start;
    gap: 16px;
}
.guide-intro-icon {
    flex-shrink: 0;
    width: 44px;
    height: 44px;
    border-radius: 12px;
    background: var(--accent-dim);
    color: var(--accent);
    display: flex;
    align-items: center;
    justify-content: center;
}
.guide-intro-icon svg { width: 22px; height: 22px; }
.guide-intro-title {
    font-size: var(--text-lg);
    font-weight: 700;
    margin-bottom: 6px;
}
.guide-intro-sub {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    line-height: 1.6;
}

/* Individual metric cards */
.guide-metric-card {
    display: flex;
    flex-direction: column;
    gap: 14px;
}
.guide-metric-header {
    display: flex;
    align-items: center;
    gap: 14px;
}
.guide-metric-badge {
    font-family: var(--font-num);
    font-size: var(--text-lg);
    font-weight: 700;
    padding: 6px 14px;
    border-radius: 10px;
    letter-spacing: -0.5px;
    flex-shrink: 0;
}
.guide-metric-name {
    font-size: var(--text-base);
    font-weight: 700;
}
.guide-metric-aka {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 2px;
    text-transform: uppercase;
    letter-spacing: 0.06em;
}
.guide-metric-desc {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    line-height: 1.65;
}

/* Zone bars */
.guide-zones {
    display: flex;
    flex-direction: column;
    gap: 7px;
    background: var(--bg-elevated);
    border-radius: var(--radius);
    padding: 12px;
}
.guide-zone-row {
    display: grid;
    grid-template-columns: 64px minmax(80px, max-content) 1fr;
    align-items: center;
    gap: 10px;
}
.guide-zone-bar {
    height: 8px;
    border-radius: 2px;
    max-width: 100%;
}
.guide-zone-label {
    font-family: var(--font-num);
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--text-primary);
    white-space: nowrap;
}
.guide-zone-desc {
    font-size: var(--text-xs);
    color: var(--text-muted);
}

/* Tip row */
.guide-tip {
    font-size: var(--text-xs);
    color: var(--text-secondary);
    background: var(--bg-elevated);
    border-left: 3px solid var(--accent);
    border-radius: 0 var(--radius) var(--radius) 0;
    padding: 8px 12px;
    line-height: 1.5;
}

/* Quick reference card spans full width */
.guide-ref-card {
    grid-column: 1 / -1;
}
.guide-ref-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--gap-layout);
    margin-top: 4px;
}
.guide-ref-item {
    background: var(--bg-elevated);
    border-radius: var(--radius);
    padding: 12px 14px;
}
.guide-ref-label {
    font-size: var(--text-sm);
    font-weight: 600;
    margin-bottom: 5px;
}
.guide-ref-val {
    font-size: var(--text-xs);
    color: var(--text-secondary);
    line-height: 1.5;
}

@media (max-width: 700px) {
    .guide-grid {
        grid-template-columns: 1fr;
    }
    .guide-ref-grid {
        grid-template-columns: 1fr;
    }
}

/* ============================================================
   FITNESS PAGE — ZONE DISTRIBUTION CARD
============================================================ */
.fit-zone-tabs {
    display: flex;
    gap: 4px;
}
.fit-zone-tab {
    font-size: var(--text-xs);
    font-weight: 600;
    padding: 4px 10px;
    border-radius: 20px;
    border: 1px solid var(--border);
    color: var(--text-muted);
    background: none;
    cursor: pointer;
    transition: all var(--transition);
}
.fit-zone-tab.active,
.fit-zone-tab:hover {
    background: var(--accent-dim);
    border-color: var(--accent);
    color: var(--accent);
}

/* KPI strip */
.fit-zone-kpis {
    display: flex;
    gap: 0;
    margin-bottom: 16px;
    background: var(--bg-elevated);
    border-radius: var(--radius);
    overflow: hidden;
}
.fit-zone-kpi {
    flex: 1;
    padding: 10px 14px;
    border-right: 1px solid var(--border);
}
.fit-zone-kpi:last-child { border-right: none; }
.fit-zone-kpi-val {
    font-size: var(--text-md);
    font-weight: 700;
    line-height: 1;
    margin-bottom: 3px;
}
.fit-zone-kpi-lbl {
    font-size: var(--text-2xs);
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.07em;
}

/* Chart + rows layout */
.fit-zone-body {
    display: flex;
    gap: 20px;
    align-items: center;
    margin-bottom: 16px;
}
.fit-zone-chart-wrap {
    position: relative;
    flex-shrink: 0;
    width: 160px;
    height: 160px;
    container-type: inline-size;
}
.fit-zone-pie-center {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    pointer-events: none;
}
.fit-zone-pie-pct {
    font-size: 1.6rem;
    font-weight: 800;
    line-height: 1;
}
.fit-zone-pie-lbl {
    font-size: var(--text-xs);
    color: var(--text-muted);
    font-weight: 600;
    margin-top: 2px;
    text-transform: uppercase;
    letter-spacing: 0.06em;
}

/* Zone rows */
.fit-zone-rows {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 9px;
}
.fit-zone-row {
    display: flex;
    align-items: center;
    gap: 7px;
}
.fit-zone-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
}
.fit-zone-row-info {
    flex: 1;
    min-width: 0;
}
.fit-zone-row-top {
    display: flex;
    align-items: baseline;
    gap: 6px;
    margin-bottom: 4px;
}
.fit-zone-tag {
    font-size: var(--text-xs);
    font-weight: 700;
}
.fit-zone-name {
    font-size: var(--text-xs);
    color: var(--text-secondary);
}
@media (max-width: 480px) {
    .fit-zone-name { display: none; }
}
.fit-zone-watts {
    font-size: var(--text-2xs);
    color: var(--text-muted);
    margin-left: auto;
}
.fit-zone-bar-track {
    height: 12px;
    background: var(--bg-elevated);
    border-radius: 3px;
    overflow: hidden;
}
.fit-zone-bar-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}
.fit-zone-row-stats {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 1px;
    flex-shrink: 0;
    min-width: 44px;
}
.fit-zone-pct {
    font-size: var(--text-sm);
    font-weight: 700;
}
.fit-zone-time {
    font-size: var(--text-2xs);
    color: var(--text-muted);
}

/* Balance bar + style label */
.fit-zone-balance {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 4px;
}
.fit-zone-balance-label {
    display: flex;
    align-items: center;
    gap: 8px;
}
.fit-zone-style-tag {
    font-size: var(--text-xs);
    font-weight: 700;
    padding: 3px 10px;
    border-radius: 20px;
    flex-shrink: 0;
}
.fit-zone-style-hint {
    font-size: var(--text-xs);
    color: var(--text-muted);
}

@media (max-width: 600px) {
    .fit-zone-body { flex-direction: column; align-items: stretch; }
    .fit-zone-chart-wrap { width: 140px; height: 140px; align-self: center; }
    .fit-zone-kpis { flex-wrap: wrap; }
    .fit-zone-kpi { flex: 1 1 33%; }
}
