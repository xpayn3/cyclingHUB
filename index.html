<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, viewport-fit=cover"
        />
        <title>CycleIQ — Training Dashboard</title>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
            rel="stylesheet"
        />
        <link rel="stylesheet" href="styles.css" />
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
        <script src="app.js" defer></script>
    </head>
    <body>
        <!-- ============================================================  CONNECT MODAL  ============================================================ -->
        <div class="modal-backdrop" id="connectModal">
            <div class="modal">
                <div class="modal-header">
                    <div>
                        <div class="modal-header-icon">
                            <svg
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                            >
                                <path
                                    d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"
                                />
                                <path
                                    d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"
                                />
                            </svg>
                        </div>
                        <div class="modal-title">Connect to intervals.icu</div>
                        <div class="modal-desc">
                            Enter your Athlete ID and API key to sync your
                            training data.
                        </div>
                    </div>
                    <button
                        class="modal-close"
                        id="modalCloseBtn"
                        onclick="closeModal()"
                    >
                        <svg
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2.5"
                        >
                            <line x1="18" y1="6" x2="6" y2="18" />
                            <line x1="6" y1="6" x2="18" y2="18" />
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="callout">
                        <strong>How to find your credentials:</strong>
                        <ol>
                            <li>
                                Go to
                                <a href="https://intervals.icu" target="_blank"
                                    >intervals.icu</a
                                >
                                → Settings → API
                            </li>
                            <li>
                                Copy your <strong>Athlete ID</strong> (starts
                                with <code>i</code>, e.g. <code>i12345</code>)
                            </li>
                            <li>
                                Click <strong>Show API Key</strong> and copy it
                            </li>
                        </ol>
                    </div>

                    <div class="field">
                        <label for="inputAthleteId">Athlete ID</label>
                        <input
                            type="text"
                            id="inputAthleteId"
                            placeholder="e.g. i12345"
                            autocomplete="off"
                        />
                        <div class="field-hint">
                            Your profile ID from intervals.icu (visible in the
                            URL)
                        </div>
                        <div class="field-error" id="errAthleteId">
                            Please enter your Athlete ID
                        </div>
                    </div>

                    <div class="field">
                        <label for="inputApiKey">API Key</label>
                        <div class="input-with-toggle">
                            <input
                                type="password"
                                id="inputApiKey"
                                placeholder="Paste your API key here"
                                autocomplete="off"
                            />
                            <button
                                class="toggle-visibility"
                                onclick="toggleApiKeyVisibility()"
                                id="apiKeyToggle"
                                title="Show/hide API key"
                            >
                                <svg
                                    id="eyeIcon"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                >
                                    <path
                                        d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"
                                    />
                                    <circle cx="12" cy="12" r="3" />
                                </svg>
                            </button>
                        </div>
                        <div class="field-hint">
                            Found in intervals.icu → Settings → API → Show API
                            Key. Stored only in your browser.
                        </div>
                        <div class="field-error" id="errApiKey">
                            Please enter your API key
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button class="btn btn-ghost" onclick="closeModal()">
                            Cancel
                        </button>
                        <button
                            class="btn btn-primary"
                            id="connectBtn"
                            onclick="handleConnect()"
                        >
                            <svg
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2.5"
                            >
                                <polyline points="20 6 9 17 4 12" />
                            </svg>
                            Connect &amp; Sync
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================================  SIDEBAR  ============================================================ -->
        <div
            class="sidebar-backdrop"
            id="sidebarBackdrop"
            onclick="closeSidebar()"
        ></div>
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-logo">
                <div class="logo-icon">
                    <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="#0d0f14"
                        stroke-width="2.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <circle cx="12" cy="12" r="9" />
                        <circle cx="12" cy="12" r="2" />
                        <line x1="12" y1="3" x2="12" y2="10" />
                        <line x1="12" y1="14" x2="12" y2="21" />
                        <line x1="3" y1="12" x2="10" y2="12" />
                        <line x1="14" y1="12" x2="21" y2="12" />
                    </svg>
                </div>
                <div class="logo-text">Cycle<span>IQ</span></div>
            </div>
            <nav class="sidebar-nav">
                <span class="nav-section-label">Training</span>
                <div
                    class="nav-item active"
                    data-page="dashboard"
                    onclick="
                        navigate('dashboard');
                        closeSidebar();
                    "
                >
                    <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <rect x="3" y="3" width="7" height="7" />
                        <rect x="14" y="3" width="7" height="7" />
                        <rect x="14" y="14" width="7" height="7" />
                        <rect x="3" y="14" width="7" height="7" />
                    </svg>
                    Dashboard
                </div>
                <div
                    class="nav-item"
                    data-page="activities"
                    onclick="
                        navigate('activities');
                        closeSidebar();
                    "
                >
                    <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
                    </svg>
                    Activities
                </div>
                <div
                    class="nav-item"
                    data-page="calendar"
                    onclick="
                        navigate('calendar');
                        closeSidebar();
                    "
                >
                    <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <rect x="3" y="4" width="18" height="18" rx="2" />
                        <line x1="16" y1="2" x2="16" y2="6" />
                        <line x1="8" y1="2" x2="8" y2="6" />
                        <line x1="3" y1="10" x2="21" y2="10" />
                    </svg>
                    Calendar
                </div>
                <div
                    class="nav-item"
                    data-page="fitness"
                    onclick="
                        navigate('fitness');
                        closeSidebar();
                    "
                >
                    <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
                    </svg>
                    Fitness
                    <span class="badge">CTL</span>
                </div>
                <span class="nav-section-label">Analysis</span>
                <div
                    class="nav-item"
                    data-page="power"
                    onclick="
                        navigate('power');
                        closeSidebar();
                    "
                >
                    <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <polygon
                            points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"
                        />
                    </svg>
                    Power Curve
                </div>
                <div
                    class="nav-item"
                    data-page="zones"
                    onclick="
                        navigate('zones');
                        closeSidebar();
                    "
                >
                    <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <circle cx="12" cy="12" r="10" />
                        <path d="M12 8v4l3 3" />
                    </svg>
                    Zones
                </div>
                <span class="nav-section-label">Tools</span>
                <div class="nav-item" data-page="workout" onclick="navigate('workout');closeSidebar();">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/>
                    </svg>
                    Create Workout
                </div>
                <span class="nav-section-label">Account</span>
                <div
                    class="nav-item"
                    data-page="settings"
                    onclick="
                        navigate('settings');
                        closeSidebar();
                    "
                >
                    <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <circle cx="12" cy="12" r="3" />
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"
                        />
                    </svg>
                    Settings
                </div>
            </nav>
            <div class="sidebar-footer">
                <div
                    class="athlete-chip"
                    onclick="openModal()"
                    title="Manage connection"
                >
                    <div class="athlete-avatar" id="athleteAvatar">?</div>
                    <div class="athlete-info">
                        <div class="athlete-name" id="athleteName">
                            Not connected
                        </div>
                        <div class="athlete-sub" id="athleteSub">
                            Click to connect
                        </div>
                    </div>
                    <div
                        class="connection-dot disconnected"
                        id="connectionDot"
                    ></div>
                </div>
                <div class="sidebar-actions">
                    <button class="btn btn-ghost sidebar-action-btn" id="syncBtn" onclick="syncData()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="23 4 23 10 17 10"/>
                            <path d="M20.49 15a9 9 0 1 1-.08-8.58"/>
                        </svg>
                        Sync
                    </button>
                    <button class="btn btn-primary sidebar-action-btn" onclick="openModal()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                        </svg>
                        <span id="connectBtnLabel">Connect</span>
                    </button>
                </div>
            </div>
        </aside>

        <!-- ============================================================  MAIN  ============================================================ -->
        <main class="main">
            <header class="topbar">
                <button
                    class="burger-btn"
                    id="burgerBtn"
                    onclick="toggleSidebar()"
                    aria-label="Menu"
                >
                    <span></span><span></span><span></span>
                </button>
                <div class="topbar-actions">
                    <div class="date-range-pill" id="dateRangePill">
                        <button onclick="setRange(7)"   id="range7">7d</button>
                        <button onclick="setRange(30)"  id="range30" class="active">30d</button>
                        <button onclick="setRange(90)"  id="range90">90d</button>
                        <button onclick="setRange(365)" id="range365">1y</button>
                    </div>
                </div>
            </header>

            <div class="page-content" id="pageContent">
                <!-- ── Page headline ── -->
                <div class="page-headline">
                    <div class="page-headline-title" id="pageTitle">
                        Dashboard
                    </div>
                    <div class="page-headline-sub" id="pageSubtitle">
                        Overview · Last 30 days
                    </div>
                </div>

                <!-- ==================== DASHBOARD ==================== -->
                <div class="page active" id="page-dashboard">
                    <div class="stat-grid-label">This week <span id="statGridWeekRange"></span></div>
                    <div class="stat-grid">
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-label">Training Load</div>
                                <div class="stat-icon green">
                                    <svg
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                    >
                                        <polygon
                                            points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"
                                        />
                                    </svg>
                                </div>
                            </div>
                            <div class="stat-value" id="statTSS">
                                —<span class="unit"> tss</span>
                            </div>
                            <div class="stat-delta neutral" id="statTSSDelta">
                                Sync to load
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-label">Distance</div>
                                <div class="stat-icon blue">
                                    <svg
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                    >
                                        <path
                                            d="M3 12h18M3 6l9-3 9 3M3 18l9 3 9-3"
                                        />
                                    </svg>
                                </div>
                            </div>
                            <div class="stat-value" id="statDist">
                                —<span class="unit"> km</span>
                            </div>
                            <div class="stat-delta neutral" id="statDistDelta">
                                Sync to load
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-label">Ride Time</div>
                                <div class="stat-icon orange">
                                    <svg
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                    >
                                        <circle cx="12" cy="12" r="10" />
                                        <polyline points="12 6 12 12 16 14" />
                                    </svg>
                                </div>
                            </div>
                            <div class="stat-value" id="statTime">
                                —<span class="unit"> h</span>
                            </div>
                            <div class="stat-delta neutral" id="statTimeDelta">
                                Sync to load
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-label">Elevation</div>
                                <div class="stat-icon purple">
                                    <svg
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                    >
                                        <polyline
                                            points="22 12 18 12 15 21 9 3 6 12 2 12"
                                        />
                                    </svg>
                                </div>
                            </div>
                            <div class="stat-value" id="statElev">
                                —<span class="unit"> m</span>
                            </div>
                            <div class="stat-delta neutral" id="statElevDelta">
                                Sync to load
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-label">Rides</div>
                                <div class="stat-icon green">
                                    <svg
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                    >
                                        <polyline
                                            points="22 12 18 12 15 21 9 3 6 12 2 12"
                                        />
                                    </svg>
                                </div>
                            </div>
                            <div class="stat-value" id="statCount">—</div>
                            <div class="stat-delta neutral" id="statCountDelta">
                                Sync to load
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-label">Avg Power</div>
                                <div class="stat-icon orange">
                                    <svg
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                    >
                                        <polygon
                                            points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"
                                        />
                                    </svg>
                                </div>
                            </div>
                            <div class="stat-value" id="statPower">
                                —<span class="unit"> w</span>
                            </div>
                            <div class="stat-delta neutral" id="statPowerDelta">
                                Sync to load
                            </div>
                        </div>
                    </div>

                    <!-- ── Week Progress + Training Status (side by side) ── -->
                    <div class="card-row">

                        <div class="card" id="weekProgressCard">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">Week Progress</div>
                                    <div class="card-subtitle" id="wpSubtitle">Training Load · Mon → Sun</div>
                                </div>
                                <div class="wkp-header-right">
                                    <div class="wkp-toggles">
                                        <button class="wkp-toggle-btn wkp-toggle-btn--active" data-metric="tss"      onclick="renderWeekProgress('tss')">Load</button>
                                        <button class="wkp-toggle-btn"                         data-metric="distance" onclick="renderWeekProgress('distance')">Distance</button>
                                        <button class="wkp-toggle-btn"                         data-metric="time"     onclick="renderWeekProgress('time')">Time</button>
                                        <button class="wkp-toggle-btn"                         data-metric="elevation" onclick="renderWeekProgress('elevation')">Elevation</button>
                                    </div>
                                    <div class="chart-legend">
                                        <span class="chart-legend-item"><span class="chart-legend-dot" style="background:var(--accent)"></span>This week</span>
                                        <span class="chart-legend-item"><span class="chart-legend-dot" style="background:rgba(136,145,168,0.5)"></span>Last week</span>
                                    </div>
                                </div>
                            </div>
                            <div class="wkp-body">
                                <div class="wkp-chart">
                                    <canvas id="weekProgressChart"></canvas>
                                </div>
                                <div class="wkp-stats">
                                    <div class="wkp-stat">
                                        <div class="wkp-stat-label">This week</div>
                                        <div class="wkp-stat-val" id="wpThisWeek">—</div>
                                        <div class="wkp-stat-delta" id="wpDelta">—</div>
                                    </div>
                                    <div class="wkp-divider"></div>
                                    <div class="wkp-stat">
                                        <div class="wkp-stat-label">Last week</div>
                                        <div class="wkp-stat-val" id="wpLastWeek">—</div>
                                        <div class="wkp-stat-sub" id="wpUnit">TSS</div>
                                    </div>
                                    <div class="wkp-divider"></div>
                                    <div class="wkp-stat">
                                        <div class="wkp-stat-label">Fitness trend</div>
                                        <div class="wkp-ctl-delta" id="wpCTLDelta">—</div>
                                        <div class="wkp-badge" id="wpTrendBadge">—</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Training Status card -->
                        <div class="card" id="trainingStatusCard">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">Training Status</div>
                                    <div class="card-subtitle">Pro fitness indicators</div>
                                </div>
                            </div>
                            <div class="trs-body">
                                <!-- Top: Ramp Rate gauge + CTL / ATL / TSB -->
                                <div class="trs-top-row">
                                    <div class="trs-ramp-wrap">
                                        <div class="trs-metric-label">Ramp Rate</div>
                                        <div class="trs-gauge-container">
                                            <svg id="rampGaugeSVG" viewBox="0 0 200 116" class="trs-gauge-svg"></svg>
                                            <div class="trs-gauge-overlay">
                                                <div class="trs-gauge-num" id="rampNum">—</div>
                                                <div class="trs-gauge-unit">CTL / wk</div>
                                            </div>
                                        </div>
                                        <div id="rampBadge" class="trs-badge">—</div>
                                    </div>
                                    <div class="trs-form-wrap">
                                        <div class="trs-fitness-row">
                                            <div class="trs-fitness-metric">
                                                <div class="trs-metric-label">Fitness / CTL</div>
                                                <div class="trs-form-num" id="trsCTLNum">—</div>
                                            </div>
                                            <div class="trs-fitness-div"></div>
                                            <div class="trs-fitness-metric">
                                                <div class="trs-metric-label">Fatigue / ATL</div>
                                                <div class="trs-form-num" id="trsATLNum">—</div>
                                            </div>
                                            <div class="trs-fitness-div"></div>
                                            <div class="trs-fitness-metric">
                                                <div class="trs-metric-label">Form / TSB</div>
                                                <div class="trs-form-num" id="trsFormNum">—</div>
                                            </div>
                                        </div>
                                        <div class="trs-form-status" id="trsFormStatus">—</div>
                                        <div class="trs-form-hint" id="trsFormHint">—</div>
                                    </div>
                                </div>
                                <!-- Bottom: Aerobic Efficiency sparkline -->
                                <div class="trs-ef-wrap">
                                    <div class="trs-ef-header">
                                        <div class="trs-metric-label">Aerobic Efficiency · NP ÷ HR</div>
                                        <div class="trs-ef-nums">
                                            <span id="trsEFCurrent">—</span>
                                            <span id="trsEFDelta">—</span>
                                        </div>
                                    </div>
                                    <div class="trs-ef-chart-area">
                                        <canvas id="trsEFChart"></canvas>
                                    </div>
                                    <div class="trs-ef-footer">Last 10 qualifying rides with power + HR · higher = more efficient</div>
                                </div>
                            </div>
                        </div>

                    </div><!-- /card-row week+status -->

                    <!-- Training Load chart -->
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Training Load</div>
                                <div class="card-subtitle">CTL (Fitness) · ATL (Fatigue) · TSB (Form)</div>
                            </div>
                            <div class="card-header-controls">
                                <div class="chart-legend">
                                    <span class="chart-legend-item"><span class="chart-legend-dot" style="background:var(--accent)"></span>CTL</span>
                                    <span class="chart-legend-item"><span class="chart-legend-dot" style="background:var(--orange)"></span>ATL</span>
                                    <span class="chart-legend-item"><span class="chart-legend-dot" style="background:var(--blue)"></span>TSB</span>
                                </div>
                                <span class="fitness-range-label" id="fitnessRangeLabel">Last 30 days</span>
                            </div>
                        </div>
                        <div class="chart-wrap chart-wrap--fitness">
                            <canvas id="fitnessChart"></canvas>
                        </div>
                    </div>

                    <!-- Average Power + Zone Distribution side by side -->
                    <div class="card-row">
                        <div class="card" id="avgPowerCard">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">Average Power</div>
                                    <div class="card-subtitle">
                                        Per ride · 7-ride trend
                                    </div>
                                </div>
                                <div class="chart-legend">
                                    <span class="chart-legend-item"
                                        ><span class="chart-legend-dot" style="background:var(--accent)"></span>Trend</span>
                                </div>
                            </div>
                            <div class="chart-wrap">
                                <canvas id="avgPowerChart"></canvas>
                            </div>
                        </div>

                        <div class="card" id="zoneDistCard" style="display:none">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">Zone Distribution</div>
                                    <div class="card-subtitle" id="zoneDistSubtitle">Time in power zone</div>
                                </div>
                                <div class="zone-total-badge" id="zoneTotalBadge"></div>
                            </div>
                            <div class="zone-list" id="zoneList"></div>
                            <div class="zone-balance-section" id="zoneBalanceSection" style="display:none"></div>
                        </div>
                    </div>

                    <!-- Power Curve -->
                    <div class="card" id="powerCurveCard" style="display:none">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Power Curve</div>
                                <div class="card-subtitle" id="powerCurveSubtitle">Best power efforts</div>
                            </div>
                        </div>
                        <div class="curve-peaks" id="curvePeaks"></div>
                        <div class="chart-wrap chart-wrap--lg">
                            <canvas id="powerCurveChart"></canvas>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Recent Activities</div>
                                <div
                                    class="card-subtitle"
                                    id="activitiesSubtitle"
                                >
                                    Last 30 days
                                </div>
                            </div>
                            <button
                                class="btn btn-ghost"
                                onclick="navigate('activities')"
                            >
                                View all →
                            </button>
                        </div>
                        <div class="activity-list" id="activityList">
                            <div class="empty-state">
                                <svg
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="1.5"
                                >
                                    <polyline
                                        points="22 12 18 12 15 21 9 3 6 12 2 12"
                                    />
                                </svg>
                                <p>
                                    No activities yet.<br />Connect your
                                    intervals.icu account and sync.
                                </p>
                                <button
                                    class="btn btn-primary"
                                    onclick="openModal()"
                                >
                                    Connect intervals.icu
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ==================== ACTIVITIES PAGE ==================== -->
                <div class="page" id="page-activities">
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">All Activities</div>
                                <div class="card-subtitle" id="allActivitiesSubtitle">—</div>
                            </div>
                            <select class="year-select" id="activitiesYearSelect" onchange="setActivitiesYear(this.value)">
                                <option value="all">All years</option>
                            </select>
                        </div>
                        <div class="sort-bar">
                            <span class="sort-label">Sort</span>
                            <button class="sort-btn active" data-sort="date"      onclick="setActivitiesSort('date')">Date<span class="sort-arrow"> ↓</span></button>
                            <button class="sort-btn"        data-sort="distance"  onclick="setActivitiesSort('distance')">Distance<span class="sort-arrow"></span></button>
                            <button class="sort-btn"        data-sort="time"      onclick="setActivitiesSort('time')">Time<span class="sort-arrow"></span></button>
                            <button class="sort-btn"        data-sort="elevation" onclick="setActivitiesSort('elevation')">Elevation<span class="sort-arrow"></span></button>
                            <button class="sort-btn"        data-sort="power"     onclick="setActivitiesSort('power')">Power<span class="sort-arrow"></span></button>
                            <button class="sort-btn"        data-sort="bpm"       onclick="setActivitiesSort('bpm')">BPM<span class="sort-arrow"></span></button>
                        </div>
                        <div class="activity-list" id="allActivityList">
                            <div class="empty-state">
                                <svg
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="1.5"
                                >
                                    <polyline
                                        points="22 12 18 12 15 21 9 3 6 12 2 12"
                                    />
                                </svg>
                                <p>Sync data to view all activities.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ==================== ACTIVITY DETAIL PAGE ==================== -->
                <div class="page" id="page-activity">

                    <!-- Back nav + prev/next -->
                    <div class="detail-back">
                        <button class="btn btn-ghost" onclick="navigateBack()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
                            Back to <span id="detailBackLabel">Activities</span>
                        </button>
                        <div class="detail-nav-arrows">
                            <span class="detail-nav-counter" id="detailNavCounter"></span>
                            <button class="btn btn-ghost detail-nav-btn" id="detailNavPrev" onclick="stepActivity(-1)" title="Previous" disabled>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" width="16" height="16"><polyline points="15 18 9 12 15 6"/></svg>
                            </button>
                            <button class="btn btn-ghost detail-nav-btn" id="detailNavNext" onclick="stepActivity(1)" title="Next" disabled>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" width="16" height="16"><polyline points="9 18 15 12 9 6"/></svg>
                            </button>
                        </div>
                    </div>

                    <!-- Hero -->
                    <div class="adh">
                        <div class="activity-type-icon lg" id="detailIcon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
                        </div>
                        <div class="adh-body">
                            <div class="adh-name" id="detailName">Activity</div>
                            <div class="adh-meta">
                                <span id="detailDate"></span>
                                <span class="adh-sport" id="detailType"></span>
                            </div>
                        </div>
                        <div class="adh-tss" id="detailTSSBadge" style="display:none"></div>
                    </div>

                    <!-- Metrics strip -->
                    <div class="metrics-strip" id="detailMetrics"></div>

                    <!-- Loading -->
                    <div class="detail-charts-loading" id="detailChartsLoading" style="display:none">
                        <div class="spinner"></div>Loading chart data…
                    </div>

                    <!-- Power + HR stream charts (only if streams available) -->
                    <div class="detail-charts-row" id="detailChartsRow" style="display:none">
                        <div class="card" id="detailPowerCard" style="display:none">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">Power</div>
                                    <div class="card-subtitle" id="detailPowerSubtitle"></div>
                                </div>
                            </div>
                            <div class="chart-wrap" style="height:200px">
                                <canvas id="activityPowerChart"></canvas>
                            </div>
                        </div>
                        <div class="card" id="detailHRCard" style="display:none">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">Heart Rate</div>
                                    <div class="card-subtitle" id="detailHRSubtitle"></div>
                                </div>
                            </div>
                            <div class="chart-wrap" style="height:200px">
                                <canvas id="activityHRChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Power zones (always shown if icu_zone_times exists) -->
                    <div class="card" id="detailZonesCard" style="display:none">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Power Zones</div>
                                <div class="card-subtitle" id="detailZonesSubtitle"></div>
                            </div>
                            <span class="badge" id="detailZonesTotalBadge"></span>
                        </div>
                        <div id="detailZoneList"></div>
                    </div>

                    <!-- Ride power curve (only if API returns data) -->
                    <div class="card" id="detailCurveCard" style="display:none">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Ride Power Curve</div>
                                <div class="card-subtitle" id="detailCurveSubtitle">Best efforts this ride</div>
                            </div>
                        </div>
                        <div class="curve-peaks" id="detailCurvePeaks"></div>
                        <div class="chart-wrap" style="height:200px">
                            <canvas id="activityCurveChart"></canvas>
                        </div>
                    </div>

                    <!-- Power histogram (only if histogram data in API response) -->
                    <div class="card" id="detailHistogramCard" style="display:none">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Power Distribution</div>
                                <div class="card-subtitle">Time at each watt level</div>
                            </div>
                        </div>
                        <div class="chart-wrap" style="height:200px">
                            <canvas id="activityHistogramChart"></canvas>
                        </div>
                    </div>

                </div>

                <!-- ==================== CALENDAR PAGE ==================== -->
                <div class="page" id="page-calendar">
                    <div class="cal-shell">

                        <!-- Header: navigation + month stats -->
                        <div class="cal-header">
                            <div class="cal-header-nav">
                                <button class="btn btn-ghost btn-icon" onclick="calPrevMonth()" title="Previous month">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
                                </button>
                                <span class="cal-month-title" id="calMonthLabel">—</span>
                                <button class="btn btn-ghost btn-icon" onclick="calNextMonth()" title="Next month">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
                                </button>
                                <button class="cal-today-btn" onclick="calGoToday()">Today</button>
                            </div>
                            <div class="cal-header-stats">
                                <div class="cal-hstat">
                                    <span class="cal-hstat-val" id="calStatActivities">—</span>
                                    <span class="cal-hstat-label">Activities</span>
                                </div>
                                <div class="cal-hstat-div"></div>
                                <div class="cal-hstat">
                                    <span class="cal-hstat-val" id="calStatDist">—</span>
                                    <span class="cal-hstat-label">Distance</span>
                                </div>
                                <div class="cal-hstat-div"></div>
                                <div class="cal-hstat">
                                    <span class="cal-hstat-val" id="calStatTSS">—</span>
                                    <span class="cal-hstat-label">Load</span>
                                </div>
                                <div class="cal-hstat-div"></div>
                                <div class="cal-hstat">
                                    <span class="cal-hstat-val" id="calStatTime">—</span>
                                    <span class="cal-hstat-label">Time</span>
                                </div>
                            </div>
                        </div>

                        <!-- Day-of-week header -->
                        <div class="cal-dow-row">
                            <div>Mon</div>
                            <div>Tue</div>
                            <div>Wed</div>
                            <div>Thu</div>
                            <div>Fri</div>
                            <div class="cal-dow--weekend">Sat</div>
                            <div class="cal-dow--weekend">Sun</div>
                        </div>

                        <!-- Calendar grid (filled by renderCalendar) -->
                        <div class="cal-grid" id="calGrid"></div>

                    </div>
                </div>

                <div class="page" id="page-fitness">
                    <!-- ── Key metrics row ── -->
                    <div class="fit-kpi-row">
                        <div class="fit-kpi-card">
                            <div class="fit-kpi-label">CTL</div>
                            <div class="fit-kpi-value fit-kpi-value--ctl" id="fitCTL">—</div>
                            <div class="fit-kpi-name">Fitness</div>
                            <div class="fit-kpi-bar">
                                <div class="fit-kpi-bar-fill fit-kpi-bar-fill--ctl" id="fitBarCTL"></div>
                            </div>
                        </div>
                        <div class="fit-kpi-card">
                            <div class="fit-kpi-label">ATL</div>
                            <div class="fit-kpi-value fit-kpi-value--atl" id="fitATL">—</div>
                            <div class="fit-kpi-name">Fatigue</div>
                            <div class="fit-kpi-bar">
                                <div class="fit-kpi-bar-fill fit-kpi-bar-fill--atl" id="fitBarATL"></div>
                            </div>
                        </div>
                        <div class="fit-kpi-card">
                            <div class="fit-kpi-label">TSB</div>
                            <div class="fit-kpi-value" id="fitTSB">—</div>
                            <div class="fit-kpi-name">Form</div>
                            <div class="fit-kpi-bar">
                                <div class="fit-kpi-bar-fill" id="fitBarTSB"></div>
                            </div>
                        </div>
                        <div class="fit-kpi-card">
                            <div class="fit-kpi-label">Ramp Rate</div>
                            <div class="fit-kpi-value" id="fitRamp">—</div>
                            <div class="fit-kpi-name">CTL / week</div>
                            <div class="fit-kpi-hint" id="fitRampHint"></div>
                        </div>
                        <div class="fit-kpi-card">
                            <div class="fit-kpi-label">Streak</div>
                            <div class="fit-kpi-value fit-kpi-value--streak" id="fitStreak">—</div>
                            <div class="fit-kpi-name">days</div>
                            <div class="fit-kpi-hint" id="fitStreakHint"></div>
                        </div>
                        <div class="fit-kpi-card">
                            <div class="fit-kpi-label">This Week</div>
                            <div class="fit-kpi-value" id="fitWeekActs">—</div>
                            <div class="fit-kpi-name">activities</div>
                            <div class="fit-kpi-hint" id="fitWeekHint"></div>
                        </div>
                    </div>

                    <!-- ── Wellness strip (shown only if data available) ── -->
                    <div class="fit-wellness-strip" id="fitWellnessStrip" style="display:none">
                        <div class="fit-wcard" id="fitWcardHRV" style="display:none">
                            <div class="fit-wcard-label">HRV <span class="fit-wcard-trend" id="fitHRVTrend"></span></div>
                            <div class="fit-wcard-val" id="fitHRV">—</div>
                            <div class="fit-wcard-sub">ms · 7-day avg</div>
                        </div>
                        <div class="fit-wcard" id="fitWcardHR" style="display:none">
                            <div class="fit-wcard-label">Resting HR</div>
                            <div class="fit-wcard-val" id="fitRestHR">—</div>
                            <div class="fit-wcard-sub">bpm · latest</div>
                        </div>
                        <div class="fit-wcard" id="fitWcardSleep" style="display:none">
                            <div class="fit-wcard-label">Sleep <span class="fit-wcard-trend" id="fitSleepTrend"></span></div>
                            <div class="fit-wcard-val" id="fitSleep">—</div>
                            <div class="fit-wcard-sub">hours · 7-day avg</div>
                        </div>
                        <div class="fit-wcard" id="fitWcardWeight" style="display:none">
                            <div class="fit-wcard-label">Weight <span class="fit-wcard-trend" id="fitWeightTrend"></span></div>
                            <div class="fit-wcard-val" id="fitWeight">—</div>
                            <div class="fit-wcard-sub">kg · latest</div>
                        </div>
                    </div>

                    <!-- ── Training Load History chart ── -->
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">
                                    Training Load History
                                </div>
                                <div class="card-subtitle">
                                    Chronic (CTL) · Acute (ATL) · Form (TSB)
                                </div>
                            </div>
                            <div class="card-header-controls">
                                <div class="chart-legend">
                                    <span class="chart-legend-item"
                                        ><span class="chart-legend-dot" style="background:var(--accent)"></span>CTL</span>
                                    <span class="chart-legend-item"
                                        ><span class="chart-legend-dot" style="background:var(--orange)"></span>ATL</span>
                                    <span class="chart-legend-item"
                                        ><span class="chart-legend-dot" style="background:var(--blue)"></span>TSB</span>
                                </div>
                                <div class="fit-range-pills" id="fitRangePills">
                                    <button
                                        id="fitRange30"
                                        onclick="setFitnessRange(30)"
                                    >
                                        30d
                                    </button>
                                    <button
                                        id="fitRange90"
                                        onclick="setFitnessRange(90)"
                                        class="active"
                                    >
                                        90d
                                    </button>
                                    <button
                                        id="fitRange180"
                                        onclick="setFitnessRange(180)"
                                    >
                                        6m
                                    </button>
                                    <button
                                        id="fitRange365"
                                        onclick="setFitnessRange(365)"
                                    >
                                        1y
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="chart-wrap chart-wrap--lg">
                            <canvas id="fitnessPageChart"></canvas>
                        </div>
                    </div>

                    <!-- ── Training Calendar + Weekly Load (side by side, equal height) ── -->
                    <div class="fit-cal-row">
                        <!-- Training Calendar heatmap -->
                        <div class="card fit-card-flex">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">Training Calendar</div>
                                    <div class="card-subtitle">Last 26 weeks · intensity = training load</div>
                                </div>
                                <div class="fit-hm-legend">
                                    <span>Less</span>
                                    <span class="fit-hm-swatch fit-hm-swatch--0"></span>
                                    <span class="fit-hm-swatch fit-hm-swatch--1"></span>
                                    <span class="fit-hm-swatch fit-hm-swatch--2"></span>
                                    <span class="fit-hm-swatch fit-hm-swatch--3"></span>
                                    <span class="fit-hm-swatch fit-hm-swatch--4"></span>
                                    <span>More</span>
                                </div>
                            </div>
                            <div class="fit-heatmap-scroll fit-heatmap-fill">
                                <div class="fit-heatmap" id="fitHeatmap"></div>
                            </div>
                        </div>

                        <!-- Weekly Load bars -->
                        <div class="card fit-card-flex">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">Weekly Load</div>
                                    <div class="card-subtitle">TSS per week · last 16 weeks</div>
                                </div>
                            </div>
                            <div class="chart-wrap fit-chart-fill">
                                <canvas id="fitnessWeeklyPageChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- ── Monthly Summary (full width) ── -->
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Monthly Summary</div>
                                <div class="card-subtitle">Rolling 6 months</div>
                            </div>
                        </div>

                        <!-- Monthly Summary table -->
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">
                                        Monthly Summary
                                    </div>
                                    <div class="card-subtitle">
                                        Rolling 6 months
                                    </div>
                                </div>
                            </div>
                            <div class="fit-monthly-wrap">
                                <table class="fit-monthly-table">
                                    <thead>
                                        <tr>
                                            <th>Month</th>
                                            <th>Rides</th>
                                            <th>Distance</th>
                                            <th>Time</th>
                                            <th>TSS</th>
                                        </tr>
                                    </thead>
                                    <tbody id="fitMonthlyBody">
                                        <tr>
                                            <td
                                                colspan="5"
                                                style="
                                                    text-align: center;
                                                    color: var(--text-muted);
                                                    padding: 24px;
                                                "
                                            >
                                                Sync to load
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                </div>
                </div><!-- /page-fitness -->

                <div class="page" id="page-power">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Power Curve</div>
                        </div>
                        <div class="empty-state empty-state--xl">
                            <svg
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="1.5"
                            >
                                <polygon
                                    points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"
                                />
                            </svg>
                            <p>Power curve analysis — next step</p>
                        </div>
                    </div>
                </div>

                <div class="page" id="page-zones">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Training Zones</div>
                        </div>
                        <div class="empty-state empty-state--xl">
                            <svg
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="1.5"
                            >
                                <circle cx="12" cy="12" r="10" />
                            </svg>
                            <p>Zone distribution — next step</p>
                        </div>
                    </div>
                </div>

                <!-- ==================== WORKOUT BUILDER ==================== -->
                <div class="page" id="page-workout">

                    <!-- Top bar: name + stats -->
                    <div class="wrk-topbar">
                        <input class="wrk-name-input" id="wrkNameInput" placeholder="Workout name" value="New Workout" oninput="wrkState.name=this.value;wrkRefreshStats()">
                        <div class="wrk-topbar-stats">
                            <span class="wrk-stat"><span class="wrk-stat-val" id="wrkTotalTime">0:00</span><span class="wrk-stat-lbl">duration</span></span>
                            <span class="wrk-stat-sep">·</span>
                            <span class="wrk-stat"><span class="wrk-stat-val" id="wrkTotalTSS">0</span><span class="wrk-stat-lbl">TSS</span></span>
                            <span class="wrk-stat-sep">·</span>
                            <span class="wrk-stat"><span class="wrk-stat-val" id="wrkFtpDisp">—</span><span class="wrk-stat-lbl">FTP w</span></span>
                        </div>
                        <button class="btn btn-ghost wrk-clear-btn" onclick="wrkClear()">New</button>
                    </div>

                    <!-- Visual chart -->
                    <div class="card wrk-chart-card">
                        <canvas id="wrkCanvas" class="wrk-canvas"></canvas>
                        <div class="wrk-chart-empty" id="wrkChartEmpty">Add segments below to preview your workout</div>
                    </div>

                    <!-- Segment list -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Segments</div>
                            <div class="wrk-ftp-row">
                                <label class="wrk-ftp-label">FTP override</label>
                                <input class="wrk-ftp-input" id="wrkFtpInput" type="number" min="50" max="600" placeholder="auto" oninput="wrkSetFtp(this.value)">
                                <span class="wrk-ftp-unit">w</span>
                            </div>
                        </div>
                        <div class="wrk-segment-list" id="wrkSegmentList">
                            <div class="wrk-list-empty">No segments yet — add one below</div>
                        </div>
                        <div class="wrk-add-bar">
                            <button class="btn btn-ghost wrk-add-btn" onclick="wrkAddSegment('warmup')">+ Warmup</button>
                            <button class="btn btn-ghost wrk-add-btn" onclick="wrkAddSegment('steady')">+ Steady</button>
                            <button class="btn btn-ghost wrk-add-btn" onclick="wrkAddSegment('interval')">+ Interval</button>
                            <button class="btn btn-ghost wrk-add-btn" onclick="wrkAddSegment('cooldown')">+ Cooldown</button>
                            <button class="btn btn-ghost wrk-add-btn" onclick="wrkAddSegment('free')">+ Free Ride</button>
                        </div>
                    </div>

                    <!-- Export bar -->
                    <div class="card wrk-export-card">
                        <div class="wrk-export-info">
                            <div class="wrk-export-title">Export workout</div>
                            <div class="wrk-export-sub">Zwift: load the .zwo file from Documents/Zwift/Workouts · Garmin: sideload the .fit to your device or import via Garmin Connect</div>
                        </div>
                        <div class="wrk-export-btns">
                            <button class="btn btn-primary" onclick="wrkExportZwo()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                Zwift (.zwo)
                            </button>
                            <button class="btn btn-ghost" onclick="wrkExportFit()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                Garmin (.fit)
                            </button>
                        </div>
                    </div>

                </div>

                <!-- ==================== SETTINGS PAGE ==================== -->
                <div class="page" id="page-settings">
                    <div class="card card--narrow">
                        <div class="card-header">
                            <div class="card-title">
                                Account &amp; Connection
                            </div>
                        </div>

                        <div class="settings-section">
                            <div class="settings-section-title">
                                Connection Status
                            </div>
                            <div class="settings-row">
                                <div class="settings-row-info">
                                    <div class="settings-row-label">
                                        intervals.icu
                                    </div>
                                    <div class="settings-row-sub">
                                        Training data source
                                    </div>
                                </div>
                                <div
                                    class="connection-status-badge disconnected"
                                    id="settingsConnectionBadge"
                                >
                                    <span id="settingsConnectionText"
                                        >Not connected</span
                                    >
                                </div>
                            </div>
                        </div>

                        <div class="settings-section">
                            <div class="settings-section-title">
                                Saved Credentials
                            </div>
                            <div class="settings-row">
                                <div class="settings-row-info">
                                    <div class="settings-row-label">
                                        Athlete ID
                                    </div>
                                    <div class="settings-row-sub">
                                        Your intervals.icu athlete ID
                                    </div>
                                </div>
                                <div
                                    class="settings-row-value"
                                    id="settingsAthleteId"
                                >
                                    —
                                </div>
                            </div>
                            <div class="settings-row">
                                <div class="settings-row-info">
                                    <div class="settings-row-label">
                                        API Key
                                    </div>
                                    <div class="settings-row-sub">
                                        Stored locally in your browser
                                    </div>
                                </div>
                                <div
                                    class="settings-row-value"
                                    id="settingsApiKey"
                                >
                                    —
                                </div>
                            </div>
                        </div>

                        <div class="settings-section">
                            <div class="settings-section-title">Preferences</div>
                            <div class="settings-row">
                                <div class="settings-row-info">
                                    <div class="settings-row-label">Week starts on</div>
                                    <div class="settings-row-sub">Affects weekly stats, week progress card &amp; calendar</div>
                                </div>
                                <div class="date-range-pill">
                                    <button data-weekstart="1" onclick="setWeekStartDay(1)" class="active">Mon</button>
                                    <button data-weekstart="0" onclick="setWeekStartDay(0)">Sun</button>
                                </div>
                            </div>
                        </div>

                        <div class="settings-section">
                            <div class="settings-section-title">Actions</div>
                            <div class="settings-actions">
                                <button
                                    class="btn btn-primary"
                                    onclick="openModal()"
                                >
                                    <svg
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2.5"
                                    >
                                        <path
                                            d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"
                                        />
                                        <path
                                            d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"
                                        />
                                    </svg>
                                    Change Credentials
                                </button>
                                <button
                                    class="btn btn-ghost"
                                    onclick="syncData()"
                                >
                                    <svg
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                    >
                                        <polyline points="23 4 23 10 17 10" />
                                        <path
                                            d="M20.49 15a9 9 0 1 1-.08-8.58"
                                        />
                                    </svg>
                                    Sync Now
                                </button>
                                <button
                                    class="btn btn-ghost"
                                    onclick="forceFullSync()"
                                    title="Clears the local cache and re-fetches all activities from the server"
                                >
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="1 4 1 10 7 10"/>
                                        <path d="M3.51 15a9 9 0 1 0 .49-4.93"/>
                                    </svg>
                                    Full Re-sync
                                </button>
                                <button
                                    class="btn btn-ghost"
                                    onclick="copySetupLink()"
                                >
                                    <svg
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                    >
                                        <rect
                                            x="9"
                                            y="9"
                                            width="13"
                                            height="13"
                                            rx="2"
                                        />
                                        <path
                                            d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"
                                        />
                                    </svg>
                                    Copy Setup Link
                                </button>
                                <button
                                    class="btn btn-danger"
                                    onclick="disconnect()"
                                >
                                    <svg
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                    >
                                        <line x1="18" y1="6" x2="6" y2="18" />
                                        <line x1="6" y1="6" x2="18" y2="18" />
                                    </svg>
                                    Disconnect
                                </button>
                            </div>
                        </div>

                        <div class="settings-section">
                            <div class="settings-section-title">About</div>
                            <p class="about-text">
                                CycleIQ pulls data directly from intervals.icu
                                using their REST API. Your API key is stored
                                only in your browser's localStorage and is never
                                sent anywhere except intervals.icu's own
                                servers. No backend, no accounts — just your
                                data.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- end page-content -->
        </main>

        <!-- LOADING OVERLAY -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="spinner"></div>
            <div class="loading-text" id="loadingText">Syncing data…</div>
        </div>

        <!-- TOAST -->
        <div class="toast-container" id="toastContainer"></div>

    </body>
</html>
